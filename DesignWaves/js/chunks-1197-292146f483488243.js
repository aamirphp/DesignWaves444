"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1197],{61798:function(e,t,n){n.d(t,{V:function(){return l},u:function(){return c}});var r=n(2784),o=n(69262),i=n(22087),s=n(66564),a=n(89928),c=function(){var e=(0,i.CG)(s.i2),t=(0,r.useRef)(),n=(0,o.ye)("autoZoomToFit")||a.QX;(0,r.useEffect)(function(){var r=!t.current;t.current=e,e&&n&&!r&&l()},[e,n])},l=function(){var e=(0,i.bh)(),t=document.documentElement.clientHeight,n=document.querySelector('[data-animate-value="presentCurrent"] [data-card-scroll-element]');n&&(e.dispatch((0,s.Ic)({zoomLevel:1})),setTimeout(function(){var r=n.scrollHeight,o=t/r;if(a.QX)o=Math.max(t/r,.7);else{if(o<.7)return;o=Math.floor(10*o)/10}e.dispatch((0,s.Ic)({zoomLevel:o})),console.debug("[zoomPresentModeToFit] zooming",JSON.stringify({viewportHeight:t,cardHeight:r,targetZoom:o}))}))}},31197:function(e,t,n){n.d(t,{dM:function(){return dA},Ur:function(){return dp},nz:function(){return dN},_i:function(){return t9._i}});var r,o,i,s,a,c,l,u,d,f=n(93812),p=n(11919),h=n(91012),m=n(53738),g=n(34676),v=n(49929),x=n(42751),y=n(97729),b=n.n(y),j=n(2784),w=n(43997),k=n(24553),C=n(34161),O=n(78558),E=n(62636),S=n(95235),I=n(81333),P=n(29106),D=n(75944),T=n(54728),A=n(51434),R=n(67887),L=n(91333),_=n(83897),Z=n(96412),M=n(13089),z=n(41701),N=n(90129),G=n(29017),W=n(48200),F=n(30733),B=n.n(F),U=n(12436),V=n.n(U),q=n(52939),H=function(e){(0,N.Z)(r,e);var t,n=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,W.Z)(r);if(t){var o=(0,W.Z)(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return(0,G.Z)(this,e)});function r(){var e;return(0,Z.Z)(this,r),e=n.call(this),(0,S.Z)((0,z.Z)(e),"throttled",void 0),e.throttled=V()(function(t){e.emit("move",t)},200,{leading:!0}),document.addEventListener("mousemove",e.throttled),e}return(0,M.Z)(r,[{key:"cleanup",value:function(){document.removeEventListener("mousemove",this.throttled)}}]),r}(q.v),Y=B()(function(){return new H}),K=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Y(),r=(0,j.useState)(!1),o=r[0],i=r[1],s=(0,j.useRef)(t);return(0,j.useEffect)(function(){s.current=t},[t]),(0,j.useEffect)(function(){return n.on("move",function(t){s.current||i(e(t))})},[n,e]),o},X=n(22087),Q=n(66564),J=n(39586),$=n(75673),ee=n(58835),et=n(954),en=n(35232),er=n(63613),eo=n(80891),ei=n(61374),es=n(8283),ea=n(96530),ec=n(71354),el=n(50390),eu=n(5766),ed=n(40110),ef=n(45650),ep=n(52322),eh=function(e){var t=e.label,n=e.shortcuts;return(0,ep.jsxs)(es.U,{children:[n.map(function(e,t){return(0,ep.jsx)(ea.T,{padding:1,children:e},t)}),(0,ep.jsx)(h.x,{fontSize:"sm",fontWeight:"medium",whiteSpace:"nowrap",children:t})]})},em=function(e){var t=e.onClose;return(0,ep.jsx)(m.xu,{children:(0,ep.jsxs)(ec.K,{spacing:6,children:[(0,ep.jsxs)(ec.K,{spacing:1,children:[(0,ep.jsxs)(es.U,{color:"gray.500",children:[(0,ep.jsx)(v.G,{icon:P.UF})," ",(0,ep.jsx)(el.X,{size:"xs",fontWeight:"normal",children:"Keyboard Shortcuts"})]}),(0,ep.jsx)(el.X,{size:"md",children:"Present mode"})]}),(0,ep.jsxs)(eu.M,{spacing:3,columns:1,children:[(0,ep.jsx)(eh,{label:"Previous/next card",shortcuts:[(0,ep.jsx)(v.G,{icon:ei.ac},"left"),(0,ep.jsx)(v.G,{icon:eo.eF},"right")]}),(0,ep.jsx)(eh,{label:"Exit present mode",shortcuts:["Esc"]}),(0,ep.jsx)(eh,{label:"Restart presentation",shortcuts:["R"]}),(0,ep.jsx)(ed.i,{borderColor:"gray.300"}),(0,ep.jsx)(eh,{label:"Spotlight on/off",shortcuts:["S"]}),(0,ep.jsx)(eh,{label:"Previous/next step",shortcuts:[(0,ep.jsx)(v.G,{icon:er.FP},"up"),(0,ep.jsx)(v.G,{icon:en.r5},"down")]}),(0,ep.jsx)(eh,{label:"Open/close card",shortcuts:["Enter"]})]}),(0,ep.jsx)(ef.z,{size:"sm",variant:"solid",onClick:t,children:"Got it"})]})},"coach-bar")};function eg(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ev(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eg(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eg(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ex=(0,j.memo)(function(){var e=(0,D.q)(),t=e.isOpen,n=e.onToggle,r=e.onClose,o=(0,J._)($.H.hasSeenCoachBar,!1),i=(0,I.Z)(o,2),s=i[0],a=i[1],c=(0,X.CG)(Q.Tf),l=(0,j.useCallback)(function(){s||a(!0),r()},[s,r,a]),u=!s||t,d=K((0,j.useCallback)(function(e){return e.clientX>window.innerWidth-150&&e.clientY>window.innerHeight-150},[]));return(0,ep.jsx)(et.H,{mr:c&&s&&!u&&!d?"-100%":"0px",transitionProperty:"margin-right",transitionDuration:"ultra-slow",transitionTimingFunction:"ease-in-out",children:(0,ep.jsxs)(T.J,{returnFocusOnClose:!1,isOpen:u,onClose:l,closeOnBlur:!0,children:[(0,ep.jsx)(A.x,{children:(0,ep.jsx)(R.h,{onClick:function(){t&&a(!0),n()},"aria-label":"Help",isRound:!0,size:"md",icon:(0,ep.jsx)(v.G,{icon:P.UF})})}),(0,ep.jsx)(L.y,ev(ev({},ee.Ro),{},{children:(0,ep.jsx)(_.b,{children:(0,ep.jsx)(em,{onClose:l})})}))]})})});ex.displayName="PresentModeHelpWidget";var ey=n(60096),eb=n(71040),ej=n(393),ew=n(14059),ek=n(39363),eC=n(66337);function eO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eO(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eO(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eS=function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.overflow="scroll",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);var t=document.createElement("div");e.appendChild(t);var n=e.offsetWidth-t.offsetWidth;return e.parentNode.removeChild(e),n},eI=function(e){var t=e.setWidth,n=e.width,r=e.position,o=e.onClose,i=e.panelRef,s=e.initialWidth,a=e.isDragging,c=e.setIsDragging,l=(0,j.useMemo)(function(){return eS()},[])>0&&"right"===r,u=(0,j.useState)(n),d=u[0],f=u[1],h=(0,j.useState)(null),g=h[0],v=h[1],x=V()(function(e){var t,n=Math.min(Math.max(t="left"===r?e.clientX:-((e.clientX-g)*1)+d,ew.pn),ew.ZQ);t<=ew.Nh?(i.current.style.transitionProperty="width",i.current.style.transitionDuration="var(--chakra-transition-duration-normal)",n=0):n>ew.pn&&(i.current.style.transitionProperty="",i.current.style.transitionDuration=""),i.current.style.width="".concat(n,"px")},30),y=function e(){c(!1),v(null);var n=i.current.style.width;"0px"===n?(o(),t(s)):t(parseInt(n.replace("px",""),10)),i.current.style.transitionProperty="",i.current.style.transitionDuration="",window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",e)};(0,j.useEffect)(function(){return g&&(window.addEventListener("mousemove",x),window.addEventListener("mouseup",y)),function(){window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",y)}},[g]);var b={};return b="left"===r?{right:-4,position:"absolute"}:l?{position:"relative"}:{left:-4,position:"absolute"},(0,ep.jsx)(p.k,eE(eE({h:"100%",bg:l?"gray.200":a?"blackAlpha.200":"rgba(0,0,0,0)",w:l?2:4,justifyContent:"center",alignItems:"center",cursor:"col-resize",_hover:{bg:l?"gray.400":"blackAlpha.200"},transitionProperty:"common",transitionDuration:"normal",role:"group",onMouseDown:function(e){e.preventDefault(),c(!0),v(e.clientX),f(n)},position:"absolute",display:["none","none","none","flex"]},b),{},{children:!l&&(0,ep.jsx)(m.xu,{bg:"white",borderRadius:"full",w:1,h:10,opacity:a?1:".5",transitionProperty:"common",transitionDuration:"normal",_groupHover:{opacity:1}})}))},eP=n(35789);function eD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eD(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eD(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eA={ifPanelHasRoomToOpen:function(e,t){return{base:t,xl:e}}},eR=function(e){var t,n=e.position,r=e.panelLifecycle,o=(0,j.useRef)(),i=(0,j.useState)(!1),s=i[0],a=i[1],c=(0,w.I0)(),l=(0,X.CG)((0,eP.SL)(n)),u=(0,X.CG)((0,eP.Fw)(n)),d=(0,X.CG)((0,eP.CO)(n)),f=(0,X.CG)((0,eP.eh)(n)),h=null!==(t=null==f?void 0:f.canCollapse)&&void 0!==t&&t,m=(0,j.useCallback)(function(){c((0,eP.sR)({position:n}))},[c,n]),g=(0,j.useCallback)(function(){c((0,eP.Yp)({component:f}))},[f,c]),v=(0,j.useCallback)(function(e){c((0,eP.UG)({width:e,position:n})),r.emit("resize",{})},[c,r,n]),x=(0,S.Z)({zIndex:Number((0,ej.dQ)("zIndices","overlay"))+1,position:eA.ifPanelHasRoomToOpen("relative","fixed"),height:"100%",top:0,bottom:0},n,0);u||s||(x.transitionProperty="width",x.transitionDuration="normal"),(0,j.useEffect)(function(){var e=function(e){"width"===e.propertyName&&r.emit("resize",{})};return o.current.addEventListener("transitionend",e),function(){o.current&&o.current.removeEventListener("transitionend",e)}},[r,o]);var y=(0,ek.i)(eA.ifPanelHasRoomToOpen(!0,!1))||!1;return(0,j.useEffect)(function(){l&&!y&&h&&m()},[y,l,m,h]),(0,ep.jsxs)(p.k,eT(eT({ref:o},x),{},{style:{width:l||h?d:0},maxW:"100%","data-print-hidden":!0,children:[l&&"right"===n&&(0,ep.jsx)(eI,{isDragging:s,setIsDragging:a,position:n,width:d,setWidth:v,panelRef:o,onClose:m,initialWidth:ew.Ld}),(0,ep.jsx)(eC.Mn.Provider,{value:r,children:f&&(l||h)&&(0,ep.jsx)(f,{isDragging:s,isOpen:l,closePanel:m,openPanel:g,panelRef:o,lifecycle:r,hasRoomToOpen:y})}),l&&"left"===n&&(0,ep.jsx)(eI,{isDragging:s,setIsDragging:a,position:n,width:d,setWidth:v,panelRef:o,onClose:m,initialWidth:ew.X9})]}))},eL=(0,j.memo)(function(e){return(0,ep.jsx)(eR,eT({position:"right"},e))});eL.displayName="RightPanelContainer";var e_=(0,j.memo)(function(e){return(0,ep.jsx)(eR,eT({position:"left"},e))});e_.displayName="LeftPanelContainer";var eZ=n(2172),eM=n(93230),ez=n(4640),eN=n(74637),eG=n(94301),eW=n(35741),eF=n(82269),eB=n(20299),eU=n(46974),eV=n(48798),eq=n(85249),eH=n(20176),eY=n(36471),eK=n(1410),eX=n(46510),eQ=n(80304),eJ=n(55479),e$=n(84103),e0=n(49294),e1=n(34638),e2=n(56143),e5=n(28871),e3=n(50381),e6=n.n(e3),e4=n(97705),e9=n(93506),e7=n(73137),e8=n(25925),te=["children","style"];function tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tt(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tr={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},to="custom"in e7.E?e7.E.custom(e4.m.div):(0,e7.E)(e4.m.div),ti=(0,j.forwardRef)(function(e,t){var n,r,o=e.children,i=e.style,s=(0,eF.Z)(e,te),a=(0,e9.jC)("Menu",s);return(0,ep.jsx)(e4.m.div,tn(tn({ref:t,__css:{zIndex:null!==(n=e.zIndex)&&void 0!==n?n:null===(r=a.list)||void 0===r?void 0:r.zIndex},style:tn({},i)},s),{},{children:(0,ep.jsx)(e8.M,{children:(0,ep.jsx)(to,{className:(0,g.cx)("chakra-menu__menu-list"),variants:tr,style:{transformOrigin:"top left"},initial:tr.exit,animate:tr.enter,exit:tr.exit,__css:tn({outline:0},a.list),children:o})})}))}),ts=n(17107),ta=["type"],tc=["icon","iconSpacing","command","commandSpacing","children"],tl=["className","children"],tu=["className"];function td(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?td(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):td(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tp=(0,ts.G)(function(e,t){var n=e.type,r=(0,eF.Z)(e,ta),o=(0,e9.jC)("Menu",r),i=r.as?null!=n?n:void 0:"button",s=tf({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0},o.item);return(0,ep.jsx)(e4.m.button,tf(tf({ref:t,type:i},r),{},{__css:s,_hover:o.item._focus}))}),th=(0,ts.G)(function(e,t){var n=e.icon,r=e.iconSpacing,o=e.command,i=e.commandSpacing,s=e.children,a=(0,eF.Z)(e,tc),c=n||o?(0,ep.jsx)("span",{style:{pointerEvents:"none",flex:1},children:s}):s;return(0,ep.jsxs)(tp,tf(tf({},a),{},{className:(0,g.cx)("chakra-menu__menuitem"),children:[n&&(0,ep.jsx)(tm,{fontSize:"0.8em",marginEnd:void 0===r?"0.75rem":r,children:n}),c,o&&(0,ep.jsx)(tg,{marginStart:void 0===i?"0.75rem":i,children:o})]}))});th.displayName="MenuItem";var tm=function(e){var t=e.className,n=e.children,r=(0,eF.Z)(e,tl),o=j.Children.only(n),i=j.isValidElement(o)?j.cloneElement(o,{focusable:"false","aria-hidden":!0,className:(0,g.cx)("chakra-menu__icon",o.props.className)}):null,s=(0,g.cx)("chakra-menu__icon-wrapper",t);return(0,ep.jsx)(e4.m.span,tf(tf({className:s},r),{},{__css:{flexShrink:0},children:i}))};tm.displayName="MenuIcon";var tg=(0,ts.G)(function(e,t){var n=(0,e9.jC)("Menu",e);return(0,ep.jsx)(e4.m.span,tf(tf({ref:t},e),{},{__css:n.command,className:"chakra-menu__command"}))});tg.displayName="MenuCommand";var tv=function(e){var t=e.className,n=(0,eF.Z)(e,tu),r=(0,e9.jC)("Menu",e);return(0,ep.jsx)(e4.m.hr,tf(tf({role:"separator","aria-orientation":"horizontal",className:(0,g.cx)("chakra-menu__divider",t)},n),{},{__css:r.divider}))};tv.displayName="MenuDivider";var tx=n(34321),ty=n(49333),tb=n(41976),tj=n(64070),tw=["editor","openStyleDrawer","cardUrl","getPos","isNested","isFirstCard","isCollapsed","hasCardBackground","onClose","updateAttributes","previewContent"];function tk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tk(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tk(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tO=(0,ep.jsx)(v.G,{icon:eQ.TX,fixedWidth:!0}),tE=(0,ep.jsx)(v.G,{icon:eX.WM,fixedWidth:!0}),tS=(0,ep.jsx)(v.G,{icon:eK.O4,fixedWidth:!0}),tI=(0,ep.jsx)(v.G,{icon:eY.$,fixedWidth:!0}),tP=(0,ep.jsx)(v.G,{icon:eH.FP,fixedWidth:!0}),tD=(0,ep.jsx)(v.G,{icon:eq.oK,fixedWidth:!0}),tT=(0,ep.jsx)(v.G,{icon:eV.re,fixedWidth:!0}),tA=(0,ep.jsx)(v.G,{icon:eU.z1,fixedWidth:!0}),tR=(0,ep.jsx)(v.G,{icon:eB.UP,fixedWidth:!0}),tL=(0,j.forwardRef)(function(e,t){var n=e.editor,r=e.openStyleDrawer,o=e.cardUrl,i=e.getPos,s=e.isNested,a=e.isFirstCard,c=e.isCollapsed,l=e.hasCardBackground,u=e.onClose,d=e.updateAttributes,f=e.previewContent,m=(0,eF.Z)(e,tw);console.debug("%c [<ManageCardMenu />] RENDER","background-color: limegreen");var g=(0,eJ.p)(),v=(0,tj.K)(),x=(0,j.useCallback)(function(){d&&d({previewContent:null===f?"":null})},[d,f]),y=(0,j.useCallback)(function(){var e=i();if(e&&n){var t=n.state.doc.nodeAt(e),r=t&&(0,e5.getCardTitle)(t.toJSON());n.chain().deleteCard(e).focus().run();var o=g({title:(0,ep.jsxs)(es.U,{children:[(0,ep.jsxs)(h.x,{noOfLines:1,children:["Deleted ",r?'"'.concat(r,'"'):"card",". "]}),(0,ep.jsx)(e$.r,{textDecoration:"underline",onClick:function(){(0,e2.Yw)(n.state),g.close(o)},children:"Undo"})]}),status:"info",duration:3e3,position:"top"})}},[n,i,g]),b=(0,j.useCallback)(function(){var e=i();e&&(null==n||n.commands.duplicateCard(e))},[n,i]),w=(0,j.useCallback)(function(){var e=i();e&&(null==n||n.commands.unnestCard(e))},[n,i]),k=(0,j.useCallback)(function(){var e=i();e&&(null==n||n.chain().mergeCardsAtPos(e).focus().run())},[n,i]),C=(0,j.useCallback)(function(){r(0)},[r]),O=(0,j.useCallback)(function(){r(1)},[r]),E=(0,X.CG)(Q.hN),S=(0,e0.V)(o).onCopy,I=(0,e1.ff)("red.500","red.300"),P=(0,j.useCallback)(function(e){var t;if(e.target&&null!==(t=e.target)&&void 0!==t&&t.closest('[data-testid="open-share"]')){e.preventDefault();return}S(),g({title:"URL copied.",status:"success",duration:3e3,position:"top"})},[S,g]),D=(0,j.useCallback)(function(){var e=i();if(e&&n){var t=(0,ty.PZ)(n,e);if(!t){g({title:"Error copying card.",status:"error",duration:3e3,position:"top"});return}e6()(t,{format:"text/html"}),g({title:"Card copied.",status:"success",duration:3e3,position:"top"})}},[n,i,g]);return(0,ep.jsxs)(ti,tC(tC({},m),{},{zIndex:"popover",ref:t,onClick:u,"data-testid":"manage-card-menu",children:[(0,ep.jsx)(th,{icon:(0,ep.jsx)(tb.x,{isLocked:!v}),onClick:P,"data-testid":"copy-card-link",children:"Copy card link"}),(0,ep.jsx)(th,{icon:tS,onClick:D,children:"Copy card"}),(0,ep.jsxs)(p.k,{direction:"column",display:E?"flex":"none",children:[(0,ep.jsx)(tv,{}),(0,ep.jsx)(th,{icon:tE,onClick:b,"data-testid":"duplicate-card",children:"Duplicate"}),d&&s&&c&&(0,ep.jsx)(th,{icon:""===f?tA:tR,onClick:x,"data-testid":"hide-preview",children:""===f?"Show preview text":"Hide preview text"}),r&&void 0!==l&&!c&&(0,ep.jsx)(th,{icon:tT,onClick:C,onMouseDown:tx.br,"data-testid":"card-background",children:l?"Change background":"Add background"}),r&&!c&&(0,ep.jsx)(th,{icon:tO,onClick:O,onMouseDown:tx.br,"data-testid":"card-style",children:"Change style"}),s?(0,ep.jsx)(th,{icon:tD,onClick:w,"data-testid":"merge-into-parent-card",children:"Merge into parent card"}):!1!=s||a?null:(0,ep.jsx)(th,{icon:tP,onClick:k,"data-testid":"merge-into-card-above",children:"Merge into card above"}),(0,ep.jsx)(tv,{}),(0,ep.jsx)(th,{icon:tI,color:I,onClick:y,"data-testid":"delete-card",children:"Delete"})]})]}))}),t_=n(77173);function tZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tZ(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tZ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tz=(0,j.memo)(function(e){var t=e.editor,n=(0,X.CG)(t_.tk),r=n.isOpen,o=n.ref,i=n.options,s=(0,j.useState)(null),a=s[0],c=s[1],l=(0,eW.D)(o,a,{placement:"bottom-start",modifiers:[{name:"preventOverflow",enabled:!0,options:{boundary:"clippingParents"}},{name:"offset",options:{offset:[0,8]}}],strategy:"absolute"}).styles,u=(0,w.I0)(),d=(0,j.useCallback)(function(){u((0,t_.kG)({saveRef:!0}))},[u]),f=(0,j.useCallback)(function(){u((0,t_.kG)({saveRef:!1}))},[u]);return(0,eN.O)({ref:{current:a},handler:function(){r&&(d(),setTimeout(function(){u((0,t_.gQ)())},0))}}),(0,j.useEffect)(function(){return function(){return f()}},[]),(0,ep.jsx)(eG.h,{children:r&&i&&(0,ep.jsx)(tL,tM(tM({},i),{},{style:tM({},l.popper),onClose:f,ref:c,editor:t}))})}),tN=n(52459),tG=n(65682),tW=n(29999),tF=n(3866),tB=n(84636),tU=n.n(tB),tV=n(54073),tq=n.n(tV),tH=n(72338),tY=n(37464),tK=n(88569),tX=n(2487),tQ=n(16219),tJ=function(e,t,n,r,o){var i=r-n,s=Math.max(i-Math.max(e-n,0)-Math.max(r-t,0),0),a=s/i,c=a>0&&s==t-e;return{overlap:a,viewing:o&&(c||a>.5||s>400),only:c}};function t$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var t0=function(e,t){var n=(0,tY.As)("editor"),r=(0,j.useState)(null),o=r[0],i=r[1],s=(0,j.useRef)({presentingCardId:null,scrollTop:0,containerHeight:0,expandedCards:{}}),a=(0,X.CG)(Q.gh),c=(0,X.CG)(Q.i2);(0,j.useEffect)(function(){s.current.presentingCardId=null!=c?c:null},[c]);var l=(0,X.CG)(Q.Q5);(0,j.useEffect)(function(){s.current.expandedCards=l},[l]),(0,j.useEffect)(function(){var e=document.querySelector(n.scrollSelector);if(e){i(e);var t=e.getBoundingClientRect().height;s.current.scrollTop=e.scrollTop,s.current.containerHeight=t}},[n.scrollSelector,s]),(0,j.useEffect)(function(){var e=tq()(function(){o&&(s.current.scrollTop=o.scrollTop)},250,{trailing:!0,maxWait:500});return window.addEventListener("scroll",e,!0),function(){return window.removeEventListener("scroll",e,!0)}},[o]),(0,j.useEffect)(function(){var e=tq()(function(){o&&(s.current.containerHeight=o.getBoundingClientRect().height)},250,{trailing:!0,maxWait:500});return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}},[o]),(0,j.useEffect)(function(){if(e){if(a===tQ.q.SLIDE_VIEW){var r=setInterval(function(){t.emit("cardViewed",{cardId:s.current.presentingCardId,interval:1e3})},1e3);return function(){return clearInterval(r)}}var o=setInterval(function(){if(!document.hidden){var r=s.current,o=r.scrollTop,i=r.containerHeight,a=r.expandedCards,c=o+i;tU()((0,tH.N2)(e.state.doc,tK.KH),function(e){return e.node.attrs.id}).map(function(t){var r,i=t.node.attrs.id,s=a[i];if(!s)return null;try{r=e.view.nodeDOM(t.pos)}catch(l){return null}if(r instanceof HTMLElement){var u=(0,tX.LY)(r,n.scrollSelector);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?t$(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({id:i},tJ(o,c,u,r.offsetHeight+u,s))}return null}).filter(function(e){return!!(null!=e&&e.viewing)}).forEach(function(e){t.emit("cardViewed",{cardId:e.id,interval:1e3})})}},1e3);return function(){return clearInterval(o)}}},[a,e,s,t,n.scrollSelector])},t1=function(e){var t=e.editor,n=e.backoffFactor,r=void 0===n?1:n,o=(0,tW.z$)(),i=(0,j.useState)(15e3),s=i[0],a=i[1];t0(t,tF.f);var c=(0,j.useCallback)(function(){tF.f.flush(),a(Math.min(s*r,12e4))},[r,s]);return(0,j.useEffect)(function(){if(o){tF.f.initialize(),tF.f.on("flush",function(e){for(var t=e.viewed,n=0,r=Object.entries(t);n<r.length;n++){var i=(0,I.Z)(r[n],2),s=i[0],a=i[1];o.trackDocEvent(tW.AA.CARD_VIEWED,{card_id:s,duration:a})}});var e=setInterval(function(){return c()},s);return function(){clearInterval(e),tF.f.destroy()}}},[o,s,c]),null},t2=n(33660),t5="drag-in-progress",t3=function(){(0,j.useEffect)(function(){var e=function(){document.body.classList.add(t5)},t=function(){document.body.classList.remove(t5)};return document.body.addEventListener("dragstart",e,!0),document.body.addEventListener("dragend",t,!0),document.body.addEventListener("drop",t,!0),document.body.addEventListener("mouseup",t,!0),function(){document.body.removeEventListener("dragstart",e,!0),document.body.removeEventListener("dragend",t,!0),document.body.removeEventListener("drop",t,!0),document.body.removeEventListener("mouseup",t,!0)}},[])},t6=n(96420),t4=n(63492),t9=n(91036),t7=n(46855),t8=n(20406),ne=n(28526),nt=n.n(ne),nn=n(78116),nr=n(56915),no=n(16796),ni=n(64827),ns=n(2167),na=n(80353),nc=n(76648),nl=n(58125),nu=n(30764),nd=n(68924),nf=new q.v,np=n(81921),nh=n(70921),nm=n(15631);function ng(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function nv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ng(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ng(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var nx=function(e){var t=(0,nm.M)({id:"cardSuggestionDrawer"}),n=t.isOpen,r=t.onClose,o=t.onOpen,i=(0,X.CG)(Q.Pu),s=(0,j.useState)(function(){return(0,nl.xC)({reducer:X.Ct})})[0];return(0,ep.jsx)(w.zt,{store:s,children:(0,ep.jsx)(ny,nv(nv({},e),{},{isOpen:n,onClose:r,onOpen:o,theme:i}))})},ny=(0,nh.TR)(function(e){var t,n=e.doc,r=e.editor,o=e.theme,i=e.isOpen,s=e.onClose,a=e.onOpen,c=(0,j.useState)([]),l=c[0],u=c[1],d=(0,j.useState)(null),f=d[0],p=d[1],h=(0,nh.Aw)().getAllCards,m=(0,j.useCallback)(function(){s(),u([]),p(null)},[s]),g=(0,j.useCallback)(function(){if(m(),r){var e={type:"document",content:h()};console.log("[handleConfirm] contentToUse",e);var t=1,n=r.state.doc.nodeSize-2,o=(0,tK.Bw)(r,f);if(o){n=(t=o.pos)+o.node.nodeSize;var i=e.content.find(function(e){var t;return(null===(t=e.attrs)||void 0===t?void 0:t.id)===f});if(!i){console.warn("[handleConfirm] Count not find card to use");return}e=i}console.log("[handleConfirm] contentToUse",{from:t,to:n,cardNode:o,contentToUse:e}),r.commands.command(function(o){return o.tr.replaceRangeWith(t,n,nu.NB.fromJSON(r.schema,e)),!0})}},[m,r,f,h]),v=(0,j.useCallback)((t=(0,t8.Z)(nt().mark(function e(t,n){return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a(),p(n),u(t.toJSON().content[0].content.filter(function(e){var t;return null===n||(null===(t=e.attrs)||void 0===t?void 0:t.id)===n}));case 4:case"end":return e.stop()}},e)})),function(e,n){return t.apply(this,arguments)}),[a]);return(0,j.useEffect)(function(){if(r)return nf.on("openSuggestionEditor",function(e){var t=e.cardId;console.log("CardSuggestionDrawer - openSuggestionEditor via button",{cardId:t}),v(r.view.state.doc,t)})},[r,v]),(0,ep.jsxs)(nn.d,{placement:"bottom",onClose:s,isOpen:i,trapFocus:!0,isFullHeight:!0,children:[(0,ep.jsx)(nr.Z,{}),(0,ep.jsxs)(no.s,{borderTopRadius:"xl",h:"calc(var(--100vh) - 24px)",sx:np.i,transform:"none !important",children:[(0,ep.jsx)(ni.o,{zIndex:"10",backgroundColor:"white",mr:2,shadow:"md"}),(0,ep.jsx)(ns.f,{p:0,h:"100%",children:l.length>0&&n?(0,ep.jsx)(np.$,{doc:n,cards:l,theme:o}):(0,ep.jsx)(nd.AA,{})}),(0,ep.jsx)(na.m,{borderTop:"1px solid #000",borderColor:"gray.200",children:(0,ep.jsxs)(nc.h,{spacing:4,children:[(0,ep.jsx)(ef.z,{variant:"ghost",onClick:s,children:"Cancel"}),(0,ep.jsx)(ef.z,{variant:"solid",onClick:g,children:"Confirm"})]})})]})]})}),nb=n(36959),nj=n(18256),nw=n(35396),nk=n(1533),nC=n(94659),nO=n(36895),nE=n(68650),nS=n(40394),nI={src:"/_next/static/media/Sal-Fishing-2x.1a2d0290.png",height:3130,width:5543,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAMAAABPT11nAAAAHlBMVEUgICAaGhoEBAQAAAAAAABxcXExMTFzc3O+vr7X19eY7njqAAAACnRSTlMBFNk1hTbA16G5FXEElwAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAACdJREFUeJxjYGNgZGRkZGBgYGcFkQwMDJwQioGBA0SA5EASzExMLAAFQgA3QJXpewAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:5},nP=n(19293),nD=n(31807),nT=n(82236),nA=n(43182),nR=function(e){return null==e?void 0:e.reduce(function(e,t){return!e||t.updatedTime>(null==e?void 0:e.updatedTime)?t:e},null)},nL=function(e){var t=nR(e.replies);return t?e.updatedTime>(null==t?void 0:t.updatedTime)?e.updatedTime:t.updatedTime:e.updatedTime},n_=function(e,t){var n=nR(e.replies),r=nR(t.replies),o=n?n.updatedTime:e.updatedTime,i=r?r.updatedTime:t.updatedTime;return o>i?-1:i>o?1:0},nZ="createdTime",nM=function(e){var t=e.items,n=e.sortBy,r=void 0===n?nZ:n,o=e.latestTimeGetterFn;return t.slice().sort(function(e,t){return"function"==typeof r?r(e,t):(0,nP.Z)((0,nD.Z)(e[r]),(0,nD.Z)(t[r]))}).reduce(function(e,t){var n=o?(0,nD.Z)(o(t)):(0,nD.Z)(t[nZ]),r=new Date;return(0,nT.Z)(n)?e.today=e.today.concat(t):1>(0,nA.Z)(r,n)?e.thisWeek=e.thisWeek.concat(t):e.earlier=e.earlier.concat(t),e},{today:[],thisWeek:[],earlier:[]})},nz=n(83906),nN=n(9088),nG=n(30893),nW=n(40771),nF=n(63849),nB=n(2575),nU=n(97907),nV=function(e){var t=e.count,n=e.onClose,r=e.commentStatusFilter,o=e.setCommentStatusFilter;return(0,ep.jsxs)(p.k,{width:"100%",px:6,py:4,justifyContent:"space-between",alignItems:"center",h:16,tabIndex:0,outline:"none",children:[(0,ep.jsx)(el.X,{size:"md",flex:1,noOfLines:1,children:"".concat(t," ").concat(1===t?"comment":"comments")}),(0,ep.jsxs)(nN.v,{closeOnSelect:!0,children:[(0,ep.jsx)(nG.j,{as:ef.z,size:"sm",rightIcon:(0,ep.jsx)(nz.v,{}),mr:8,children:(0,x.kC)(r)}),(0,ep.jsx)(nW.q,{zIndex:3,children:(0,ep.jsxs)(nF._,{defaultValue:r,title:"Filter by",type:"radio",children:[(0,ep.jsx)(nB.i,{onClick:function(){return o(k.Ux9.Open)},value:"open",children:"Open"}),(0,ep.jsx)(nB.i,{onClick:function(){return o(k.Ux9.Closed)},value:"closed",children:"Closed"})]})})]}),(0,ep.jsx)(nU.P,{position:"absolute",top:2,right:2,onClick:n,"data-comment-feed-close-button":!0})]})},nq=n(10530);function nH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function nY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nH(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nH(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var nK=function(e){var t=e.user,n=e.editor,r=(0,j.useState)(function(){var e=(0,nE.W1)(n,nq.Et);return e&&e.length?e[0]:(0,nE.xN)(function(){return nq.Et},n,"")}),o=r[0],i=r[1];(0,j.useEffect)(function(){if(o&&n)return function(){var e,t;null===(e=(t=n.commands).createDraftComment)||void 0===e||e.call(t,o)}},[o,n]);var s=(0,nE.iZ)({draftComment:o,clearDraftComment:function(){o&&(null===(r=(s=n.commands).removeDraftComments)||void 0===r||r.call(s,[o]));var e,t,r,s,a=(0,nE.xN)(function(){return nq.Et},n,"");null===(e=(t=n.commands).createDraftComment)||void 0===e||e.call(t,a),i(a)},editor:n}),a=(0,j.useCallback)(function(e){var t=e.editor;i(function(e){return e?nY(nY({},e),{},{json:t.view.state.doc.toJSON(),text:t.view.state.doc.textContent}):e})},[]);return(0,ep.jsx)(nE.Ag,{draftComment:o,user:t,onCommentDraftUpdate:a,onCommentSave:s,commentIdToHighlight:null})},nX=n(25206),nQ={today:"Today",thisWeek:"This week",earlier:"Older comments"},nJ=(a={},(0,S.Z)(a,k.Ux9.Open,"open"),(0,S.Z)(a,k.Ux9.Closed,"closed"),a),n$=function(e){var t,n=e.onClose,r=e.editor,o=(0,X.CG)(Q.yx),i=(0,k.$gs)().isConnected,s=(0,j.useState)(k.Ux9.Open),a=s[0],c=s[1],l=null==o?void 0:o.comments,u=null==o?void 0:null===(t=o.comments)||void 0===t?void 0:t.filter(function(e){return e.status===a}),d=(0,X.CG)(Q.gh),f=(0,t2.py)("comment",o)&&i,g=(0,t2.SE)().user,v=(0,C.$m)(o,g),y=(0,j.useMemo)(function(){return nM({items:u||[],sortBy:n_,latestTimeGetterFn:nL})},[u]);return l&&o&&r?(0,ep.jsxs)(p.k,{direction:"column",h:"100%",overflowX:"hidden",className:nS.G,w:"100%",children:[(0,ep.jsx)(nV,{commentStatusFilter:a,setCommentStatusFilter:c,count:(null==u?void 0:u.length)||0,onClose:n}),(0,ep.jsxs)(p.k,{direction:"column",className:"comments-list",flex:1,overflowY:"auto",tabIndex:0,outline:"none",children:[(0,ep.jsx)(nX.V,{label:"Comments will be available when you reconnect.",isConnected:i,mx:6}),v&&!g&&o&&(0,ep.jsx)(nE.IZ,{doc:o,accessLink:v}),f&&(0,ep.jsx)(m.xu,{px:6,py:2,children:(0,ep.jsx)(nK,{user:g,editor:r})}),!(null!=u&&u.length)&&(0,ep.jsxs)(nC.g,{align:"center",p:6,textAlign:"center",spacing:8,children:[(0,ep.jsx)(m.xu,{w:"80%",maxW:"300px",mb:6,alignContent:"center",children:(0,ep.jsx)(nO.E,{src:nI.src,width:"640px",alt:"Sal, the Gamma mascot, fishing extraterrestrially"})}),(0,ep.jsxs)(m.xu,{children:[(0,ep.jsxs)(el.X,{size:"xs",mb:2,children:["No ",nJ[a]," comments."]}),(0,ep.jsx)(h.x,{fontSize:"sm",children:"Try changing the filters."})]})]}),Object.entries(y).filter(function(e){return(0,I.Z)(e,2)[1].length}).map(function(e){var t=(0,I.Z)(e,2),i=t[0],s=t[1];return(0,ep.jsxs)(p.k,{direction:"column",children:[(0,ep.jsx)(x.NZ,{px:6,pt:4,pb:2,position:"sticky",top:-2,bg:"white",zIndex:2,children:nQ[i]}),(0,ep.jsx)(p.k,{direction:"column",children:s.map(function(e){return(0,ep.jsx)(nE.q5,{instanceType:"feed",userCanComment:f,editor:r,comment:e,selfUser:g,docId:null==o?void 0:o.id,editorMode:d,onClose:n,isRootComment:!0,pt:6,px:6,pb:4},e.id)})})]},i)})]})]}):null},n0=["closePanel"];function n1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?n1(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):n1(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var n5=function(e){var t=e.closePanel,n=(0,eF.Z)(e,n0),r=(0,nk._)().editor;return(0,j.useEffect)(function(){var e=function(e){e.open&&t()};return nw.pw.on(nw.TI.POPUP_COMMENT_TOGGLED,e),function(){nw.pw.on(nw.TI.POPUP_COMMENT_TOGGLED,e)}},[t]),(0,j.useEffect)(function(){return nb.F7.on("keydown","COMMENT_FEED_PANEL",function(e){return!!document.activeElement.closest('[data-panelid="comment-feed-panel"]')&&("Escape"===e.key&&t(),!0)})},[t]),(0,ep.jsx)(nj.s,n2(n2({},n),{},{bgColor:"white","data-panelid":"comment-feed-panel",children:(0,ep.jsx)(n$,{onClose:t,editor:r})}))};n5.panelPosition="right";var n3=n(87202),n6=n(69262),n4=n(64629),n9=n(38307),n7=n(75010),n8=n(86733),re=n(72360),rt=n(66724),rn=n(18751),rr=n(12683),ro=function(e){var t=e.onClose;return(0,ep.jsxs)(ec.K,{flex:1,align:"center",justify:"center",p:6,spacing:6,children:[(0,ep.jsx)(nO.E,{src:"https://cdn.gamma.app/zc87vhr30n8uf3n/b4b04402416f4ec8b5c1dc24f4c2a3d6/optimized/Sal-Spaceship-Riding.png",px:12}),(0,ep.jsx)(rr.K,{children:(0,ep.jsx)(h.x,{children:"Sorry, I'm currently at capacity. Check back later and I'll be ready to help."})}),(0,ep.jsx)(ef.z,{variant:"ghost",colorScheme:"blackAlpha",leftIcon:(0,ep.jsx)(v.G,{icon:n8.faXmark}),onClick:t,children:"Close chat"})]})},ri=function(){return(0,ep.jsxs)(re.b,{status:"warning",mt:12,minH:20,flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",borderRadius:"lg",borderWidth:"1px",children:[(0,ep.jsx)(rt.C,{children:"We're experiencing heavy load."}),(0,ep.jsx)(rn.X,{children:"Things might be a bit slow right now."})]})},rs=n(12677),ra=n(21891),rc=n(25793),rl=n(27191),ru=n(39775),rd=n(37857),rf=n(44907),rp=n(14018),rh="40px",rm=function(e){var t=e.value,n=e.onChange,r=e.onSubmit,o=e.isLoading,i=e.editor;e.resetMessages,(0,rp.F1)(i);var s=i.state,a=s.selection,c=s.doc.textBetween(a.from,a.to,"\n"),l=(0,rd.qO)().hasEnoughCreditsToChat,u=(0,rf.fg)(),d=(0,j.useRef)(null),f=(0,j.useState)(!1),p=f[0],m=f[1],g=a instanceof rl.qv,y=a instanceof rl.Bs,b=g&&"card"===a.node.type.name,w=a.empty||b?"Change this card":g?"Change this block":y&&c?'Change "'.concat(c.length>50?c.slice(0,50)+"...":c,'"'):"Ask a question",k=(0,j.useCallback)(function(){d.current&&(d.current.style.height=rh,d.current.style.height="".concat(d.current.scrollHeight,"px"))},[]);return(0,j.useEffect)(function(){return i.on("selectionUpdate",k),function(){i.off("selectionUpdate",k)}},[i,k]),(0,j.useEffect)(function(){p?k():setTimeout(function(){m(!0),k()},400)},[p,w,k,t]),(0,ep.jsxs)(es.U,{align:"end",children:[(0,ep.jsx)(ra.B,{size:"md",children:(0,ep.jsx)(rc.g,{"data-gamma-child-tiptap-editor":!0,id:"ai-chat-input",h:rh,minH:rh,ref:d,resize:"none",maxH:p?32:rh,bg:"white",shadow:"md",autoFocus:!0,isDisabled:!l,placeholder:w,value:t,onKeyPress:function(e){"Enter"===e.key&&t.length>0&&!o&&(e.preventDefault(),r())},onChange:function(e){return n(e.target.value)},pr:12})}),(0,ep.jsx)(x.kH,{placement:"top",label:(0,ep.jsxs)(nC.g,{spacing:0,children:[(0,ep.jsx)(h.x,{children:"Send request"}),!u&&(0,ep.jsxs)(h.x,{color:"gray.400",children:[(0,ep.jsx)(ru.J,{type:"chatSuggestion",ml:0})," if successful"]}),(0,ep.jsx)(x.f2,{shortcut:"Enter"})]}),children:(0,ep.jsx)(R.h,{"aria-label":"Send message",isDisabled:!t||o,size:"sm",h:rh,w:rh,variant:"solid",icon:(0,ep.jsx)(v.G,{icon:rs.Fz,fixedWidth:!0}),onClick:r})})]})},rg=n(76106),rv=n(97942),rx=n(12483),ry=n(42584),rb=n(4757),rj=n(60887),rw=n(86508),rk=n(50980),rC=n(27837),rO=[new(function(e){(0,N.Z)(i,e);var t,n,r,o=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,W.Z)(i);if(t){var r=(0,W.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,G.Z)(this,e)});function i(e){var t;return(0,Z.Z)(this,i),t=o.call(this,e),(0,S.Z)((0,z.Z)(t),"prompt",void 0),t.prompt=e.prompt,t}return(0,M.Z)(i,[{key:"runPrompt",value:(n=(0,t8.Z)(nt().mark(function e(t){var n,r,o,i,s,a,c;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.input,r=t.context,o=t.variables,i=t.trackFns,a=void 0===(s=t.retries)?2:s,e.next=3,(0,rb.Ii)(n,r.interactionId,{timeout:rw.VH.get("aiRequestTimeouts").basicReply});case 3:if(c=e.sent){e.next=6;break}throw Error("Couldn't get response from prompt");case 6:if(!((0,rk.y)(c)||null!=c&&c.includes("```"))){e.next=11;break}if(!(a<=0)){e.next=9;break}throw new ry.eo("Did not receive proper response after retries",{chatMessage:"Sorry, I am having trouble understanding. Could you try asking in a different way?",inputMessage:r.message,resp:c,interactionId:r.interactionId});case 9:return i.trackRequestRetry({interactionId:r.interactionId,retriesRemaining:a,resp:c}),e.abrupt("return",this.runPrompt({input:n,context:r,variables:o,trackFns:i,retries:a-1}));case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"run",value:(r=(0,t8.Z)(nt().mark(function e(t){var n,r,o,i,s,a,c,l,u;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.context,r=t.addMessage,o=t.history,i=t.trackFns,s=t.provider,a={message:n.message},c=(0,rC.x)(o||[]),l=this.prompt.generate({variables:a,history:c,params:{provider:s},interactionId:n.interactionId}),e.next=6,this.runPrompt({input:l,context:n,variables:a,trackFns:i,retries:1});case 6:u=e.sent,i.trackRequestComplete({taskContext:n,outputMessage:u}),r({from:"Designer",type:"text",message:u,resp:u,interactionId:n.interactionId});case 9:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})}]),i}(rj.B))({key:"CHAT",description:"A general chat message, or a request that doesn't fit any of the previous categories",classifyExamples:["hi how are you","hdfoho;safjw","help there are bees everywhere","great job!","this looks ugly"],prompt:new rb.TL({systemPrompt:"",systemPromptOperation:{operation:k.Run.BasicReplyChatSystem,length:1847,variables:[]},userPrompt:"",userPromptOperation:{operation:k.Run.BasicReplyChatUser,length:66,variables:["message"]},variables:["message"],openAiParams:{maxTokens:150,temperature:0}})})],rE=function(e){return rO.find(function(t){return t.key===e})},rS=function(e){return!!rO.find(function(t){return t.key===e})},rI=n(12741),rP=n(19165),rD=n(34275),rT=n(38737),rA=n(54220),rR=n(9850),rL=n.n(rR),r_=n(11625),rZ=n(98593),rM=n(77141),rz=function(){function e(t){(0,Z.Z)(this,e),(0,S.Z)(this,"type","insert-card"),(0,S.Z)(this,"description",void 0),(0,S.Z)(this,"cardId",void 0),(0,S.Z)(this,"afterCardId",void 0),(0,S.Z)(this,"content",void 0),this.description=t.description,this.cardId=t.cardId,this.afterCardId=t.afterCardId,this.content=t.content}return(0,M.Z)(e,[{key:"isApplied",value:function(e){return!!(0,tK.Bw)(e,this.cardId)}},{key:"getPreviewJson",value:function(e){var t=e.state.tr;this.transact(e,t);var n=rL()(t.doc.toJSON());return(0,rM.Y0)(n,this.cardId)}},{key:"apply",value:function(e){if(this.isApplied(e)){console.debug("[InsertCardModification] NOT applying modification, card already exists with cardId=".concat(this.cardId),{modification:this});return}var t=e.state.tr;this.transact(e,t),console.debug("[InsertCardModification] Applying modification",{modification:this}),e.view.dispatch(t),(0,r_.YS)({editor:e,cardId:this.cardId})}},{key:"transact",value:function(e,t){var n=(0,tK.Bw)(e,this.afterCardId);if(!n)return null;var r=(0,rM.Fr)(e,this.content),o=n.pos+n.node.nodeSize;t.insert(o,r.content.firstChild);var i=(0,rZ.t)(t.doc.resolve(o),1);return t.setSelection(i),{from:o,to:o+t.doc.nodeAt(o).nodeSize}}},{key:"getContentForTracking",value:function(){return this.content}}]),e}(),rN=function(){function e(t){(0,Z.Z)(this,e),(0,S.Z)(this,"type","remove-card"),(0,S.Z)(this,"description",void 0),(0,S.Z)(this,"cardId",void 0),this.description=t.description,this.cardId=t.cardId}return(0,M.Z)(e,[{key:"isApplied",value:function(e){return!(0,tK.Bw)(e,this.cardId)}},{key:"getPreviewJson",value:function(e){return null}},{key:"apply",value:function(e){var t=e.state.tr,n=(0,tK.Bw)(e,this.cardId);n&&(t.delete(n.pos,n.pos+n.node.nodeSize),console.debug("[RemoveCardModification] Applying modification",{modification:this}),e.view.dispatch(t))}},{key:"getContentForTracking",value:function(){return this.cardId}}]),e}(),rG=n(17087),rW=function(e){(0,N.Z)(o,e);var t,n,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,W.Z)(o);if(t){var r=(0,W.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,G.Z)(this,e)});function o(){return(0,Z.Z)(this,o),r.apply(this,arguments)}return(0,M.Z)(o,[{key:"getResponseMessages",value:(n=(0,t8.Z)(nt().mark(function e(t){var n,r,o,i,s,a,c,l,u,d,f,p,h,m;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.editor,r=t.context,i=(o=t.response).suggestion,s=o.message,a=o.raw,i){e.next=3;break}throw new ry.$D("No card content returned",{interactionId:r.interactionId,resp:a,chatMessage:s||rG.az,inputMessage:r.message});case 3:return e.next=5,(0,rP.y)(i);case 5:return c=e.sent.content,l=rA.C2.generate(),u=(0,rT.S)({bodyContent:c.toJSON(),index:1,format:rD.Z,theme:r.editorContext.theme,cardId:l}),m={from:"Designer",type:"suggestContent",resp:a,message:s||"How about this?",suggestions:[f={label:"New card",modification:d=new rz({description:"New Card",content:{type:"json",json:[u]},cardId:l,afterCardId:r.editorContext.card.cardId}),jsonContentPreview:d.getPreviewJson(n)},h={label:"Remove card",modification:p=new rN({description:"Remove card",cardId:l}),jsonContentPreview:p.getPreviewJson(n)}],interactionId:r.interactionId},console.debug("[addCard]",{insert:f,remove:h,message:s,html:i,cardLayout:u,content:c}),e.abrupt("return",{messages:[m],suggestionToApply:f});case 16:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})}]),o}(rG.w6),rF=new rb.TL({systemPrompt:"",systemPromptOperation:{operation:k.Run.AddCardSystem,length:5919,variables:[]},userPrompt:"",userPromptOperation:{operation:k.Run.AddCardUser,length:334,variables:["html","message","outline"]},variables:["html","message","outline"],openAiParams:{temperature:.7,maxTokens:1e3}}),rB=new rW({key:"ADD_CARD",description:"Add a new card after the current one",classifyExamples:["add a new slide","add a card describing our mission","i want a new section for leadership development","make another card","on a new card compare the two options in a table"],classifyReply:"Ok, I'll start writing a new card...",prompt:rF}),rU=n(90801),rV=function(){function e(t){(0,Z.Z)(this,e),(0,S.Z)(this,"type","set-card-layout"),(0,S.Z)(this,"description",void 0),(0,S.Z)(this,"cardId",void 0),(0,S.Z)(this,"layout",void 0),this.description=t.description,this.cardId=t.cardId,this.layout=t.layout}return(0,M.Z)(e,[{key:"isApplied",value:function(e){var t=(0,tK.Bw)(e,this.cardId);return t?t.node.attrs.layout===this.layout:(console.error("[SetCardLayoutModification.apply] Could not find card to update: ".concat(this.cardId,", maybe deleted")),!1)}},{key:"getPreviewJson",value:function(e){var t=e.state.tr;this.transact(e,t);var n=rL()(t.doc.toJSON()),r=(0,rM.Y0)(n,this.cardId);return console.debug("[SetCardLayoutModification.getPreviewJson] result",r),r}},{key:"apply",value:function(e){if(this.isApplied(e)){console.debug("[SetCardLayoutModification] NOT applying modification, card already has layout=".concat(this.layout),{modification:this});return}var t=e.state.tr;this.transact(e,t),console.debug("[SetCardLayoutModification] Applying modification",{modification:this}),e.view.dispatch(t),(0,r_.YS)({editor:e,cardId:this.cardId})}},{key:"transact",value:function(e,t){var n=(0,tK.Bw)(e,this.cardId);if(!n){console.error("[SetCardLayoutModification.apply] Could not find card to update: ".concat(this.cardId,", maybe deleted"));return}(0,rU.G)(e,t,n.pos,this.layout)}},{key:"getContentForTracking",value:function(){return this.layout}}]),e}(),rq="Sorry, I wasn't able to do that. You can change the card layout yourself by clicking in the top left corner of the card.",rH=new(function(e){(0,N.Z)(o,e);var t,n,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,W.Z)(o);if(t){var r=(0,W.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,G.Z)(this,e)});function o(){return(0,Z.Z)(this,o),r.apply(this,arguments)}return(0,M.Z)(o,[{key:"getResponseMessages",value:(n=(0,t8.Z)(nt().mark(function e(t){var n,r,o,i,s,a,c,l,u,d,f;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.editor,r=t.context,t.rangeId,i=(o=t.response).suggestion,s=o.raw,a=o.message,i){e.next=3;break}throw new ry.$D("No card layout returned",{resp:s,chatMessage:rq,inputMessage:r.message,interactionId:r.interactionId});case 3:if((0,tK.ol)(i)){e.next=6;break}throw console.error("Invalid card layout:",i),new ry.$D("Invalid card layout: ".concat(i),{resp:s,chatMessage:rq,inputMessage:r.message,interactionId:r.interactionId});case 6:return l={label:"Suggested",modification:c=new rV({description:"Suggested",cardId:r.editorContext.card.cardId,layout:i}),jsonContentPreview:c.getPreviewJson(n)},d={label:"Original",modification:u=new rV({description:"Original",cardId:r.editorContext.card.cardId,layout:r.editorContext.card.attrs.layout}),jsonContentPreview:u.getPreviewJson(n)},f={from:"Designer",type:"suggestContent",resp:s,message:a||"How about this?",interactionId:r.interactionId,suggestions:[l,d]},e.abrupt("return",{messages:[f],suggestionToApply:l});case 12:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})}]),o}(rG.w6))({key:"MOVE_ACCENT_IMAGE",description:"Move or remove the accent image of the card. Use ADD_IMAGE to add accent images.",classifyExamples:["move the sand dune to the left","remove the cover photo"],classifyReply:"Ok, I will move the accent image to the left...",getTaskTarget:function(e){return e.card},prompt:new rb.TL({systemPrompt:"",systemPromptOperation:{operation:k.Run.ChangeAccentImageLayoutSystem,length:2286,variables:[]},userPrompt:"",userPromptOperation:{operation:k.Run.ChangeAccentImageLayoutUser,length:197,variables:["html","message"]},variables:["html","message"],openAiParams:{temperature:.2,maxTokens:100}}),checkEnabled:function(e){return"blank"!==e.card.attrs.layout}}),rY=new rb.TL({systemPrompt:"",systemPromptOperation:{operation:k.Run.ChangeContentSystem,length:5699,variables:[]},userPrompt:"",userPromptOperation:{operation:k.Run.ChangeContentUser,length:149,variables:["html","message","outline"]},variables:["html","message","outline"],openAiParams:{temperature:.7,maxTokens:1e3}}),rK=new rG.w6({key:"CHANGE_CONTENT",description:"Rephrase, summarize, expand, change text formatting, add content, or express ideas differently.",classifyExamples:["condense this to just the key points","say this like a pirate","make this more formal","add a box about health benefits","add more text please","make the bullets red","make the text bigger","fill in the last  column","write something about ___","add ___ to the table"],classifyReply:"Ok, I'll try making it shorter...",prompt:rY}),rX=new rG.w6({key:"CHANGE_LAYOUT",description:"Change the display of information to use a different layout (like timeline, bullets, boxes, columns, table) or rearrange elements within a layout",classifyExamples:["turn this into a table","make each bullet into a box","could you split this into columns?","make this a timeline","could you make this more visual?","visualize this as a timeline"],classifyReply:"Sure, I'll start reformatting this as a table...",getTaskTarget:function(e){return"selectionRange"!==e.selectedDefaultRange?e.defaultRange:0===e.selectionRange.html.trim().length?e.cardContent:e.blockRange},prompt:new rb.TL({systemPrompt:"",systemPromptOperation:{operation:k.Run.ChangeContentLayoutSystem,length:6886,variables:[]},userPrompt:"",userPromptOperation:{operation:k.Run.ChangeContentLayoutUser,length:154,variables:["html","message"]},variables:["html","message"],openAiParams:{temperature:.7,maxTokens:1e3}})}),rQ=n(43433),rJ=n(58609),r$=n(64501),r0=new rb.TL({systemPrompt:"",systemPromptOperation:{operation:k.Run.RateImagesSystem,length:1608,variables:[]},userPrompt:"",userPromptOperation:{operation:k.Run.RateImagesUser,length:151,variables:["dataset"]},variables:["dataset"],openAiParams:{temperature:.1,maxTokens:100}}),r1=(r=(0,t8.Z)(nt().mark(function e(t,n){var r,o,i;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.map(function(e,t){var n=e.description,r=e.query;return"".concat(t+1,": ").concat(n,": ").concat(r)}).join("\n"),o=r0.generate({variables:{dataset:r},history:[],interactionId:n}),e.next=4,(0,rb.Ii)(o,n,{timeout:rw.VH.get("aiRequestTimeouts").rateImages});case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0="";case 7:return i=e.t0,e.abrupt("return",i.split("\n").map(function(e){var t=e.split("-");return Number((0,I.Z)(t,2)[1].trim())}));case 9:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});function r2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function r5(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r2(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r2(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var r3={GOOGLE:"google",UNSPLASH:"unsplash",GIPHY:"giphy"},r6=new(function(e){(0,N.Z)(i,e);var t,n,r,o=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,W.Z)(i);if(t){var r=(0,W.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,G.Z)(this,e)});function i(){return(0,Z.Z)(this,i),o.apply(this,arguments)}return(0,M.Z)(i,[{key:"getResponseData",value:(n=(0,t8.Z)(nt().mark(function e(t,n){var r,o,i,s;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.replaceAll(this.key,"").split("\n").map(function(){var e=(0,t8.Z)(nt().mark(function e(t){var n,r,o,i,s,a,c;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.split(": "),o=(r=(0,I.Z)(n,2))[0],i=r[1].split(",").map(function(e){return e.trim()}).slice(0,2),a="google"===(s=r3[o.trim()]||"bing")?"bing":s,e.next=6,(0,rQ.JA)({queries:i,count:rJ.x.count,provider:a,prefetch:!0,options:{gammaFeature:"aiChat"}});case 6:return c=e.sent,e.abrupt("return",c);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:return console.debug("[SuggestImagesTask][getResponseData] allResults",r=e.sent.flat()),console.debug("[SuggestImagesTask][imageRatingData]",{imagesToRate:o=r.map(function(e){var t=e.image,n=e.query,r=e.provider,o=(0,r$.C)(t,n,r);return{description:(0,r$.K)(o)||"",query:n}})}),e.prev=6,e.next=9,r1(o,n);case 9:if(console.debug("[SuggestImagesTask][imageRatingValues]",{imageRatingValues:i=e.sent}),!(i.length!==r.length)){e.next=13;break}throw Error("Image rating values length does not match allResults length");case 13:return console.debug("[SuggestImagesTask][allResultsSorted]",{allResultsSorted:s=r.map(function(e,t){return r5(r5({},e),{},{rating:i[t]})}).sort(function(e,t){return t.rating-e.rating})}),e.abrupt("return",s);case 19:e.prev=19,e.t0=e.catch(6),console.warn("[SuggestImagesTask] Error rating images. Returing unsorted results.",e.t0);case 22:return e.abrupt("return",r);case 23:case"end":return e.stop()}},e,this,[[6,19]])})),function(e,t){return n.apply(this,arguments)})},{key:"getResponseMessages",value:(r=(0,t8.Z)(nt().mark(function e(t){var n,r,o,i,s,a;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.context,o=(r=t.response).message,i=r.raw,s=r.suggestion){e.next=3;break}throw new ry.$D("No image results were returned",{resp:i,inputMessage:n.message,chatMessage:o||"I'm sorry, I wasn't able to find any images for this.",interactionId:n.interactionId});case 3:return e.next=5,this.getResponseData(s,n.interactionId);case 5:return a={from:"Designer",type:"suggestImages",suggestions:e.sent,resp:i,interactionId:n.interactionId,message:o||"Here are some suggestions:"},e.abrupt("return",{messages:[a]});case 8:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})}]),i}(rG.w6))({key:"ADD_IMAGE",description:"Add images, or replace an existing image. Do not use for moving or removing images.",classifyExamples:["add a picture of a bus","find some different images","this needs a pic","show me dolphins","find a meme of stonks","give me more images","add a background image","i need a graph of population over time"],classifyReply:"Let me look for some good bus pictures...",getTaskTarget:function(e){return e.defaultRange},prompt:new rb.TL({systemPrompt:"",systemPromptOperation:{operation:k.Run.SuggestImagesSystem,length:3808,variables:[]},userPrompt:"",userPromptOperation:{operation:k.Run.SuggestImagesUser,length:543,variables:["html","message"]},variables:["html","message"],openAiParams:{temperature:.7,maxTokens:500}})}),r4=n(77739);function r9(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function r7(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r9(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r9(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function r8(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var oe=new(function(e){(0,N.Z)(o,e);var t,n,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,W.Z)(o);if(t){var r=(0,W.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,G.Z)(this,e)});function o(){return(0,Z.Z)(this,o),r.apply(this,arguments)}return(0,M.Z)(o,[{key:"getResponseData",value:function(e){var t,n=[],r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r8(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r8(e,t)}}(e))){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}(e.matchAll(/^\/\/\s*(.*)$\n(.*)$/gm));try{for(r.s();!(t=r.n()).done;){var o=t.value,i=o[1],s=o[2];n.push({reason:i,value:s})}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"getResponseMessages",value:(n=(0,t8.Z)(nt().mark(function e(t){var n,r,o,i,s,a,c,l,u,d,f,p;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.editor,r=t.context,o=t.rangeId,s=(i=t.response).suggestion,a=i.message,c=i.raw,s){e.next=3;break}throw new ry.$D("No suggestions found in response",{interactionId:r.interactionId,inputMessage:r.message,chatMessage:a||"I'm sorry, I wasn't able think of any suggestions. Could you try asking in a different way?"});case 3:return l=this.getResponseData(s).map(function(e){var t=new r4.O(n,{description:e.reason,content:{type:"html",html:e.value},rangeId:o});return r7(r7({},e),{},{modification:t})}),u=this.determineTaskTarget(r.editorContext).html,d=new r4.O(n,{description:"Original",content:{type:"html",html:u},rangeId:o}),f={reason:"Original",value:u,modification:d},p={from:"Designer",type:"suggestText",message:a||"Here are some suggestions:",resp:c,suggestions:[].concat((0,rI.Z)(l),[f]),interactionId:r.interactionId},e.abrupt("return",{messages:[p]});case 10:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]),o}(rG.w6))({key:"SUGGEST_TEXT",description:"Open-ended request to rephrase a sentence or paragraph",classifyExamples:["write a better headline","How else could i say this?","this feels too corporate","suggest a more engaging way to say this","give me a more interesting description"],classifyReply:"Let me think of some other headlines...",getTaskTarget:function(e){return e.selectionRange},prompt:new rb.TL({systemPrompt:"",systemPromptOperation:{operation:k.Run.SuggestTextSystem,length:2158,variables:[]},userPrompt:"",userPromptOperation:{operation:k.Run.SuggestTextUser,length:331,variables:["html","message"]},variables:["html","message"],openAiParams:{temperature:.7,maxTokens:1e3}}),checkEnabled:function(e){var t=e.selection,n=t instanceof rl.Bs,r=t.$from.parent.eq(t.$to.parent);return n&&!t.empty&&t.to-t.from<800&&r}}),ot=function(){function e(t,n){(0,Z.Z)(this,e),(0,S.Z)(this,"type","change-theme"),(0,S.Z)(this,"description",void 0),(0,S.Z)(this,"themeId",void 0),this.description=n.description,this.themeId=n.themeId}return(0,M.Z)(e,[{key:"apply",value:function(e,t){t.setThemeWithAccentImages(this.themeId)}},{key:"isApplied",value:function(e,t){return t.isThemeApplied(this.themeId)}},{key:"getPreviewJson",value:function(){return null}},{key:"getContentForTracking",value:function(){return this.themeId}}]),e}(),on=function(e){(0,N.Z)(i,e);var t,n,r,o=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,W.Z)(i);if(t){var r=(0,W.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,G.Z)(this,e)});function i(){return(0,Z.Z)(this,i),o.apply(this,arguments)}return(0,M.Z)(i,[{key:"getResponseMessages",value:(n=(0,t8.Z)(nt().mark(function e(t){var n,r,o,i,s,a,c,l,u,d,f,p,h;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.editor,r=t.context,i=(o=t.response).raw,s=o.suggestion,a=o.message,l=(c=t.themeModificationController).currentThemeId,u=c.isValidTheme,d=null==s?void 0:s.split("\n"),e.next=5,this.getFilteredSuggestions({ids:d,idToRemove:l,editor:n,isValid:u});case 5:if(0!==(f=e.sent).length){e.next=8;break}throw new ry.$D("[SuggestContentTask] No themes provided in prompt response",{resp:i,chatMessage:"I'm sorry, I wasn't able to find any themes for this.",inputMessage:r.message,interactionId:r.interactionId});case 8:return p={label:"Original",themeId:l,modification:new ot(n,{description:"Original",themeId:l})},h={from:"Designer",type:"suggestThemes",resp:i,message:a||"How about this?",suggestions:[].concat((0,rI.Z)(f),[p]),interactionId:r.interactionId},e.abrupt("return",{messages:[h],suggestionToApply:f[0]});case 11:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"getFilteredSuggestions",value:(r=(0,t8.Z)(nt().mark(function e(t){var n,r,o,i,s;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.ids,r=t.idToRemove,o=t.editor,i=t.isValid,!(!n||0===n.length)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,Promise.all(n.map(function(e){return i(e).then(function(t){return t?e:null})}));case 5:return s=e.sent.filter(function(e){return null!==e}).filter(function(e){return e!==r}).map(function(e){var t=new ot(o,{description:"Suggested",themeId:e});return{label:"Suggested",themeId:e,modification:t}}),e.abrupt("return",s);case 8:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})}]),i}(rG.w6),or=new rb.TL({systemPrompt:"",systemPromptOperation:{operation:k.Run.SuggestThemeSystem,length:10054,variables:[]},userPrompt:"",userPromptOperation:{operation:k.Run.SuggestThemeUser,length:161,variables:["html","message","outline"]},variables:["html","message","outline"],openAiParams:{temperature:.7,maxTokens:100,model:"gpt-4"}}),oo=[rH,rX,rK,oe,r6,rB,new on({key:"SUGGEST_THEME",description:"Suggest a theme for the deck. This task will suggest themes based on the deck content or the prompt",classifyExamples:["change the theme","give me a blue theme","change the color palette","make this a dark theme","use a more colorful theme","let's change the look and the feel","change the theme to lilac and periwinkle","i'd like it to look more cheerful and welcoming"],classifyReply:"Let me find some themes...",prompt:or})],oi=function(e){return oo.find(function(t){return t.key===e})},os=function(e){return!!oo.find(function(t){return t.key===e})},oa=function(e){(0,N.Z)(o,e);var t,n,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,W.Z)(o);if(t){var r=(0,W.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,G.Z)(this,e)});function o(e){var t;return(0,Z.Z)(this,o),t=r.call(this,e),(0,S.Z)((0,z.Z)(t),"apology",void 0),(0,S.Z)((0,z.Z)(t),"apologyLink",void 0),t.apology=e.apology,t.apologyLink=e.apologyLink,t}return(0,M.Z)(o,[{key:"run",value:(n=(0,t8.Z)(nt().mark(function e(t){var n,r,o,i;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.classificationResult,r=t.addMessage,o=t.context,i=t.trackFns,r({from:"Designer",type:"unsupported",task:n.classification,message:this.apology,learnMoreLink:this.apologyLink,resp:n.resp,interactionId:o.interactionId}),i.trackRequestComplete({taskContext:o,outputMessage:this.apology});case 3:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]),o}(rj.B),oc=new oa({key:"CHANGE_CARD_BACKGROUND",description:"Change the background of the entire section.",classifyExamples:["make the background red","put a tunnel in the background","remove the background","get rid of the image in the background"],apology:"Sorry, I can't change backgrounds yet, but you can click on a card and change the background yourself. You can also change the doc background by clicking the Theme button."}),ol=new oa({key:"CHANGE_FONT",description:"Change the font family or font style.",classifyExamples:["give me a more playful font","make the headings use arial","change the font to be more readable"],apology:"Sorry, I can't change fonts yet. But you can edit them yourself by creating a custom theme.",apologyLink:"https://gamma.app/public/o2he6ual8noal7u#card-82e40n78edir2x8"}),ou=new oa({key:"RESIZE_IMAGE",description:"Change the size of an image (its dimensions), or crop an image",classifyExamples:["make the image smaller","can you make the cat bigger","crop it so it's just the face","I want the disposition of the photos for more portrait instead of landscape"],apology:"Sorry, I can't resize images yet. But you can do it yourself by clicking on the image and dragging the boxes on the corners, or pressing the crop button above the image."}),od=new oa({key:"EXPORT",description:"Export or download the deck into a different a format.",classifyExamples:["download as ppt","make a pdf","export to google slides"],apology:"Sorry, I can't export files yet. However, you can download a PDF yourself by using the Share menu."}),of=new oa({key:"SPLIT_CARD",description:"Split a card into multiple cards, or move content between cards.",classifyExamples:["break this into two cards","split this up as multiple slides","put the gallery on the next card"],apology:"Sorry, I can't split cards or move things between them yet. However, you can split cards yourself by typing /split inside a card."}),op=new oa({key:"NEW_DECK",description:"Create a whole new deck",classifyExamples:["i need a presentation about [topic]","write a whole document about animal","make me a landing page about this"],apology:"To make a new deck, go back to the home screen and click New with AI."}),oh=new oa({key:"CHANGE_MULTIPLE_CARDS",description:"Make changes across multiple cards at once",classifyExamples:["I want this entire deck to be summarized","combine the cards together in one","make the whole doc sound more professional","make the deck more consistent"],apology:"Sorry, I can only change one card at a time right now."}),om=new oa({key:"ADD_VIDEO",description:"Add a video or replace an existing video",classifyExamples:["add a youtube video about scrum","find videos of cats","i need more videos"],apology:"Sorry, I can't search for videos yet. You can embed video by copying the URL and pasting it into the card directly."}),og=new oa({key:"ADD_FOOTNOTE",description:"Add a footnote to a card, or change footnotes",classifyExamples:["add a biography for him in a footnote","put the details into footnotes"],apology:"Sorry, I haven't learned to add footnotes yet. You can make footnotes by highlighting text and clicking the footnote button in the menu."}),ov=[oc,ol,ou,od,of,new oa({key:"MOVE_CARD",description:"Move a card to a different position in the deck",classifyExamples:["shift the slide to the top","move this card to the bottom"],apology:"Sorry, I haven't learned to move cards yet. You can move them by hovering on the table of contents on the left side of the screen and dragging them around."}),op,oh,om,og,new oa({key:"ADD_CHART",description:"Add a chart, diagram, or graph",classifyExamples:["put this information into a scatter plot","add a card about market share using a pie chart","i need to display this as a flow chart","create a diagram illustrating the interactions and relationships","can you change the card to have a line graph","turn this into a gantt chart","could you do this as a funnel diagram"],apology:"Sorry, Gamma doesn't support charts yet. You can paste in images of charts from other tools, or type /diagram in the editor to draw your own."}),new oa({key:"ANIMATION",description:"Add animations to a card or edit animations",classifyExamples:["animate transitions","make the text appear one by one","fade in the images","make the bullets fly in"],apology:'Sorry, Gamma doesn\'t support custom animations yet. You can animate line by line by going into Present mode and pressing S for "spotlight".'}),new oa({key:"FOLLOW_LINK",description:"Read content from an external website",classifyExamples:["go to this website and add the content to this card http://www.example.com/","here is his linkedin page now add the details https://www.linkedin.com/...","add the images from https://medium.com/posts/2022/9/6/..."],apology:"Sorry, I'm not able to open links and read the content."})],ox=function(e){return ov.find(function(t){return t.key===e})},oy=new rb.TL({variables:["message","taskList","ackExamples","html","cardHtml"],systemPrompt:"",systemPromptOperation:{operation:k.Run.ClassifySystem,length:2118,variables:["taskList","ackExamples"]},userPrompt:"",userPromptOperation:{operation:k.Run.ClassifyUser,length:339,variables:["message","html","cardHtml"]},openAiParams:{maxTokens:100,temperature:.2}}),ob=[].concat((0,rI.Z)(oo),(0,rI.Z)(ov),(0,rI.Z)(rO)),oj="\uD83D\uDE14 Sorry, I didn't understand your request. Could you please try asking a different way?",ow=(o=(0,t8.Z)(nt().mark(function e(t){var n,r,o,i,s,a,c,l,u,d,f,p;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.message,r=t.context,o=t.history,i=t.provider,a=(s=oO(ob,r.editorContext)).ackExamples,c=s.taskList,l=s.enabledTasks,u=oE(o),d=oy.generate({variables:{message:n,ackExamples:a,taskList:c,html:r.editorContext.defaultRange.html,cardHtml:r.editorContext.card.html},params:{provider:i},history:u,interactionId:r.interactionId}),console.debug("[AIChat classify] Getting classification",{classifyHistory:u,input:d}),e.next=7,(0,rb.Ii)(d,r.interactionId,{timeout:n6.VH.get("aiRequestTimeouts").classify});case 7:if(p=oC(f=e.sent,l)){e.next=15;break}return console.debug("Failed classification, trying again...",{resp:f,parsedResp:p}),e.next=13,(0,rb.Ii)(d);case 13:p=oC(f=e.sent,l);case 15:if(p){e.next=17;break}return e.abrupt("return",{type:"UNKNOWN",classification:"UNKNOWN",ack:oj,resp:f||""});case 17:return console.debug("[AIChat classify] Got classification",{resp:f,parsedResp:p}),e.abrupt("return",p);case 19:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)}),ok="Ok, I'll get right on it.",oC=function(e,t){if(e){var n,r=e.split("\n"),o=null===(n=r[0])||void 0===n?void 0:n.trim().toUpperCase();if(t.find(function(e){return e.key===o})){var i=r[1];return{classification:o.trim(),ack:i.includes(o.trim())?ok:i||("UNKNOWN"!==o?ok:oj),resp:e,type:"CLASSIFICATION"}}}},oO=function(e,t){var n=e.filter(function(e){return!t||!e.checkEnabled||e.checkEnabled(t)});return{taskList:n.map(function(e){var t;return"".concat(e.key,": ").concat(e.description,"\n").concat(null===(t=e.classifyExamples)||void 0===t?void 0:t.map(function(e){return"- ".concat(e)}).join("\n"))}).join("\n\n"),ackExamples:n.filter(function(e){return e.classifyExamples&&e.classifyExamples.length>0&&e.classifyReply}).map(function(e){return"Request:\n".concat(e.classifyExamples[0],"\nResponse:\n").concat([e.key,e.classifyReply].join("\n"))}).join("\n\n"),enabledTasks:n}},oE=function(e){return e.slice(-7).map(function(e){return"User"===e.from?{role:k.XaP.User,content:e.message}:e.isClassification?{role:k.XaP.Assistant,content:e.resp}:null}).filter(function(e){return Boolean(e)})},oS=n(53941),oI=n(83476),oP=n(49350),oD=n(6608),oT=n(69479),oA=n(50),oR=n(93689),oL=function(e,t){var n=e.state.doc.slice(t.from,t.to).content;return(0,oD.c)(e,n)},o_=function(e,t){var n=e.state.selection,r=(0,oA.Ru)(n.$from,tK.KH)[0],o=r&&(0,n7.NE)(r.node,r.pos);if(!r||!o)throw Error("Cant find parent card for selection ".concat(n));var i={from:r.pos,to:r.pos+r.node.nodeSize},s={from:o.pos+1,to:o.pos+o.node.nodeSize-1},a=n.$from.blockRange(n.$to),c={from:a.start,to:a.end},l={range:(0,oR.bb)(e.state,s),html:oL(e,s)},u={range:(0,oR.bb)(e.state,n),html:oL(e,n)},d={range:(0,oR.bb)(e.state,c),html:oL(e,c)},f=n instanceof rl.qv&&(0,tK.KH)(n.node)||n.empty||0===u.html.trim().length||n instanceof rl.qv&&n.node.isAtom,p=!n.$from.parent.eq(n.$to.parent)||0===a.$from.parentOffset&&a.$to.parentOffset===a.$to.parent.content.size,h=u,m="selectionRange";f?(h=l,m="cardContent"):p&&(h=d,m="blockRange");var g=oZ(t),v=(0,Q.Pu)(t.getState());return{card:{cardId:r.node.attrs.id,range:(0,oR.bb)(e.state,i),html:oL(e,i),attrs:r.node.attrs},cardContent:l,blockRange:d,selectionRange:u,defaultRange:h,selection:n,outline:g,selectedDefaultRange:m,theme:v}},oZ=function(e){var t=e.getState(),n=(0,Q.X9)(t),r=(0,oT.mT)(t);return Object.keys(n.tree).map(function(e){var t;return null===(t=r.find(function(t){return t.id===e}))||void 0===t?void 0:t.title}).filter(function(e){return Boolean(e)}).join("\n")},oM=n(8369),oz=function(e){var t,n=e.editor,r=e.addMessage,o=e.getMessageHistory,i=(0,j.useState)("idle"),s=i[0],a=i[1],c=(0,X.qr)(),l=(0,oM.E)(),u=(0,rd.Bg)().deductCredits,d=(0,rd.qO)().hasEnoughCreditsToChat,f=(0,oI.T)(),p=(0,oP.g5)();return{sendMessage:(0,j.useCallback)((t=(0,t8.Z)(nt().mark(function e(t){var i,s,h,m,g,v,x,y,b,j,w,k,C;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.message,n){e.next=3;break}return e.abrupt("return");case 3:if(s=void 0,h=void 0,m=void 0,g=(0,oS.nZ)(),e.prev=7,s=o_(n,c),console.debug("[AIChat] starting interaction",h={interactionId:g,startTime:performance.now(),message:i,editorContext:s,docId:n.gammaDocId}),v=o(),r({from:"User",type:"text",message:i,interactionId:g}),l.trackRequestSent(h,p),d){e.next=16;break}return e.abrupt("return");case 16:return a("classifying"),e.next=19,ow({message:i,context:h,history:v,provider:p});case 19:if(x=e.sent,l.trackClassification({taskContext:h,classification:x.classification}),a("fetching"),console.debug("[AIChat] Starting task",{taskContext:h,classification:x.classification,history:v}),"UNKNOWN"!==x.type){e.next=28;break}r({from:"Designer",type:"text",message:x.ack,resp:x.resp,isClassification:!0,interactionId:g}),l.trackRequestComplete({taskContext:h,outputMessage:x.ack}),e.next=47;break;case 28:if(!rS(x.classification)){e.next=34;break}return y=rE(x.classification),e.next=32,y.run({editor:n,addMessage:r,context:h,classificationResult:x,history:v,trackFns:l,themeModificationController:f,provider:p});case 32:case 38:e.next=47;break;case 34:if(!ox(x.classification)){e.next=40;break}return b=ox(x.classification),e.next=38,b.run({editor:n,context:h,addMessage:r,classificationResult:x,history:v,trackFns:l,themeModificationController:f,provider:p});case 40:if(!os(x.classification)){e.next=47;break}return r({from:"Designer",type:"text",message:x.ack||"Sure, let me see what I can do...",resp:x.resp,isClassification:!0}),j=o(),w=oi(x.classification),e.next=46,w.run({editor:n,context:h,addMessage:r,classificationResult:x,history:j,trackFns:l,themeModificationController:f,provider:p});case 46:m="chatSuggestion";case 47:e.next=54;break;case 49:e.prev=49,e.t0=e.catch(7),console.log("[AIChat.sendMessage] ERROR: ".concat(e.t0.message,"}"),{err:e.t0,taskContext:h}),k="Sorry, something unexpected happened. Please try again.",e.t0 instanceof ry.Og?(r({from:"Designer",type:"text",message:C=e.t0.opts.chatMessage||k,resp:e.t0.opts.resp,interactionId:g}),l.trackRequestError({errorName:e.t0.name,interactionId:g,outputMessage:C,errorMessage:e.t0.message,resp:e.t0.opts.resp})):(rx.Tb(e.t0),r({from:"Designer",type:"text",message:k,interactionId:g}),l.trackRequestError({errorName:e.t0.name,interactionId:g,outputMessage:k,errorMessage:e.t0.message}));case 54:m&&u(m),a("idle");case 56:case"end":return e.stop()}},e,null,[[7,49]])})),function(e){return t.apply(this,arguments)}),[n,c,o,r,l,d,f,u]),status:s}};function oN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var oG=function(e){var t=e.editor,n=e.scrollSelector,r=e.onClose,o=(0,j.useState)(""),i=o[0],s=o[1],a=(0,n6.ye)("openAiStatus"),c=(0,X.TL)(),l=(0,tY.As)("editor"),u=(0,X.qr)(),d=(0,X.CG)(rv.AZ),f=(0,X.CG)(rv.Q_),h=(0,j.useState)(null),m=h[0],g=h[1],y=(0,j.useCallback)(function(){return(0,rv.AZ)(u.getState())},[u]),b=(0,j.useCallback)(function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oN(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oN(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({timestamp:Date.now()},e);c((0,rv.Hz)({message:t}))},[c]),w=(0,j.useCallback)(function(){c((0,rv.mc)())},[c]),k=oz({addMessage:b,getMessageHistory:y,editor:t}),C=k.status,O=k.sendMessage;(0,j.useEffect)(function(){var e=n&&document.querySelector(n);e&&requestAnimationFrame(function(){e.scrollTop=e.scrollHeight})},[n,d]);var E="idle"!==C;(0,j.useEffect)(function(){if(f.length&&!E){var e=f[0],t=e.task,n=e.id;!1===t.submit?s(t.message):O({message:t.message}),c((0,rv.VB)({id:n}))}},[E,O,c,f]);var I=(0,j.useCallback)(function(){if(m&&t){var e=document.querySelector('[data-card-id="'.concat(m,'"]')),n=(0,tY.v4)(e,100);null!=n&&n.yAxisInView||l.scrollElementIntoView({element:e})}},[t,l,m]),P=(0,j.useCallback)(function(e){I(),O({message:e})},[I,O]),D=(0,j.useCallback)(function(){P(i),s("")},[P,i]);return((0,j.useEffect)(function(){if(t){var e=function(){var e=(0,n7.AQ)(t,t.state.selection.from);e&&g(e.node.attrs.id)};return e(),t.on("selectionUpdate",e),function(){t.off("selectionUpdate",e)}}},[t]),t)?"DOWN"===a?(0,ep.jsx)(ro,{onClose:r}):(0,ep.jsxs)(p.k,{direction:"column",h:"100%",w:"100%",px:6,pb:2,children:["DEGRADED"===a&&(0,ep.jsx)(ri,{}),(0,ep.jsx)(rg.rN,{scrollSelector:n,messages:d,editor:t,sendMessage:P,isLoading:E,onClose:r}),(0,ep.jsxs)(ec.K,{pos:"sticky",bottom:0,py:2,pt:4,bg:"gray.50",children:[(0,ep.jsx)(rm,{editor:t,value:i,onChange:s,onSubmit:D,isLoading:E,resetMessages:w}),(0,ep.jsx)(n9.r,{modalId:"ai-credits-modal-message-list",variant:"ghost",justify:"flex-end"})]}),(0,ep.jsx)(x.kH,{label:"Clear chat history",placement:"top",children:(0,ep.jsx)(R.h,{variant:"ghost",colorScheme:"blackAlpha",color:"currentColor","aria-label":"reset-chat",icon:(0,ep.jsx)(v.G,{icon:n4.Yc}),onClick:w,position:"absolute",left:4,top:1,isRound:!0})})]}):null},oW=n(93634),oF=function(e){var t=e.onClose;return(0,ep.jsx)(p.k,{width:"100%",px:6,py:4,justifyContent:"space-between",alignItems:"center",h:8,tabIndex:0,outline:"none",position:"absolute",top:0,children:(0,ep.jsx)(nU.P,{"data-design-partner-close-button":!0,position:"absolute",top:2,right:6,zIndex:1,onClick:t})})},oB=["closePanel"];function oU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function oV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oU(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oU(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var oq="design-partner-panel-wrapper",oH=function(e){var t=e.toggleDesignPartnerPanel,n=e.isDesignPartnerPanelOpen,r=e.editor,o=(0,n6.ye)("aiChat"),i=(0,X.TL)();(0,j.useEffect)(function(){return function(){i((0,rv.mc)())}},[]);var s=(0,X.CG)(Q.hN);(0,j.useEffect)(function(){!s&&n&&t()},[s,n,t]),(0,j.useEffect)(function(){var e,t;r&&(null===(e=(t=r.commands).setSalOpen)||void 0===e||e.call(t,n))},[r,n]),(0,j.useEffect)(function(){if(o)return oW.T.on("toggle",function(e){t(e.config)})},[t,o]),(0,j.useEffect)(function(){if(o)return nw.pw.on("queueDesignPartnerTask",function(e){i((0,rv.Lj)({task:e})),t({disableTransition:!1,override:"open"}),console.log("queueDesignPartnerTask",e)})},[i,o,t]),(0,j.useEffect)(function(){if(o&&s){var e=(0,n3.ZP)("mod+shift+S");return nb.F7.on("keydown","DESIGN_PARTNER_PANEL",function(n){return!!e(n)&&(t(),!0)})}},[t,o,s])},oY=function(e){var t=e.closePanel,n=(0,eF.Z)(e,oB),r=(0,nk._)().editor;return(0,j.useEffect)(function(){return nb.F7.on("keydown","DESIGN_PARTNER_PANEL",function(e){return!!document.activeElement.closest('[data-panelid="design-partner-panel"]')&&"Escape"===e.key&&(t(),!0)})},[t]),(0,ep.jsx)(nj.s,oV(oV({},n),{},{bgColor:"gray.50","data-panelid":"design-partner-panel",borderLeftWidth:"1px",children:(0,ep.jsxs)(p.k,{direction:"column",h:"100%",overflowY:"auto",overflowX:"hidden",className:oq,w:"100%",children:[(0,ep.jsx)(oF,{onClose:t}),(0,ep.jsx)(oG,{editor:r,scrollSelector:".".concat(oq),onClose:t})]})}))};oY.panelPosition="right";var oK=n(31145),oX=n(49626),oQ=n(61751),oJ=n(91391),o$=n(56133),o0=n(27302),o1=n(39097),o2=n.n(o1),o5=n(57679),o3=n(54260),o6=n(83775),o4=n(68358),o9=n(21286),o7=n(60284),o8=n(25180),ie=n(76035),it=n(50281),ir=n(54119),io=n(77779),ii=n(2046),is=n(70287),ia=n(56241),ic=n(14304),il=n.n(ic),iu=[{key:"bad",label:"It's bad",icon:io.Kf,color:"red"},{key:"meh",label:"It's okay",icon:ir.C4,color:"yellow"},{key:"good",label:"It's great",icon:it.I3,color:"green"}],id=function(e){var t=e.docId,n=e.isDark,r=(0,tW.z$)(),o=(0,j.useState)(null),i=o[0],s=o[1],a=(0,j.useState)(!1),c=a[0],l=a[1],u=(0,j.useState)(""),d=u[0],f=u[1],p=(0,j.useRef)(null),g=(0,eJ.p)(),x=(0,j.useCallback)(function(e){s(e),null==r||r.track(tW.AA.AI_DOC_RATED,{rating:e,doc_id:t}),g({title:"Your rating has been submitted",status:"success",position:"top",duration:1e3}),setTimeout(function(){var e;null==p||null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},200)},[r,t,g]),y=(0,j.useCallback)(function(e){e||(null==r||r.track(tW.AA.AI_DOC_FEEDBACK_SUBMITTED,{feedback:il().sanitize(d),doc_id:t}),g({title:"Your feedback has been sent to the team",status:"success",position:"top",duration:2e3,isClosable:!0})),l(!0)},[r,t,d,g]);return(0,ep.jsx)(m.xu,{p:4,borderRadius:"lg",border:"1px solid",borderColor:n?"whiteAlpha.100":"gray.200",position:"relative",children:c?(0,ep.jsxs)(h.x,{color:n?"green.400":"green.600",textAlign:"center",children:[(0,ep.jsx)(v.G,{icon:ie.faCircleCheck})," Thanks for your feedback"]}):(0,ep.jsxs)(ec.K,{spacing:4,children:[(0,ep.jsxs)(ec.K,{alignItems:"center",spacing:"1",children:[(0,ep.jsx)(h.x,{fontSize:"sm",color:n?"whiteAlpha.800":"gray.500",children:"Help refine our beta"}),i?(0,ep.jsxs)(h.x,{textAlign:"center",color:n?"green.400":"green.600",children:[(0,ep.jsx)(v.G,{icon:ie.faCircleCheck})," Thanks for your feedback"]}):(0,ep.jsx)(h.x,{children:"How satisfied are you with the AI output?"})]}),(0,ep.jsx)(es.U,{fontSize:"xl",width:"100%",children:iu.map(function(e){var t=e.key,r=e.label,o=e.icon,s=e.color,a=i===t,c=Boolean(i&&!a);return(0,ep.jsx)(ip,{label:r,icon:o,color:s,onClick:function(){return x(t)},isSelected:a,isDisabled:c,isDark:n},t)})}),i&&(0,ep.jsxs)(ii.NI,{textAlign:"center",children:[(0,ep.jsxs)(is.l,{fontSize:"sm",color:n?"whiteAlpha.800":"gray.500",children:["How could we"," ","good"===i?"make it even better?":"improve the quality?"]}),(0,ep.jsx)(rc.g,{value:d,onChange:function(e){f(e.target.value)},placeholder:"",size:"sm",mb:"4"}),(0,ep.jsxs)(nc.h,{spacing:"4",ref:p,children:[(0,ep.jsx)(ef.z,{variant:"text",onClick:function(){y(!0)},children:"Skip"}),(0,ep.jsx)(ef.z,{variant:"solid",isDisabled:""===d,onClick:function(){return y(!1)},children:"Submit"})]})]})]})})},ip=function(e){var t=e.label,n=e.icon,r=e.color,o=e.isSelected,i=e.onClick,s=e.isDisabled,a=e.isDark;return(0,ep.jsx)(ia.u,{label:t,placement:"top",children:(0,ep.jsx)(R.h,{"aria-label":t,boxShadow:"none",bg:o?a?"".concat(r,".200"):"".concat(r,".100"):a?"whiteAlpha.300":"gray.50",_disabled:{opacity:"".concat(o?1:.5),cursor:"not-allowed"},color:o?a?"".concat(r,".600"):"".concat(r,".500"):a?"whiteAlpha.800":"gray.500",_hover:{backgroundColor:"".concat(r,".100"),color:"".concat(r,".500")},flex:1,icon:(0,ep.jsx)(h.x,{fontSize:"2xl",children:(0,ep.jsx)(v.G,{icon:n})}),isDisabled:s,variant:"plain",onClick:i})})},ih=n(97374),im=n(11438),ig=n(62211),iv=["90%","360px"],ix=function(e){var t=e.onClose,n=e.eyebrowText,r=e.mainText,o=e.callsToAction;return(0,ep.jsxs)(m.xu,{bg:"white",border:"0.5px solid var(--chakra-colors-gray-100)",borderRadius:"md",shadow:"md",p:4,w:iv,maxW:iv,position:"relative",children:[(0,ep.jsx)(nU.P,{size:"sm",onClick:t,position:"absolute",insetEnd:1,top:1}),(0,ep.jsxs)(ec.K,{spacing:4,children:[(0,ep.jsxs)(ec.K,{spacing:1,paddingEnd:3,children:[!(0,o7.s2)()&&(0,ep.jsx)(h.x,{fontSize:"sm",color:"gray.600",children:n}),(0,ep.jsx)(h.x,{fontSize:"md",children:r})]}),(0,ep.jsx)(m.xu,{w:"100%",children:o})]})]})},iy=function(e){var t=e.onClose,n=e.docFormatLabel,r=e.startTour;return(0,t2.SE)().setSettings,(0,ep.jsx)(ix,{eyebrowText:(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)("span",{"aria-label":"Wave",role:"img",children:"\uD83D\uDC4B"})," ","Welcome to your first ",n]}),mainText:"Want a quick tour of the editor?",onClose:t,callsToAction:(0,ep.jsx)(ef.z,{size:"md",w:"100%",variant:"solid",onClick:function(){r(0),t()},children:"Show me a quick tour"})})},ib=n(77245),ij=["90%","360px"],iw=function(e){var t=e.onClose,n=(0,j.useState)(!0),r=n[0],o=n[1];return(0,j.useEffect)(function(){setTimeout(function(){o(!1)},3e3)},[]),(0,ep.jsxs)(m.xu,{bg:"white",border:"0.5px solid var(--chakra-colors-gray-100)",borderRadius:"md",shadow:"md",p:4,w:ij,maxW:ij,position:"relative",children:[(0,ep.jsx)(nU.P,{size:"md",onClick:t,position:"absolute",insetEnd:1,top:1}),(0,ep.jsxs)(ec.K,{direction:"row",spacing:3,justify:"center",w:"100%",alignItems:"center",children:[(0,ep.jsx)(m.xu,{color:"trueblue.300",children:(0,ep.jsx)(v.G,{icon:ib.tc,size:"2x",className:r?"fa-bounce":void 0})}),(0,ep.jsxs)(ec.K,{spacing:0,direction:"column",flex:1,textAlign:"left",children:[(0,ep.jsx)(h.x,{fontSize:"sm",color:"gray.600",children:"Want to edit this?"}),(0,ep.jsx)(h.x,{fontSize:"md",children:"Sign in on desktop at gamma.app"})]})]})]})};function ik(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function iC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ik(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ik(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var iO="source",iE="desktop-tour-toast",iS="switch-from-mobile-to-desktop-toast",iI=function(e){var t,n=e.editor,r=(0,eJ.p)(),o=(0,X.CG)(t7.yx),i=(0,O.c8)().startTour,s=(0,t2.SE)(),a=s.user,c=s.setSettings,l=(0,j.useRef)(null),u=(0,j.useState)(!1),d=u[0],f=u[1],p=(0,j.useState)(!1),h=p[0],m=p[1],g=(0,j.useRef)(!1),v=(0,j.useState)(!1),x=v[0],y=v[1],b=null==a?void 0:null===(t=a.settings)||void 0===t?void 0:t.needsEditorOnboarding,w=(0,tY.As)("editor"),k=(0,j.useState)(null),C=k[0],E=k[1];return(0,j.useEffect)(function(){n&&(m(Boolean(!(0,o7.s2)()&&(0,o8.SJ)()[iO]===o3.VY&&b)),f(Boolean((0,o8.SJ)()[iO]===o3.VY)),y((0,o7.s2)()&&Boolean((0,o8.SJ)()[iO]===o3.VY)),l.current=(0,ig.W)((0,im.VA)(n)).label||null,setTimeout(function(){(0,ih.lO)({query:iC(iC({},(0,o8.SJ)()),{},(0,S.Z)({},iO,void 0)),emitChange:!1})}))},[n,b]),(0,j.useEffect)(function(){return h&&!r.isActive(iE)&&r({id:iE,position:"bottom-left",render:function(e){var t=e.onClose;return iy({onClose:function(){null==c||c({remove:["needsEditorOnboarding"]}),t()},docFormatLabel:l.current,startTour:i})},isClosable:!0,duration:null}),function(){r.isActive(iE)&&r.close(iE)}},[c,h,i,r]),(0,j.useEffect)(function(){if((0,o7.s2)()){var e=document.querySelector(w.scrollSelector);if(e){E(e);var t=function(){C&&(0,o7.s2)()&&(null==C?void 0:C.scrollTop)>=(null==C?void 0:C.scrollHeight)/4&&x&&!r.isActive(iS)&&!g.current&&(g.current=!0,r({id:iS,position:"top",render:function(e){return iw({onClose:e.onClose})},isClosable:!0,duration:null,containerStyle:{minWidth:"100%",display:"flex",justifyContent:"center"}}))};return window.addEventListener("scroll",t,!0),function(){window.removeEventListener("scroll",t,!0),r.isActive(iS)&&r.close(iS)}}}},[o,C,w.scrollSelector,x,r]),{showDocWizardFooter:d}};function iP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function iD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iP(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iP(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var iT=function(){var e,t=(0,X.CG)(t7.yx),n=null!=t&&!!t.theme&&(0,o4.wj)(null==t?void 0:t.theme),r=(0,j.useState)(!1),o=r[0],i=r[1],s=(0,eJ.p)(),a=null==t?void 0:null===(e=t.accessLinks)||void 0===e?void 0:e[0],c=(0,j.useMemo)(function(){return(0,o8.Gn)({docTitle:null==t?void 0:t.title,docId:null==t?void 0:t.id,token:null==a?void 0:a.token,absolute:!0})},[t,null==a?void 0:a.token]),l=(0,e0.V)(c).onCopy,u=(0,j.useCallback)(function(){(0,o6.J)({docId:null==t?void 0:t.id,source:"docWizardFooter",type:"tokenUrl"}),l(),s({title:"Link copied to clipboard",status:"success",position:"top",duration:1e3,isClosable:!1})},[null==t?void 0:t.id,l,s]),d=(0,j.useCallback)(function(){i(!0)},[]);return(0,ep.jsx)(x.Wk,{isDark:n,children:(0,ep.jsx)(p.k,{className:"chakra-dont-set-collapse","data-doc-wizard-footer":!0,w:"100%",mt:(0,o7.s2)()?void 0:"-".concat(o9.m),children:(0,ep.jsx)(oJ.U,{in:!o,style:{width:"100%"},unmountOnExit:!0,children:(0,ep.jsx)(p.k,iD(iD({pt:[10,10,20],pb:[4,4,8],w:"100%",position:"relative"},n?{background:"gray.900",color:"white",borderTop:"2px solid var(--chakra-colors-whiteAlpha-200)"}:{background:"white",color:void 0,borderTop:"2px solid var(--chakra-colors-blackAlpha-200)"}),{},{children:(0,ep.jsx)(o$.W,{maxW:"420px",children:(0,ep.jsxs)(ec.K,{spacing:8,children:[(0,ep.jsxs)(ec.K,{spacing:4,textAlign:"center",children:[(0,ep.jsx)(el.X,{size:"md",children:"Like what you created?"}),(0,ep.jsx)(ef.z,{leftIcon:(0,ep.jsx)(v.G,{icon:oQ.nN}),variant:"solid",onClick:u,children:"Copy share link"}),(0,ep.jsx)(ef.z,{as:o2(),target:(0,o7.Q5)()?"_self":"_blank",variant:"plain",colorScheme:n?"blackAlpha":"whiteAlpha",leftIcon:(0,ep.jsx)(v.G,{icon:oX.r8}),rightIcon:(0,o7.Q5)()?void 0:(0,ep.jsx)(v.G,{icon:oK.faArrowUpRightFromSquare,size:"xs"}),href:o3.ET,children:"Create something else"})]}),(0,ep.jsx)(id,{docId:null==t?void 0:t.id,isDark:n}),(0,ep.jsx)(o0.M,{pt:[0,0,4],w:"100%",children:(0,ep.jsx)(ef.z,{size:"sm",onClick:d,variant:"text",colorScheme:"blackAlpha",children:"Hide"})})]})})}))})})})},iA=function(e){var t=e.editor,n=iI({editor:t}).showDocWizardFooter,r=(0,X.CG)((0,o5.Sj)(null==t?void 0:t.gammaDocId));return n&&!r?(0,ep.jsx)(iT,{}):(0,ep.jsx)(ep.Fragment,{})},iR=n(420),iL=n(98537),i_=n.n(iL),iZ=n(48230),iM=n(49201),iz=function(e){var t=e.onCloneClick,n=e.onSignupClick,r=e.isLoggedIn;return(0,ep.jsx)(m.xu,{bg:"white",border:"0.5px solid var(--chakra-colors-gray-100)",borderRadius:"md",shadow:"md",display:"column",p:4,position:"relative",children:r?(0,ep.jsxs)(es.U,{children:[(0,ep.jsxs)(h.x,{mr:1,children:[(0,ep.jsxs)("strong",{children:["Like this ",x._u,"?"]})," Make it yours \uD83D\uDE0D"]}),(0,ep.jsxs)(ef.z,{variant:"solid",onClick:t,children:["Copy ",x._u]})]}):(0,ep.jsxs)(es.U,{children:[(0,ep.jsxs)(h.x,{mr:1,children:[(0,ep.jsxs)("strong",{children:["Like this ",x._u,"?"]})," Sign up for Gamma to clone it! \uD83D\uDE0D"]}),(0,ep.jsx)(o2(),{href:"/signup",passHref:!0,legacyBehavior:!0,children:(0,ep.jsx)(ef.z,{as:e$.r,onClick:n,variant:"solid",textDecoration:"none !important",children:"Sign up"})})]})})},iN=function(e){var t=!(0,o7.s2)(),n=(0,t2.SE)().user,r=(0,eJ.p)(),o=(0,j.useRef)(),i=(0,iZ.e)(),s=(0,j.useCallback)(function(){e&&(null===tW.co||void 0===tW.co||tW.co.track(tW.AA.EXAMPLE_SIGNUP_CLICKED,{doc_id:e.id,title:e.title}))},[e]),a=(0,j.useCallback)(function(){i({docId:null==e?void 0:e.id,docTitle:null==e?void 0:e.title,source:"example_deck_clone_toast"})},[e,i]);(0,j.useEffect)(function(){return function(){o.current&&r.close(o.current)}},[r]);var c=t&&e,l=Boolean(n);(0,iM.vm)(function(){o.current&&r.close(o.current),c&&(o.current=r({position:"bottom",render:function(){return iz({onCloneClick:a,isLoggedIn:l,onSignupClick:s})},isClosable:!0,duration:null}))},[e,t,a,s,c,n,r,l],[c,l])},iG=n(24380),iW=n(77527),iF=n(60912),iB="sessionId1",iU=tH.hj.create({addStorage:function(){return{user:{}}},addCommands:function(){var e=this;return{user:function(t){return function(){var n=(0,X.bh)();return e.storage.user=i_()({},e.storage.user,t),n.dispatch((0,Q.MU)({sessionId:iB})),n.dispatch((0,Q.Tx)({collaborators:[e.storage.user]})),!0}}}}}),iV=function(e){var t,n=e.docId,r=e.snapshotId,o=e.scrollingParentSelector,i=e.onCreate,s=(0,X.CG)(t7.yx);iN(s);var a=(0,j.useState)(function(){return[iW.$1.configure({scrollerSelector:o}),iU,iG._g]})[0],c=(0,t2.SE)(),l=c.user,u=c.anonymousUser,d=c.isUserLoading,f=c.color,h=(0,j.useState)(),g=h[0],v=h[1],y=(0,k.EDv)({variables:{docId:n,snapshotId:r},skip:!r}),b=y.data,w=y.loading,C=y.error;(0,j.useEffect)(function(){!d&&g&&g.commands.user({id:(null==l?void 0:l.id)||u.id,color:f.value,sessionId:iB,idleSince:null,name:(null==l?void 0:l.displayName)||u.displayName||"",profileImageUrl:(null==l?void 0:l.profileImageUrl)||"",isReady:!d})},[g,l,f,d,u]);var O=b&&void 0!==b.snapshot&&!w&&s;return(0,ep.jsxs)(m.xu,{"data-testid":"example-static-editor-wrapper",flex:"1",height:"100%",children:[!O||C?(0,ep.jsxs)(p.k,{direction:"column",height:"100%",flex:"1",bg:"gray.100",alignItems:"center",justifyContent:"center",children:[!O&&(0,ep.jsx)(iR.$,{}),C&&(0,ep.jsxs)(o0.M,{h:"100%",children:["There was an error loading the ",x._u,": ",C.message]})]}):(0,ep.jsx)(m.xu,{"data-testid":"example-static-editor-wrapper-inner",transitionProperty:"common",transitionDuration:"750ms",transitionTimingFunction:"ease-out",opacity:O?1:0,children:(0,ep.jsx)(ez.yE,{doc:s,editorId:"main",docId:n,extensions:a,onCreate:function(e){var t=e.editor;v(t),setTimeout(function(){i&&i(t)},10)},readOnly:!0,initialContent:null===(t=b.snapshot)||void 0===t?void 0:t.content.default,scrollingParentSelector:o})}),(0,ep.jsx)(iF.m,{})]})},iq=n(12221),iH=n(18149),iY=n.n(iH),iK=n(98621),iX=n.n(iK),iQ=n(42760),iJ=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",n=(0,X.TL)(),r=(0,tY.As)("editor"),o=(0,eb.nO)(),i=(0,X.CG)(Q.yn,iY()),s=(0,X.CG)(Q.k8,iY()),a=Boolean(null==s?void 0:s.pos);(0,j.useEffect)(function(){if(e){var t=tq()(function(){i&&n((0,Q.Qx)({attached:!1}))},500,{leading:!0}),r=(0,tX.B$)({topOffset:100,requiredCookie:"spotlightScrollDebug=true"});return document.addEventListener("wheel",t,!0),function(){r(),t.cancel(),document.removeEventListener("wheel",t,!0)}}},[e,n,i,a,t]);var c=(0,X.CG)(Q.ks,iY());(0,j.useEffect)(function(){if(e&&!c){var t=tq()(function(){if(!r.inProgress){var t=(0,ez.lI)(e,100,o);if(!t){console.debug("[useHandleScrollAndSelectionChange][handleScroll] Unable to find topPosPct.");return}n((0,Q.Us)(t))}},250,{trailing:!0,maxWait:500}),i=tq()(function(){if(!(e.state.selection instanceof iQ.c)){var t=document.querySelector(r.scrollSelector||""),o=null==t?void 0:t.getBoundingClientRect(),i=e.state.selection.from,s=(0,ez.Sh)(e,i);if(!t||!o||!s){console.debug("[useHandleScrollAndSelectionChange][handleSelectionChange] missing data",{domNodeToUse:s});return}var a=s.getBoundingClientRect(),c=parseFloat(((e.view.coordsAtPos(i).top-a.y)/a.height).toFixed(2));n((0,Q.Us)({pos:i,pct:c}))}},250,{trailing:!0,maxWait:500});return t(),e.on("selectionUpdate",i),window.addEventListener("scroll",t,!0),function(){e.off("selectionUpdate",i),window.removeEventListener("scroll",t,!0)}}},[e,n,r,c,o])},i$=function(){var e=(0,eJ.p)(),t=(0,X.TL)();return(0,j.useCallback)(function(n){var r=n.collaborator,o=n.localIsFollowing,i=n.localIsAttached,s={attached:!0};o?i?s.following=null:e.closeAll():(s.following=r.sessionId,e.closeAll(),e({duration:2e3,position:"bottom",render:function(){return(0,ep.jsxs)(p.k,{bg:"gray.50",p:3,px:6,align:"center",borderRadius:"md",shadow:"md",children:[(0,ep.jsx)(iq.q,{size:"sm",src:r.profileImageUrl,border:"solid 2px ".concat(r.color),color:iX()(r.color).isDark()?"white":"black",bg:r.color}),(0,ep.jsxs)(h.x,{ml:2,children:["You're following ",r.name,"."]})]})}})),console.debug("[CollaboratorsPanel] Clicked on collaborator ".concat(r.name,". Setting following to ").concat(s)),t((0,Q.Qx)(s))},[e,t])},i0=function(e){var t=e.editor,n=e.collaborators,r=e.user,o=(0,j.useRef)(!1),i=i$(),s=new URLSearchParams(window.location.search),a=s.get("following_id"),c=s.get("follow_on_start");(0,j.useEffect)(function(){if(!o.current&&c&&(null==r?void 0:r.id)!==a&&t){var e=n.find(function(e){return e.id===a});e&&(i({collaborator:e,localIsAttached:!1,localIsFollowing:!1}),o.current=!0)}},[a,c,t,n,r,i])},i1="sessionId1",i2=tH.hj.create({addStorage:function(){return{user:{}}},addCommands:function(){var e=this;return{user:function(t){return function(){var n=(0,X.bh)();return e.storage.user=i_()({},e.storage.user,t),n.dispatch((0,Q.MU)({sessionId:i1})),n.dispatch((0,Q.Tx)({collaborators:[e.storage.user]})),!0}}}}}),i5=function(e){var t,n=e.docId,r=e.snapshotId,o=e.scrollingParentSelector,i=e.onCreate,s=e.theme,a=e.showMadeWithGammaBadge,c=(0,j.useState)(function(){return[iW.$1.configure({scrollerSelector:o}),i2,iG._g]})[0],l=(0,t2.SE)(),u=l.user,d=l.isUserLoading,f=l.anonymousUser,h=l.color,g=(0,j.useState)(),v=g[0],y=g[1],b=(0,k.EDv)({variables:{docId:n,snapshotId:r},skip:!r}),w=b.data,C=b.loading,O=b.error,E=(0,X.CG)(t7.yx);(0,j.useEffect)(function(){!d&&v&&v.commands.user({id:(null==u?void 0:u.id)||f.id,color:h.value,sessionId:i1,idleSince:null,name:(null==u?void 0:u.displayName)||f.displayName||"",profileImageUrl:(null==u?void 0:u.profileImageUrl)||"",isReady:!d})},[v,u,h,d,f]);var S=w&&void 0!==w.snapshot&&!C&&E;return(0,ep.jsxs)(m.xu,{"data-testid":"public-static-editor-wrapper",flex:"1",height:"100%",children:[!S||O?(0,ep.jsxs)(p.k,{direction:"column",height:"100%",flex:"1",bg:"gray.100",alignItems:"center",justifyContent:"center",children:[!S&&(0,ep.jsx)(iR.$,{}),O&&(0,ep.jsxs)(o0.M,{h:"100%",children:["There was an error loading the ",x._u,": ",O.message]})]}):(0,ep.jsx)(m.xu,{"data-testid":"public-static-editor-wrapper-inner",transitionProperty:"common",transitionDuration:"750ms",transitionTimingFunction:"ease-out",opacity:S?1:0,children:(0,ep.jsx)(ez.yE,{doc:E,editorId:"main",docId:n,theme:s||void 0,extensions:c,onCreate:function(e){var t=e.editor;y(t),setTimeout(function(){i&&i(t)},10)},readOnly:!0,initialContent:null===(t=w.snapshot)||void 0===t?void 0:t.content.default,scrollingParentSelector:o})}),v&&(0,ep.jsx)(t1,{editor:v,backoffFactor:2}),(void 0===a||a)&&(0,ep.jsx)(iF.m,{})]})},i3=n(16019);function i6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function i4(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i6(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i6(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var i9=(c={},(0,S.Z)(c,tQ.q.DOC_VIEW,"doc"),(0,S.Z)(c,tQ.q.SLIDE_VIEW,"present"),c),i7=function(e){var t=(0,w.I0)(),n=(0,o8.SJ)().mode,r=(0,X.CG)(Q.gh),o=(0,j.useCallback)(function(e){var t=(0,o8.SJ)().mode,n=i9[e||r];t!==n&&(0,ih.lO)({query:i4(i4({},(0,o8.SJ)()),{},{mode:n}),emitChange:!1})},[r]);(0,i3.r)(o,[r]),(0,j.useEffect)(function(){return ih.fI.on("changed",function(){return o()})},[o]),(0,iM.vm)(function(){if(e){var r=n===i9.SLIDE_VIEW?tQ.q.SLIDE_VIEW:tQ.q.DOC_VIEW,i=(0,o8.sY)().cardId;r===tQ.q.SLIDE_VIEW&&(i?(console.debug("[useQuerySync] initializeModeFromQuery - Entering slide view -> spotlightCardById:",i),e.commands.spotlightCardById(i)):(console.debug("[useQuerySync] initializeModeFromQuery - Entering slide view -> spotlightCurrentCard"),e.commands.spotlightCurrentCard())),t((0,Q.PM)({mode:r})),o(r)}},[e,t,n,o],[e])},i8=n(61798),se=n(10469),st=n(27440),sn=n(71170),sr=n(98386),so=n(18559),si=n(52300),ss=n(82221),sa=(0,n3.ZP)("mod+Escape"),sc=new Set(["h","j","k","l","s","PageUp","PageDown","ArrowRight","ArrowLeft","ArrowDown","ArrowUp","Enter","Escape"]),sl=function(e,t){var n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=(0,tY.cC)("editor"),o=r.scroller;if(o){e.commands.turnOffSpotlight();var i=o.scrollHeight-o.offsetHeight;if("down"===t){if(!(r.isAtBottom(90)&&n&&e.commands.spotlightNextCard(!1,"top"))){var s=o.scrollTop+.5*o.offsetHeight;s>i-150&&(s=i),r.scrollTo({top:s})}}else if(!(r.isAtTop(90)&&n&&e.commands.spotlightNextCard(!0,"bottom"))){var a=o.scrollTop-.5*o.offsetHeight;a<150&&(a=0),r.scrollTo({top:a})}}},su=function(e){var t=e.enabled,n=e.setActiveKey,r=(0,tW.z$)(),o=(0,X.TL)(),i=(0,t9._i)().editor,s=(0,X.CG)(sr.C),a=(0,si.g)(i),c=a.enabled,l=a.pos,u=(0,j.useCallback)(function(){c?null==i||i.commands.turnOffSpotlight():null==i||i.commands.spotlightNextBlock()},[null==i?void 0:i.commands,c]);return(0,j.useEffect)(function(){if(t)return nb.F7.on("keydown","NAVIGATION_CONTROLS",function(e){var t,o,a=(0,X.bh)(),d=e.target,f=Object.keys((0,Q.X9)(a.getState()).tree);if(!i||null!=d&&null!==(t=d.closest)&&void 0!==t&&t.call(d,"[data-gamma-child-tiptap-editor]")||null!=d&&null!==(o=d.closest)&&void 0!==o&&o.call(d,"input")||e.metaKey||s)return!1;switch(sc.has(e.key)&&("s"!==e.key&&(n(e.key),setTimeout(function(){n(null)},100)),e.preventDefault()),e.key){case"s":return u(),!0;case"l":case"ArrowRight":return(0,so.p7)(),a.dispatch((0,Q.Qx)({attached:!1})),null==r||r.trackDocEvent(tW.AA.PRESENT_MODE_NAVIGATED,{direction:tW.xQ.CARD_NEXT,method:tW.SY.KEYBOARD,key:e.key}),i.commands.spotlightNextCard();case"h":case"ArrowLeft":return(0,so.p7)(),a.dispatch((0,Q.Qx)({attached:!1})),null==r||r.trackDocEvent(tW.AA.PRESENT_MODE_NAVIGATED,{direction:tW.xQ.CARD_PREV,method:tW.SY.KEYBOARD,key:e.key}),i.commands.spotlightNextCard(!0);case"j":case"ArrowDown":case"PageDown":if((0,so.p7)(),a.dispatch((0,Q.Qx)({attached:!1})),!c){var p=(0,iG.ei)(i.state.selection);return i.commands.goToNextExpandableNode()||sl(i,"down",!p),!0}return null==r||r.trackDocEvent(tW.AA.PRESENT_MODE_NAVIGATED,{direction:tW.xQ.TELEPROMPTER_DOWN,method:tW.SY.KEYBOARD,key:e.key}),i.commands.spotlightNextBlock();case"k":case"ArrowUp":case"PageUp":if((0,so.p7)(),a.dispatch((0,Q.Qx)({attached:!1})),!c){var h=(0,iG.ei)(i.state.selection);return i.commands.goToNextExpandableNode(!0)||sl(i,"up",!h),!0}return null==r||r.trackDocEvent(tW.AA.PRESENT_MODE_NAVIGATED,{direction:tW.xQ.TELEPROMPTER_UP,method:tW.SY.KEYBOARD,key:e.key}),i.commands.spotlightNextBlock(!0);case"r":if(f[0])return(0,so.p7)(),i.commands.spotlightCardById(f[0]),a.dispatch((0,Q.Qx)({attached:!1})),!0;return!1;case"Escape":if(sa(e))return!1;if(i.commands.spotlightCollapseNearestExpandableNode(c&&l?l:null))return i.commands.reHighlightExpandableNode(),!0;if(c)return i.commands.turnOffSpotlight(),!0;return a.dispatch((0,Q.Qx)({attached:!1})),null==r||r.track(tW.AA.CARD_COLLAPSED,{is_present_mode:!0,method:"escape_key"}),i.commands.ascendUpToParentCard(!1);case"Enter":var m=c&&l;if(i.commands.expandOrCollapseExpandableNode(m?l:null))return!0;if(m){var g=i.state.doc.resolve(l).parent;if(g&&(0,ss.AH)(g))return(0,ss.xB)(g.attrs.id,!1),i.commands.spotlightNextBlock(!0),!0;return i.commands.spotlightCollapseNearestExpandableNode(l)}return!1;default:return!1}})},[i,o,r,t,u,c,l,s,n]),c},sd=function(e){var t=new KeyboardEvent("keydown",{key:e});n.g.dispatchEvent(t)},sf={ArrowUp:{icon:er.FP,label:"Previous step",shortcuts:["","K"],key:"ArrowUp",onClick:function(){sd("ArrowUp")},gridPos:[1,2]},ArrowLeft:{icon:ei.ac,label:"Previous card",shortcuts:["","H"],key:"ArrowLeft",onClick:function(){sd("ArrowLeft")},gridPos:[2,1]},ArrowDown:{icon:en.r5,label:"Next step",shortcuts:["","J"],key:"ArrowDown",onClick:function(){sd("ArrowDown")},gridPos:[2,2]},ArrowRight:{icon:eo.eF,label:"Next card",shortcuts:["","L"],key:"ArrowRight",onClick:function(){sd("ArrowRight")},gridPos:[2,3]},Spotlight:{icon:se.GT,label:"Toggle spotlight",shortcuts:["S"],key:"S",onClick:function(){sd("s")},gridPos:[1,3]}},sp=function(e){var t=e.shortcuts;return(0,ep.jsx)(h.x,{as:"span",color:"gray.400",ml:2,children:t.map(function(e,n){return(0,ep.jsxs)(j.Fragment,{children:[e,n===t.length-1?null:(0,ep.jsx)(h.x,{fontSize:"11px",as:"span",color:"gray.500",mx:1,children:"or"})]},e)})})},sh=function(e){var t=e.activeKey,n=e.spotlightingByBlock;return(0,ep.jsx)(eG.h,{children:(0,ep.jsx)(m.xu,{position:"absolute",bottom:4,right:6,zIndex:"sticky",children:(0,ep.jsx)(st.r,{gridTemplateColumns:"repeat(3, 1fr)",gridTemplateRows:"repeat(2, 1fr)",children:Object.values(sf).map(function(e){var r=e.gridPos,o=e.icon,i=e.label,s=e.shortcuts,a=e.key,c=e.onClick;return(0,ep.jsx)(sn.P,{gridColumn:r[1],gridRow:r[0],children:(0,ep.jsx)(ia.u,{hasArrow:!0,placement:"top",label:(0,ep.jsxs)(h.x,{whiteSpace:"nowrap",children:[i,(0,ep.jsx)(sp,{shortcuts:s})]}),children:(0,ep.jsx)(R.h,{m:1,shadow:"base",size:"md",variant:"S"==a&&n?"solid":"plain",isActive:t===a||"S"===a&&n,onClick:c,onMouseDown:function(e){return e.preventDefault()},"aria-label":i,icon:(0,ep.jsx)(v.G,{icon:o})})})},a)})})})})},sm=n(5751),sg=n(26721),sv=n(8022),sx=n(49747),sy=n(17651),sb=n(72466),sj=n(6185),sw=n.n(sj),sk=n(68642),sC=n(27875),sO=n.n(sC),sE=n(49381),sS=n(73497),sI={easeOutLinear:sS.gA,easeOutSine:sS.vh,easeOutCubic:sS.w2,easeOutCirc:sS.ei,easeOutQuad:sS.hl,easeOutQuart:sS.Y3,easeOutExpo:sS.ad,bezierCustom1:sw()(.13,.97,.035,.73),bezierCustom2:sw()(.105,1.15,.15,.355)},sP={UP:"up",DOWN:"down"},sD=function(e){return e?+new Date-+new Date(e):1/0},sT=function(e,t){var n=(0,j.useMemo)(function(){return new sk.Lethargy(6,120,.3,150)},[]),r=t||{},o=r.easing,i=void 0===o?"easeOutCubic":o,s=r.touchpadFactor,a=void 0===s?1.5:s,c=r.triggerThreshold,l=void 0===c?1200:c,u=(0,tY.As)("editor"),d=(0,X.CG)(Q.i2),f=(0,j.useRef)(null),p=(0,j.useRef)(null),h=(0,j.useRef)(null),m=(0,j.useRef)(!1),g=(0,j.useRef)(null),v=(0,j.useRef)(null),x=(0,j.useState)(!1),y=x[0],b=x[1],w=(0,j.useState)(!1),k=w[0],C=w[1],O=(0,j.useRef)({counterTarget:0,counterCurrent:0,direction:sP.DOWN}),E=(0,j.useCallback)(function(){if(f.current){var e,t=O.current.counterTarget/l*100,n=(null!=t?t:0)*2.64,r="".concat(n," ").concat(264-n),o=null===(e=f.current.querySelector(".chakra-progress"))||void 0===e?void 0:e.lastElementChild,i=f.current.querySelector(".chakra-progress__indicator");i&&i.setAttribute("stroke-dasharray",r),o&&(o.innerHTML="".concat(t.toFixed(0),"%"))}},[l]),S=(0,j.useCallback)(function(){var e=h.current,t=p.current;if(t&&e){var n=e.querySelector(".chakra-progress__indicator"),r=t.querySelector(".chakra-progress__indicator");if(n&&r){var o=O.current.counterCurrent/l,s=(550>sD(v.current)?1:null!=o?o:0)*264,a="".concat(s," ").concat(264-s),c=Math.max(56-56*sI[i](Math.min(o,1)),0);e.style.transform="translateY(".concat(c,"px)"),t.style.transform="translateY(-".concat(c,"px)"),r.setAttribute("stroke-dasharray",a),n.setAttribute("stroke-dasharray",a)}}},[i,l]),I=(0,j.useCallback)(function(){if(!m.current){var e;requestAnimationFrame(function t(n){var r=e?n-e:0;if(e=n,.1>Math.abs(O.current.counterTarget-O.current.counterCurrent)){O.current.counterCurrent=O.current.counterTarget,S(),m.current=!1;return}O.current.counterCurrent=(0,sS.t7)(O.current.counterCurrent,O.current.counterTarget,sO()(.3*(60/(r?1e3/r:60)),.3,1)),S(),requestAnimationFrame(t)})}},[S]),P=(0,j.useCallback)(function(){O.current.counterTarget=0,b(!1),C(!1),E(),I()},[I,E]);return(0,j.useEffect)(function(){if(!d||!e)return P();var t,r,o=document.querySelector((0,sE.ek)(d));if(!o)return P();var i=function(t){if(!t.target.closest("[data-comments-wrapper]")){var o=n.check(t);if(null!==h.current&&null!==p.current){var i=sD(g.current);if(!(i<500)&&(!(i<1e3)||!1!==o)){var s=sD(v.current);if(!(s<500)&&(!(s<1e3)||!1!==o)){var c=0===Math.abs(t.deltaY)?O.current.direction:t.deltaY>0?sP.DOWN:sP.UP;if("down"===c?u.isAtBottom():u.isAtTop()){clearTimeout(r);var d=t.wheelDeltaY?t.wheelDeltaY===-3*t.deltaY:0===t.deltaMode,f=Math.abs(void 0!==t.deltaY?t.deltaY:40);if(c!==O.current.direction){O.current.direction=c,P();return}C(c===sP.DOWN),b(c===sP.UP),O.current.counterTarget+=f*(d?a:1),O.current.direction=c,O.current.counterTarget/l>=1?(e.commands.spotlightNextCard(c===sP.UP,c===sP.UP?"bottom":"top"),v.current=+new Date,setTimeout(function(){P(),E()},250),setTimeout(function(){v.current=null},1e3)):r=setTimeout(P,500),I(),E()}}}}}},s=function(){g.current=+new Date,clearTimeout(t),P(),t=setTimeout(function(){g.current=null},1e3)};return o.addEventListener("scroll",s),o.addEventListener("wheel",i,{passive:!0}),E(),function(){o.removeEventListener("scroll",s),o.removeEventListener("wheel",i)}},[e,n,I,i,a,l,u,E,S,P,d]),{debugRef:f,nextCardRef:h,prevCardRef:p,showNextCard:k,showPrevCard:y}},sA=function(e){var t=e.editor,n=(0,n6.ye)("debugLogging"),r=(0,j.useState)("easeOutExpo"),o=r[0],i=r[1],s=(0,j.useState)(1.5),a=s[0],c=s[1],l=(0,j.useState)(1200),u=l[0],d=l[1],f=sT(t,{easing:o,touchpadFactor:a,triggerThreshold:u}),p=f.debugRef,h=f.nextCardRef,m=f.prevCardRef,g=f.showNextCard,v=f.showPrevCard,x=(0,X.CG)(function(e){var t=(0,Q.i2)(e)||"",n=(0,Q.X9)(e),r=Object.keys((n.parents[t]||[]).reduce(function(e,t){return e[t]},n.tree)),o=null,i=null;return r.forEach(function(e,s){if(e===t){var a=n.parents[t];0===s?a.length&&(o={cardId:a[a.length-1],isSibling:!1}):o={cardId:r[s-1],isSibling:!0},s===r.length-1?a.length&&(i={cardId:a[a.length-1],isSibling:!1}):i={cardId:r[s+1],isSibling:!0}}}),{prevCard:o,nextCard:i}},iY()),y=x.prevCard,b=x.nextCard,w=null==b?void 0:b.cardId,k=null==y?void 0:y.cardId,C=(0,j.useMemo)(function(){var e=null,n=null;return t&&t.state.doc.descendants(function(t){return!(0,tK.KH)(t)||(t.attrs.id===k?e=t:t.attrs.id===w&&(n=t),Boolean(!e&&k)||Boolean(!n&&w))}),{prev:e,next:n}},[t,w,k]);return(0,ep.jsxs)(ep.Fragment,{children:[n&&(0,ep.jsx)(sR,{ref:p,setEasing:i,setTouchpadFactor:c,setTriggerThreshold:d}),(0,ep.jsx)(sL,{ref:m,direction:"up",node:C.prev,enabled:v,offset:16}),(0,ep.jsx)(sL,{ref:h,direction:"down",node:C.next,enabled:g,offset:24})]})},sR=j.forwardRef(function(e,t){var n=e.setEasing,r=e.setTouchpadFactor,o=e.setTriggerThreshold;return(0,ep.jsxs)(p.k,{position:"absolute",alignItems:"center",bg:"gray.100",left:2,bottom:16,zIndex:"overlay",borderRadius:"md",border:"solid 2px var(--chakra-colors-trueblue-300)",p:1,children:[(0,ep.jsxs)(nN.v,{closeOnSelect:!1,children:[(0,ep.jsx)(nG.j,{as:ef.z,colorScheme:"trueblue",children:"Options"}),(0,ep.jsxs)(nW.q,{minWidth:"240px",children:[(0,ep.jsx)(x.kH,{label:"How much total scrolling work do we need to do to trigger next/prev card?",placement:"right",children:(0,ep.jsxs)(h.x,{color:"gray",fontSize:"sm",fontWeight:"600",ml:2,pb:2,children:["Scroll Threshold"," ",(0,ep.jsxs)("i",{children:["(default=",1200,")"]})]})}),(0,ep.jsxs)(sv.Y2,{defaultValue:1200,min:100,max:1e4,precision:0,step:100,onChange:function(e,t){return o(t)},children:[(0,ep.jsx)(sv.zu,{}),(0,ep.jsxs)(sv.Fi,{children:[(0,ep.jsx)(sv.WQ,{}),(0,ep.jsx)(sv.Y_,{})]})]}),(0,ep.jsx)(sx.R,{}),(0,ep.jsx)(x.kH,{label:"How much extra weight do we give to touchpad scroll events?",placement:"right",children:(0,ep.jsxs)(h.x,{color:"gray",fontSize:"sm",fontWeight:"600",ml:2,pb:2,children:["Touchpad Multiplier"," ",(0,ep.jsxs)("i",{children:["(default=",1.5,")"]})]})}),(0,ep.jsxs)(sv.Y2,{defaultValue:1.5,min:1,max:10,precision:1,step:.1,onChange:function(e,t){return r(t)},children:[(0,ep.jsx)(sv.zu,{}),(0,ep.jsxs)(sv.Fi,{children:[(0,ep.jsx)(sv.WQ,{}),(0,ep.jsx)(sv.Y_,{})]})]}),(0,ep.jsx)(sx.R,{}),(0,ep.jsxs)(nF._,{defaultValue:"easeOutExpo",title:"Easing (of peek element)",type:"radio",onChange:function(e){return n(e)},children:[(0,ep.jsx)(nB.i,{value:"easeOutLinear",children:"easeOutLinear"}),(0,ep.jsx)(nB.i,{value:"easeOutSine",children:"easeOutSine"}),(0,ep.jsx)(nB.i,{value:"easeOutCubic",children:"easeOutCubic"}),(0,ep.jsx)(nB.i,{value:"easeOutCirc",children:"easeOutCirc"}),(0,ep.jsx)(nB.i,{value:"easeOutQuad",children:"easeOutQuad"}),(0,ep.jsx)(nB.i,{value:"easeOutQuart",children:"easeOutQuart"}),(0,ep.jsx)(nB.i,{value:"easeOutExpo",children:"easeOutExpo"}),(0,ep.jsx)(nB.i,{value:"bezierCustom1",children:"bezierCustom1"}),(0,ep.jsx)(nB.i,{value:"bezierCustom2",children:"bezierCustom2"})]})]})]}),(0,ep.jsx)(p.k,{ref:t,direction:"column",alignItems:"center",width:"85px",ml:1,sx:{".chakra-progress__indicator":{transition:"none !important",opacity:1}},children:(0,ep.jsx)(sy.D,{value:40,color:"trueblue.500",children:(0,ep.jsx)(sb.i,{})})})]})});sR.displayName="PeekDebugger";var sL=j.forwardRef(function(e,t){var n=e.direction,r=e.enabled,o=e.node,i=e.offset,s=(0,j.useState)(!1),a=s[0],c=s[1],l=(0,j.useState)(o),u=l[0],d=l[1];(0,j.useEffect)(function(){c(!0);var e=setTimeout(function(){c(!1),d(o)},550);return function(){clearTimeout(e)}},[o]);var f=(0,j.useMemo)(function(){return u?(0,e5.getCardTitle)(u.toJSON()):""},[u]),m=Boolean(u);return(0,ep.jsx)(p.k,{ref:t,pointerEvents:"none",position:"absolute",justifyContent:"center",width:"100%",zIndex:"overlay",top:"up"===n?"".concat(i,"px"):"inherit",bottom:"down"===n?"".concat(i,"px"):"inherit",children:(0,ep.jsxs)(p.k,{bg:"gray.100",borderRadius:"md",boxShadow:"md",h:"".concat(40,"px"),maxWidth:"450px",justifyContent:"center",opacity:r?1:0,transition:"opacity ".concat(300,"ms ease-out"),textAlign:"center",alignItems:"center",direction:"row",px:2,sx:{".chakra-progress__indicator":{transition:"none !important",opacity:1}},children:[(0,ep.jsx)(sy.D,{display:m?"block":"none",color:"trueblue.500",size:"20px",thickness:"16px",children:(0,ep.jsx)(sb.i,{visibility:a?"visible":"hidden",children:(0,ep.jsx)(v.G,{icon:ie.faCircleCheck,fontSize:"14px",style:{color:"var(--chakra-colors-gray-100)",backgroundColor:"var(--chakra-colors-trueblue-500)",borderRadius:"10px"}})})}),m||"up"!==n?m||"down"!==n?null:(0,ep.jsx)(v.G,{icon:sm.m5,size:"xs",color:"var(--chakra-colors-gray-600)"}):(0,ep.jsx)(v.G,{icon:sg.yt,size:"xs",color:"var(--chakra-colors-gray-600)"}),(0,ep.jsx)(p.k,{width:1}),(0,ep.jsx)(h.x,{noOfLines:1,textOverflow:"ellipsis",overflowX:"hidden",fontSize:"md",color:m?"gray.800":"gray.600",px:2,children:m?f:"down"===n?"End of ".concat(x._u):"Start of ".concat(x._u)})]})})});sL.displayName="PeekCardTab";var s_=function(){var e=(0,j.useState)(["",[],{}]),t=e[0],n=e[1],r=(0,X.qr)();return(0,j.useEffect)(function(){return r.subscribe(function(){var e=r.getState(),t=(0,Q.X9)(e),o=(0,Q.i2)(e)||"",i=t.parents[o]||[],s={};Object.keys(t.tree).forEach(function(e){var n=[];(function e(t){Object.keys(t).forEach(function(r){n.push(r),e(t[r])})})(t.tree[e]),s[e]=n}),n([o,i,s])})},[r]),t},sZ=function(){var e=s_(),t=(0,I.Z)(e,3),n=t[0],r=t[1],o=t[2],i=Object.keys(o);return(0,ep.jsx)(es.U,{position:"fixed",bottom:0,w:"100vw",zIndex:10,background:"blackAlpha.200",px:"6px",py:"2px",align:"end",spacing:"2px",opacity:n?1:0,transitionProperty:"opacity",transitionDuration:"normal",children:i.map(function(e,t){var s=[].concat((0,rI.Z)(r),[n])[0],a=i.indexOf(s),c=o[s],l=0,u=100;return n&&c&&-1===i.indexOf(n)&&(l=(c.indexOf(n)+1)/c.length*100,u=1/c.length*100),(0,ep.jsx)(sN,{cardId:e,state:t===a?"current":t<=a?"prev":"next",percent:l,unit:u},e)})})},sM="var(--chakra-colors-trueblue-200)",sz="var(--chakra-colors-trueblue-100)",sN=function(e){var t=e.cardId,n=e.state,r=e.percent,o=e.unit,i="linear-gradient(to right, ".concat(sM," 0% ").concat(r,"%, ").concat("var(--chakra-colors-trueblue-300)"," ").concat(r,"% ").concat(r+o,"%, ").concat(sz," ").concat(r+o,"% 100%)");return(0,ep.jsx)(p.k,{borderRadius:"2px",flex:"1",h:"6px",bg:"current"===n?i:"prev"===n?sM:sz},t)},sG=(0,n3.ZP)("Esc"),sW=function(e){var t=e.editor,n=e.showNavigationControls,r=(0,w.v9)(Q.gh)===ez.qe.SLIDE_VIEW,o=(0,j.useState)(null),i=o[0],s=o[1],a=(0,w.v9)(Q.JA),c=(0,j.useRef)(a),l=(0,w.I0)(),u=su({enabled:r&&!a,setActiveKey:s});return(0,j.useEffect)(function(){l((0,Q.e)({isEditingInSlideView:!1}))},[r,l]),c.current=a,(0,j.useEffect)(function(){return nb.F7.on("keydown","SLIDE_VIEW",function(e){return!!(c.current&&sG(e))&&(l((0,Q.e)({isEditingInSlideView:!1})),e.preventDefault(),!0)})},[l]),(0,i8.u)(),(0,ep.jsxs)(ep.Fragment,{children:[r&&(0,ep.jsx)(sA,{editor:t}),r&&(0,ep.jsx)(sZ,{}),r&&(0,ep.jsx)(p.k,{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none",justify:"flex-end",children:(0,ep.jsxs)(p.k,{bg:"gray.50",position:"fixed",bottom:6,right:6,p:3,px:6,justify:"flex-end",align:"center",opacity:a?1:0,pointerEvents:a?"auto":"none",transitionProperty:"opacity, transform",transitionDuration:"normal",transitionTimingFunction:"ease",transform:a?"translate(0,0)":"translate(0,100%)",borderRadius:"md",shadow:"md",zIndex:"overlay",children:[(0,ep.jsx)(h.x,{size:"sm",mr:3,children:"You're editing this card."}),(0,ep.jsx)(ef.z,{size:"sm",variant:"solid",onClick:function(){return l((0,Q.e)({isEditingInSlideView:!1}))},children:"Done"})]})}),r&&n&&(0,ep.jsx)(sh,{activeKey:i,spotlightingByBlock:u})]})},sF=n(14355),sB=n(1472),sU=n(93319),sV=n(92743),sq=n(7099),sH=n(20010),sY=n(48273),sK=n(20412),sX=n(60577),sQ=n(81927),sJ=n(89397),s$="gray.700",s0=n(48322),s1=["error","refetch"];function s2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s5(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s2(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s2(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var s3=function(e){var t=e.error,n=e.refetch,r=(0,eF.Z)(e,s1);return(0,ep.jsx)(m.xu,s5(s5({px:6,py:4},r),{},{children:(0,ep.jsxs)(re.b,{p:6,status:"error",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",children:[(0,ep.jsx)(s0.z,{mr:0,boxSize:"30px",alignSelf:"center"}),(0,ep.jsx)(rt.C,{mt:4,mb:2,fontSize:"md",children:"There was an error loading the analytics data."}),(0,ep.jsx)(rn.X,{maxWidth:"md",children:t.message}),(0,ep.jsx)(ef.z,{mt:4,onClick:function(){return n()},children:"Retry"})]})}))},s6=n(19664),s4=n(97269),s9=n(92619),s7=n(85982),s8="".concat((0,x.kC)(x._u)," views"),ae="Card engagement",at=function(e){var t=e.isAnalyticsLoading,n=e.hasError,r=e.view,o=e.setView,i=e.description;return n?(0,ep.jsx)(s9.x,{children:"Analytics"}):(0,ep.jsxs)(p.k,{direction:"column",flex:1,children:[(0,ep.jsx)(s9.x,{children:t?(0,ep.jsx)(an,{}):(0,ep.jsxs)(ep.Fragment,{children:["Analytics",(0,ep.jsxs)(nC.g,{align:"stretch",spacing:4,children:[(0,ep.jsx)(h.x,{color:"gray.500",fontSize:"sm",fontWeight:"normal",letterSpacing:"normal",children:i}),(0,ep.jsxs)(s7.E,{children:[(0,ep.jsx)(s7.U,{children:(0,ep.jsx)(ef.z,{leftIcon:(0,ep.jsx)(v.G,{icon:s4.M,"aria-label":s8}),variant:"ghost",fontWeight:"600",bg:"deckView"===r?"trueblue.50":"transparent",color:"deckView"===r?"trueblue.500":s$,onClick:function(){return o("deckView")},children:s8})}),(0,ep.jsx)(s7.U,{children:(0,ep.jsx)(ef.z,{leftIcon:(0,ep.jsx)(v.G,{icon:s6.AG,"aria-label":ae}),variant:"ghost",fontWeight:"600",bg:"cardEngagement"===r?"trueblue.50":"transparent",color:"cardEngagement"===r?"trueblue.500":s$,onClick:function(){return o("cardEngagement")},children:ae})})]})]})]})}),(0,ep.jsx)(ni.o,{})]})},an=function(){return(0,ep.jsxs)(nC.g,{align:"stretch",spacing:4,children:[(0,ep.jsx)(sQ.O,{h:12,width:"30%"}),(0,ep.jsx)(sQ.O,{h:4,width:"80%"})]})},ar=n(74373),ao=n(64173),ai=function(e){var t=e.degree,n=e.alpha,r=e.startColor,o=e.endColor;if(Number.isNaN(t))return iX()("#e5e0df").toHex8String();var i=iX()(void 0===r?"#ECC94B":r).toHsl(),s=iX()(void 0===o?"#38A169":o).toHsl();return iX()({h:(0,sS.t7)(i.h,s.h,t),s:(0,sS.t7)(i.s,s.s,t),l:(0,sS.t7)(i.l,s.l,t),a:void 0===n?1:n}).toHex8String()},as=function(e){if(void 0===e)return"";var t=e/1e3;return'For a card to be considered "viewed" it must have been in the view of the browser for at least '.concat(t," ").concat(1===t?"second":"seconds",".")},aa=function(e,t){return e.reduce(function(e,n){return e[n.cardId]=n[t],e},{})},ac=function e(t,n){var r,o=0;for(var i in t)o+=(null!==(r=n[i])&&void 0!==r?r:0)+e(t[i],n);return o},al=function(e,t){var n,r=0;for(var o in e)r=Math.max((null!==(n=t[o])&&void 0!==n?n:0)+ac(e[o],t),r);return r},au=n(56623),ad=n(51068),af=n(67784),ap=n(92793),ah=n(8773),am=n(73968),ag=n(23769),av=n(13813),ax=n(16844);function ay(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ab(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ay(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ay(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var aj=function(e){var t=e.cardsViewed,n=e.totalCards,r=ai({degree:t/n}),o=n>0;return(0,ep.jsxs)(es.U,{spacing:3,children:[(0,ep.jsxs)(p.k,{flex:1,position:"relative",children:[(0,ep.jsx)(ax.E,{h:4,flex:1,borderRadius:"sm",value:t,max:o?n:void 0,bg:"gray.200",sx:{"> div":{bg:r}}}),o&&t===n&&(0,ep.jsx)(aw,{top:0,right:0,transform:"translate(50%,-50%)",position:"absolute"})]}),(0,ep.jsx)(h.x,{w:{base:10,lg:12},fontSize:"sm",whiteSpace:"nowrap",textAlign:"left",children:o?"".concat(t,"/").concat(n):"no data"})]})},aw=function(e){var t=(0,ag.Z)({},e);return(0,ep.jsx)(m.Cd,ab(ab({bg:"green.500",size:"18px",border:"2px solid white",color:"white"},t),{},{children:(0,ep.jsx)(v.G,{icon:av.LE,"aria-label":"checkmark",size:"xs"})}))};function ak(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function aC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ak(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ak(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var aO=function(e){var t,n=e.cards,r=e.isColorized,o=void 0!==r&&r,i=e.scaleToMax,s=void 0!==i&&i,a=e.includeChildren,c=e.leftLabel,l=e.rightLabel,u=e.getScreenshotLabel,d=e.tooltipLabel,f=e.cardLookupTable,p=e.onAnalyticsPanelClose,h=(t=a?al(n,f):Math.max.apply(Math,(0,rI.Z)(Object.values(f))),function(e){return(0,sS.t7)(0,100,e/t)}),g=(0,j.useCallback)(function(e){return h(e)},[h]);return(0,ep.jsxs)(m.xu,{mt:6,mb:4,children:[(0,ep.jsxs)(es.U,{mb:3,children:[(0,ep.jsx)(es.U,{children:(0,ep.jsx)(x.NZ,{children:c})}),(0,ep.jsx)(sU.L,{}),(0,ep.jsx)(es.U,{children:(0,ep.jsx)(x.kH,{placement:"top",label:d,children:(0,ep.jsx)(es.U,{children:(0,ep.jsx)(x.NZ,{borderBottom:"0.125em dashed",borderBottomColor:"gray.400",children:l})})})})]}),(0,ep.jsx)(m.xu,{width:"100%",children:Object.entries(n).map(function(e){var t,n=(0,I.Z)(e,2),r=n[0],i=n[1];return(0,ep.jsx)(aE,{id:r,childCards:i,percentage:null!==(t=f[r])&&void 0!==t?t:0,calculatePercentageScale:g,isColorized:o,cardLookupTable:f,scaleToMax:s,includeChildren:a,getScreenshotLabel:u,onAnalyticsPanelClose:p},r)})})]})},aE=function e(t){var n=t.id,r=t.cardLookupTable,o=t.childCards,i=t.percentage,s=t.calculatePercentageScale,a=t.isColorized,c=t.scaleToMax,l=t.includeChildren,u=t.getScreenshotLabel,d=t.onAnalyticsPanelClose,f=(0,n6.ye)("screenshotsEnabled"),g=(0,j.useState)(!1),y=g[0],b=g[1],w=(0,iM.Ux)({placement:"top",gutter:12,enterDelay:200}),k=w.referenceRef,C=w.popperRef,O=w.isHovering,E=w.getPopperProps,S=w.onMouseOver,P=w.onMouseOut,D=(0,j.useCallback)(function(){b(!y)},[y]),T=(0,j.useCallback)(function(){(0,am.D)({cardId:n}),d()},[n,d]),A=(0,ah.c)(n),L=Object.values(o).length>0,_=0===i,Z=l?i+ac(o,r):i,M=c?s(Z):Math.min(100,y?Z:0),z=y?i:Z,N=c?s(z):Math.min(100,z),G={startColor:"#F6AD55",endColor:"#68D391"},W=a?ai(aC({degree:M/100},G)):"trueblue.50",F=a?ai(aC({degree:N/100},G)):"trueblue.100";return(0,ep.jsxs)(ec.K,{children:[(0,ep.jsxs)(p.k,{direction:"column",onMouseOver:S,onMouseOut:P,children:[(0,ep.jsxs)(p.k,{ref:k,h:8,px:2,bg:"gray.100",borderRadius:"md",position:"relative",overflow:"hidden",alignItems:"center",_focusWithin:{shadow:"outline"},children:[(0,ep.jsxs)(es.U,{pos:"absolute",zIndex:1,children:[L&&(0,ep.jsx)(R.h,{"aria-label":"expand-card",size:"xs",variant:"ghost",isRound:!0,colorScheme:"blackAlpha",icon:(0,ep.jsx)(v.G,{icon:af._t}),transform:y?"rotate(90deg)":"",onClick:D,_focus:{shadow:"none"}}),!L&&(0,ep.jsx)(p.k,{w:6,justifyContent:"center",alignItems:"center",children:_?(0,ep.jsx)(x.kH,{label:"This card has not been seen",children:(0,ep.jsx)(m.xu,{color:"blackAlpha.500",children:(0,ep.jsx)(v.G,{icon:ad.Aq,size:"sm"})})}):(0,ep.jsx)(m.xu,{color:"blackAlpha.300",fontSize:"xx-small",children:(0,ep.jsx)(v.G,{icon:au.nZ,size:"sm"})})}),(0,ep.jsx)(h.x,{color:_?"blackAlpha.500":void 0,noOfLines:1,children:(null==A?void 0:A.title)||"Untitled"})]}),(0,ep.jsxs)(m.xu,{position:"absolute",w:"100%",height:"100%",top:0,left:0,pointerEvents:"none",children:[(0,ep.jsx)(m.xu,{position:"absolute",h:"100%",bg:_?"blackAlpha.200":W,w:"".concat(M,"%")}),(0,ep.jsx)(m.xu,{transitionProperty:"all",transitionDuration:"normal",position:"absolute",h:"100%",bg:_?"blackAlpha.300":F,w:"".concat(N,"%")})]}),a&&100===i&&(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(sU.L,{}),(0,ep.jsx)(aw,{alignSelf:"center",zIndex:1})]})]}),O&&(0,ep.jsx)(x.qh,aC({ref:C,src:f?null==A?void 0:A.previewUrl:ap.Z.src,fallbackSrc:ap.Z.src,shouldShow:O,onClick:T,tooltip:"Go to card (closes analytics panel)",label:u?u(i):void 0},E()))]}),(0,ep.jsx)(m.xu,{pl:8,children:L&&Object.entries(o).map(function(t){var n,o=(0,I.Z)(t,2),i=o[0],f=o[1];return(0,ep.jsx)(oJ.U,{in:y,children:(0,ep.jsx)(e,{id:i,childCards:f,percentage:null!==(n=r[i])&&void 0!==n?n:0,cardLookupTable:r,calculatePercentageScale:s,scaleToMax:c,isColorized:a,getScreenshotLabel:u,includeChildren:l,onAnalyticsPanelClose:d})},i)})})]})},aS=function(){return(0,ep.jsxs)(ec.K,{spacing:2,children:[(0,ep.jsx)(h.x,{children:'We keep a running counter for every second a card is "in view."'}),(0,ep.jsx)(h.x,{children:'A card is considered "in view" if the card takes up most or all of the browser window in doc or present mode. Nested cards must be expanded to count.'}),(0,ep.jsx)(h.x,{children:"We stop counting time on cards immediately if a user closes the tab, or 60s after they switch tabs."})]})},aI=function(e){var t=e.docId,n=e.viewerFilter,r=e.currentViewerFilterCount,o=e.onAnalyticsPanelClose,i=(0,X.qr)().getState(),s=(0,Q.X9)(i),a=(0,k.IrH)({variables:{docId:t}}),c=a.data,l=a.error,u=a.loading,d=a.refetch,f=(0,j.useState)("viewTimePercent"),p=f[0],h=f[1],g="viewTimePercent"===p?{chartDescription:"The average relative distribution of time spent across all cards, based on ".concat(r," unique ").concat(1===r?"viewer":"viewers","."),leftLabel:"Less time spent",rightLabel:"More time spent",createTooltipLabel:aS}:{chartDescription:"The percentage of viewers that saw a given card, based on ".concat(r," unique ").concat(1===r?"viewer":"viewers","."),leftLabel:"0% viewed this card",rightLabel:"100% viewed this card",createTooltipLabel:as,getScreenshotLabel:function(e){return"".concat(e,"% viewed")}},x=g.chartDescription,y=g.rightLabel,b=g.leftLabel,w=g.createTooltipLabel,C=g.getScreenshotLabel,O="viewersOnly"===n?"viewers":"everyone",E=w((0,n6.ye)("cardViewedThreshold")),S=(0,j.useMemo)(function(){var e;return(null==c?void 0:null===(e=c.docCardsStats)||void 0===e?void 0:e[O])||[]},[null==c?void 0:c.docCardsStats,O]),I=(0,j.useMemo)(function(){return aa(S,p)},[S,p]),P=(0,j.useCallback)(function(){return h("viewTimePercent")},[]),D=(0,j.useCallback)(function(){return h("viewersPercent")},[]);return(0,ep.jsxs)(m.xu,{children:[(0,ep.jsxs)(es.U,{my:4,children:[(0,ep.jsx)(ef.z,{leftIcon:(0,ep.jsx)(v.G,{icon:ao.SZ,"aria-label":"Time spend"}),variant:"ghost",fontWeight:"600",bg:"viewTimePercent"===p?"trueblue.50":"transparent",color:"viewTimePercent"===p?"trueblue.500":s$,onClick:P,children:"Time spent"}),(0,ep.jsx)(ef.z,{leftIcon:(0,ep.jsx)(v.G,{icon:ar.jG,"aria-label":"Percent viewed"}),variant:"ghost",fontWeight:"600",bg:"viewersPercent"===p?"trueblue.50":"transparent",color:"viewersPercent"===p?"trueblue.500":s$,onClick:D,children:"Viewed"})]}),(0,ep.jsx)(aD,{description:x}),l&&(0,ep.jsx)(s3,{error:l,refetch:d}),u&&!l&&(0,ep.jsx)(aP,{}),!u&&!l&&(0,ep.jsx)(aO,{cards:s.tree,cardLookupTable:I,scaleToMax:"viewTimePercent"===p,isColorized:"viewersPercent"===p,includeChildren:"viewTimePercent"===p,rightLabel:y,leftLabel:b,tooltipLabel:E,getScreenshotLabel:"viewersPercent"===p?C:void 0,onAnalyticsPanelClose:o})]})},aP=function(e){var t=e.includeDescription;return(0,ep.jsx)(p.k,{direction:"column",mt:6,mb:4,children:(0,ep.jsxs)(nC.g,{align:"stretch",children:[void 0!==t&&t&&(0,ep.jsx)(sQ.O,{h:5,mb:3,w:"70%"}),(0,rI.Z)([,,,,,]).map(function(e,t){return(0,ep.jsx)(sQ.O,{h:8},t)})]})})},aD=function(e){var t=e.description;return(0,ep.jsx)(h.x,{color:s$,children:t})},aT=n(89364),aA=n(73851),aR=n(36258),aL=n(19875),a_=n(77525),aZ=n(74642),aM=n(35319),az=n(27912),aN=n(13061),aG=n(96247),aW=["name","profileImg","email","isCreator","isContributor"];function aF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function aB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aF(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var aU=function(e,t){var n=t.toString();return 0===t&&(n="All "),"".concat(n," ").concat(1===t?e:e+"s"," (all time)")},aV={uniqueViewers:{label:"unique viewer",getTooltipText:function(){return"Unique viewers as defined by IP address, who viewed this since it was created on"},width:"40%"},lastOpened:{label:"last opened",width:"35%"},cardsViewed:{label:"cards viewed",getTooltipText:as,width:"25%"}},aq=function(e){var t=e.columns,n=e.uniqueViewers,r=e.docCreatedDate,o=(0,n6.ye)("cardViewedThreshold");return(0,ep.jsx)(aA.h,{children:(0,ep.jsx)(aR.Tr,{children:Object.entries(t).map(function(e){var t=(0,I.Z)(e,2),i=t[0],s=t[1],a=s.label,c=s.getTooltipText,l=s.width,u=c&&c(o);return(0,ep.jsx)(aH,{columnName:i,docCreatedDate:r,tooltipText:u,width:l,label:a,uniqueViewers:n},i)})})})},aH=function(e){var t=e.columnName,n=e.label,r=e.docCreatedDate,o=e.uniqueViewers,i=e.width,s=e.tooltipText,a=s;"uniqueViewers"===t&&(a+=" ".concat(r,"."));var c=(0,ep.jsx)(aL.Th,{w:i,children:(0,ep.jsx)(h.x,{display:"inline",borderBottom:s?"0.125em dashed":void 0,borderBottomColor:s?"gray.400":void 0,children:"uniqueViewers"===t?aU(n,o):(0,x.kC)(n)})});return s?(0,ep.jsx)(x.kH,{placement:"top",label:a,children:c}):c},aY=function(e){var t=e.viewers,n=e.currentViewerFilterCount,r=e.docCreatedDate,o=e.creatorId,i=e.contributors,s=e.cardCount,a=e.handleTableRowClick,c=(0,t2.SE)().user;return(0,ep.jsx)(a_.x,{children:(0,ep.jsxs)(aZ.i,{colorScheme:"blackAlpha",children:[(0,ep.jsx)(aq,{columns:aV,uniqueViewers:n,docCreatedDate:r}),(0,ep.jsx)(aM.p,{children:t.map(function(e,n){var r=e.user,l=e.lastOpened,u=e.visitorId,d=(null==r?void 0:r.id)===o,f=i.some(function(e){return e.user.id===(null==r?void 0:r.id)}),p=r?r.displayName+(r.id===(null==c?void 0:c.id)?" (You)":"")||"":u?(0,aG.e)(u):"Anonymous",m=l?(0,x.kC)((0,x.P9)(l)):"Date unknown",g={name:p,id:(null==r?void 0:r.id)||u||"",email:null==r?void 0:r.email,isCreator:d,isContributor:f,profileImg:null==r?void 0:r.profileImageUrl,lastOpened:m},v=n===t.length-1;return(0,ep.jsxs)(aR.Tr,{cursor:"pointer",onClick:function(){return a(g)},_hover:{bg:"blackAlpha.50"},borderBottom:"none",children:[(0,ep.jsx)(az.Td,{borderBottom:v?"0 none":void 0,children:(0,ep.jsx)(aK,{name:p,email:null==r?void 0:r.email,profileImg:null==r?void 0:r.profileImageUrl,isContributor:f,isCreator:d})}),(0,ep.jsx)(az.Td,{borderBottom:v?"0 none":void 0,children:(0,ep.jsx)(h.x,{fontSize:"sm",children:m})}),(0,ep.jsx)(az.Td,{borderBottom:v?"0 none":void 0,children:(0,ep.jsx)(aj,{cardsViewed:e.cardsViewed||0,totalCards:s||0})})]},(null==r?void 0:r.id)||u)})})]})})},aK=function(e){var t=e.name,n=e.profileImg,r=e.email,o=e.isCreator,i=void 0!==o&&o,s=e.isContributor,a=(0,eF.Z)(e,aW);return(0,ep.jsxs)(es.U,aB(aB({},a),{},{children:[(0,ep.jsx)(iq.q,{size:"sm",name:t,src:n}),(0,ep.jsxs)(ec.K,{spacing:.5,children:[(0,ep.jsx)(h.x,{children:t}),(0,ep.jsxs)(es.U,{mt:1,children:[(0,ep.jsx)(h.x,{fontSize:"sm",color:"gray.500",children:void 0===r?"":r}),(i||void 0!==s&&s)&&(0,ep.jsx)(aN.Vp,{size:"sm",transform:"translate(0, 1.5px)",children:i?"Creator":"Contributor"})]})]})]}))},aX=function(e){var t,n,r,o,i=e.user,s=e.onBackClick,a=e.docId,c=e.onAnalyticsPanelClose,l=(0,X.qr)().getState(),u=(0,Q.X9)(l),d=(0,k.IrH)({variables:{docId:a,userId:i.id},skip:!a||!i.id,pollInterval:9e5,notifyOnNetworkStatusChange:!0}),f=d.data,p=d.error,h=d.loading,g=d.refetch,v=null!==(t=null==f?void 0:null===(n=f.docCardsStats)||void 0===n?void 0:null===(r=n.everyone)||void 0===r?void 0:r.length)&&void 0!==t?t:0,x=null==f?void 0:null===(o=f.docCardsStats)||void 0===o?void 0:o.cardCount,y=(0,j.useMemo)(function(){var e;return(null==f?void 0:null===(e=f.docCardsStats)||void 0===e?void 0:e.everyone)||[]},[null==f?void 0:f.docCardsStats]),b=(0,j.useMemo)(function(){return aa(y,"viewTimePercent")},[y]);return(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(s9.x,{children:(0,ep.jsx)(ef.z,{"aria-label":"Back",leftIcon:(0,ep.jsx)(aT.R,{}),variant:"ghost",onClick:s,children:"Back"})}),(0,ep.jsx)(ni.o,{}),(0,ep.jsx)(ed.i,{}),(0,ep.jsx)(ns.f,{children:(0,ep.jsxs)(m.xu,{children:[(0,ep.jsx)(aQ,{user:i,showLastOpened:!0}),x&&(0,ep.jsx)(aD,{description:"Viewed ".concat(v,"/").concat(x," cards\n          across all sessions.")}),h&&!p&&(0,ep.jsx)(aP,{includeDescription:!0}),p&&(0,ep.jsx)(s3,{error:p,refetch:g}),!p&&!h&&(0,ep.jsx)(aO,{cards:u.tree,scaleToMax:!0,includeChildren:!0,leftLabel:"Less time spent",rightLabel:"More time spent",cardLookupTable:b,tooltipLabel:(0,ep.jsx)(aS,{}),onAnalyticsPanelClose:c})]})})]})},aQ=function(e){var t=e.user,n=e.showLastOpened;return(0,ep.jsxs)(es.U,{align:"center",my:6,children:[(0,ep.jsx)(aK,{name:t.name,profileImg:t.profileImg,email:t.email,isCreator:t.isCreator,isContributor:t.isContributor,width:n?"50%":void 0}),n&&(0,ep.jsxs)(nC.g,{align:"flex-start",spacing:0,children:[(0,ep.jsx)(x.NZ,{children:"Last opened"}),(0,ep.jsx)(h.x,{children:t.lastOpened})]})]})},aJ=n(87567),a$=n(47299),a0=n(81295),a1=n(26673),a2=function(e,t,n){return"everyone"===e?"Everyone (".concat(t,")"):"viewersOnly"===e?"Viewers only (".concat(n,")"):"Access link only"},a5={everyone:a0.Nd,viewersOnly:a$.Md,accessLinkOnly:aJ.uW},a3=function(e){var t=e.selected,n=e.handleMenuItemChange,r=e.everyoneCount,o=e.viewersOnlyCount;return(0,ep.jsxs)(nN.v,{children:[(0,ep.jsx)(nG.j,{leftIcon:(0,ep.jsx)(v.G,{size:"xs",icon:a5[t]}),as:ef.z,size:"md",rightIcon:(0,ep.jsx)(v.G,{size:"xs",icon:a1.pt}),children:a2(t,r,o)}),(0,ep.jsx)(nW.q,{zIndex:2,children:(0,ep.jsxs)(nF._,{defaultValue:t,value:t,onChange:function(e){Array.isArray(e)||n(e)},children:[(0,ep.jsx)(nB.i,{value:"everyone",isDisabled:0===r,children:(0,ep.jsxs)(p.k,{align:"center",children:[(0,ep.jsx)(v.G,{icon:a5.everyone,size:"xs"}),(0,ep.jsxs)(m.xu,{ml:3,children:[(0,ep.jsx)(h.x,{children:a2("everyone",r,o)}),(0,ep.jsx)(h.x,{fontSize:"sm",color:"gray.500",children:"Everyone who has viewed, edited or created the ".concat(x._u)})]})]})}),(0,ep.jsx)(nB.i,{value:"viewersOnly",isDisabled:0===o,children:(0,ep.jsxs)(p.k,{align:"center",children:[(0,ep.jsx)(v.G,{icon:a5.viewersOnly,size:"xs"}),(0,ep.jsxs)(m.xu,{ml:3,children:[(0,ep.jsx)(h.x,{children:a2("viewersOnly",r,o)}),(0,ep.jsx)(h.x,{fontSize:"sm",color:"gray.500",children:"Only people who viewed the ".concat(x._u)})]})]})}),!1]})})]})},a6=n(46102),a4=n(6802),a9=n(70258),a7=n(80237),a8=n(59309),ce=n(2574),ct=n(92638),cn=n(33951),cr=n(10897),co=n(14582),ci=n(75715),cs=n(96492),ca=n(14141),cc=n(40837),cl=["chartTitle","TooltipInner","showZero","shouldRoundYValues","showMaxAndMiddle","data","barColor","customTooltipStyles","onClick"];function cu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function cd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cu(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cu(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var cf={top:55,right:20,bottom:40,left:24},cp=function(e){return Math.round(e).toString()},ch={backgroundColor:"var(--chakra-colors-blackAlpha-800)",color:"var(--chakra-colors-gray-100)",fontFamily:"Inter, sans-serif",boxShadow:"var(--chakra-shadows-4)",fontSize:"var(--chakra-fontSizes-xs)",borderRadius:"var(--chakra-radii-sm)",fontWeight:"var(--chakra-fontWeights-semibold)",borderWidth:"1px",borderColor:"black",paddingRight:"var(--chakra-space-1.5)",paddingLeft:"var(--chakra-space-1.5)",paddingTop:"var(--chakra-space-0.5)",paddingBottom:"var(--chakra-space-0.5)",zIndex:"var(--chakra-zIndex-tooltip)",minWidth:"60px",lineHeight:"var(--chakra-lineHeights-base)"},cm="var(--chakra-colors-gray-500)",cg="var(--chakra-colors-gray-200)",cv=function(e){var t=e.width,n=e.height,r=e.margin,o=void 0===r?cf:r,i=e.chartData,s=e.TooltipInner,a=e.showZero,c=e.shouldRoundYValues,l=e.showMaxAndMiddle,u=e.barColor,d=e.customTooltipStyles,f=e.onClick,p=void 0===f?function(){}:f,h=(0,cs.Z)(),g=h.showTooltip,v=h.tooltipOpen,x=h.tooltipLeft,y=h.tooltipTop,b=h.tooltipData,w=h.hideTooltip,k=(0,j.useRef)(),C=(0,j.useRef)();(0,j.useEffect)(function(){return function(){k.current&&clearTimeout(k.current),C.current&&clearTimeout(C.current)}},[]);var O=i.map(function(e){return e.y}),E=Math.max.apply(Math,(0,rI.Z)(O)),S=[E,Math.round(E/2)],I=Math.max.apply(Math,(0,rI.Z)((l?S:O).map(function(e){return(0,ci.Z)(e.toString(),{fontFamily:"Inter, sans-serif",fontSize:"var(--chakra-fontSizes-sm)",fontWeight:"600"})||0}))),P=o.left+I,D=t-P-o.right,T=n-o.top-o.bottom,A=cd(cd(cd({},ca.j),ch),d),R=(0,j.useMemo)(function(){return(0,ct.Z)({range:[0,D],domain:i.map(function(e){return e.x}),padding:.3})},[D,i]),L=(0,j.useMemo)(function(){return(0,cn.Z)({range:[T,0],round:!0,domain:[0,E]})},[T,E]),_=a?L(Math.min.apply(Math,(0,rI.Z)(O.filter(function(e){return 0!==e})))):T,Z=a&&T-_>6;return(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(m.xu,{children:(0,ep.jsxs)("svg",{width:t,height:n,children:[(0,ep.jsx)("rect",{x:0,y:0,rx:4,width:t,height:n,fill:"var(--chakra-colors-gray-100)"}),(0,ep.jsx)(a8.Z,{top:o.top,left:P,children:i.map(function(e){var t,n,r=e.y,o=e.x,i="bar-".concat(o,"-").concat(r),s=R.bandwidth(),c=T-(null!==(t=L(r))&&void 0!==t?t:0),l=Z&&0===c?6:c,d=null!==(n=R(o))&&void 0!==n?n:0;return(0,ep.jsxs)(a8.Z,{children:[(0,ep.jsx)(cr.Z,{x:d,y:T-l,width:s,height:l,radius:5,topLeft:!0,topRight:!0,fill:a&&0===r?cg:u,onMouseLeave:function(){k.current=window.setTimeout(function(){w()},300)},onMouseMove:function(t){k.current&&clearTimeout(k.current);var n=(0,a7.Z)(t);g({tooltipData:e,tooltipTop:null==n?void 0:n.y,tooltipLeft:null==n?void 0:n.x})},onClick:function(t){return p(t,e)}}),(0,ep.jsx)(co.Z,{x:d,y:0,width:s,height:Math.max(0,T-l),opacity:0,onMouseLeave:function(){C.current=window.setTimeout(function(){w()},300)},onMouseMove:function(t){C.current&&clearTimeout(C.current);var n=(0,a7.Z)(t);g({tooltipData:e,tooltipTop:null==n?void 0:n.y,tooltipLeft:null==n?void 0:n.x})}})]},i)})}),(0,ep.jsx)(a4.Z,{top:o.top,left:P,scale:L,stroke:cg,strokeWidth:2,tickValues:l?S:void 0,numTicks:l?void 0:2,hideZero:!0,tickFormat:c?cp:void 0,tickLength:6,tickStroke:cg,tickLabelProps:function(){return{fill:cm,textAnchor:"end",fontFamily:"Inter, sans-serif",fontSize:"var(--chakra-fontSizes-sm)",fontWeight:"600",dy:"0.33em",dx:-4}}}),(0,ep.jsx)(a9.Z,{top:T+o.top,left:P,scale:R,stroke:cg,numTicks:4,tickStroke:cg,tickLabelProps:function(){return{fill:cm,textAnchor:"middle",fontFamily:"Inter, sans-serif",fontSize:"var(--chakra-fontSizes-sm)",fontWeight:"600",dy:4}},strokeWidth:2,tickLength:6})]})}),v&&b&&(0,ep.jsx)(cc.Z,{top:y,left:x,style:A,children:(0,ep.jsx)(s,{x:b.x,y:b.y})})]})},cx=function(e){var t=e.chartTitle,n=e.TooltipInner,r=e.showZero,o=void 0===r||r,i=e.shouldRoundYValues,s=void 0===i||i,a=e.showMaxAndMiddle,c=void 0===a||a,l=e.data,u=e.barColor,d=void 0===u?"var(--chakra-colors-trueblue-200)":u,f=e.customTooltipStyles,p=e.onClick,g=void 0===p?function(){}:p,v=(0,eF.Z)(e,cl);return(0,ep.jsxs)(m.xu,cd(cd({position:"relative",height:"300px"},v),{},{children:[(0,ep.jsx)(h.x,{size:"xs",color:"gray.500",fontWeight:"600",position:"absolute",top:3,left:"50%",transform:"translateX(-50%)",children:t}),(0,ep.jsx)(ce.Z,{children:function(e){var t=e.width,r=e.height;return t<10?null:(0,ep.jsx)(cv,{width:t,height:r,showZero:o,chartData:l,barColor:d,customTooltipStyles:f,onClick:g,TooltipInner:n,shouldRoundYValues:s,showMaxAndMiddle:c})}})]}))},cy=function(e){return e?(0,sJ.Z)((0,nD.Z)(e),"LLL d"):""},cb=function(e,t){var n=new Date;n.setDate(n.getDate()-t+1);for(var r=[],o=0;o<t;o++)!function(t){var o=new Date(n);o.setDate(o.getDate()+t);var i=(0,a6.Z)(o,{representation:"date"}),s=e.find(function(e){return e.date===i});s?r.push({x:cy(s.date),y:s.uniqueVisitors?s.uniqueVisitors:0}):r.push({x:cy(i),y:0})}(o);return r},cj="unique viewers",cw=function(e){var t=cb(e.viewData,e.dayCount),n="".concat((0,x.kC)(cj)," (last ").concat(t.length," days)");return(0,ep.jsx)(cx,{data:t,my:3,chartTitle:n,TooltipInner:ck})},ck=function(e){var t=e.x,n=e.y;return(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsxs)(h.x,{children:[null!=n?n:0," ",1===n?"unique viewer":cj]}),(0,ep.jsxs)(h.x,{children:["on ",t]})]})},cC=function(e,t,n){if(!n)return 0;var r,o,i,s=null!==(r=n.uniqueViewers)&&void 0!==r?r:0,a=null!==(o=null===(i=e.editors)||void 0===i?void 0:i.length)&&void 0!==o?o:0;return"everyone"===t?s:"viewersOnly"===t?Math.max(0,s-a):0},cO=function(e){var t,n,r,o,i=e.doc,s=e.handleSharePanelOpen,a=e.onAnalyticsPanelClose,c=(0,k.xls)({variables:{memoId:i.id},skip:!i.id,pollInterval:9e5,notifyOnNetworkStatusChange:!0}),l=c.loading,u=c.data,d=c.error,f=c.refetch,h=(0,j.useState)("deckView"),m=h[0],g=h[1],v=(0,j.useState)(null),x=v[0],y=v[1],b=(0,j.useState)("everyone"),w=b[0],C=b[1],O=(t=i.createdTime)?(0,sJ.Z)((0,nD.Z)(t),"PPP"):"",E=i.title||"Untitled",S=(null==u?void 0:u.memoStats.viewers)||[],I=(null==u?void 0:null===(r=u.memoStats.dailyViews)||void 0===r?void 0:r.dayCount)||0,P=(n=null==u?void 0:u.memoStats)&&n.dailyViews?"everyone"===w?n.dailyViews.everyone?n.dailyViews.everyone:[]:"viewersOnly"===w&&n.dailyViews.viewers?n.dailyViews.viewers:[]:[],D=P.every(function(e){return 0===e.uniqueVisitors}),T=S.filter(function(e){var t;return"everyone"===w||!(null!==(t=i.editors)&&void 0!==t&&t.some(function(t){var n,r;return(null===(n=e.user)||void 0===n?void 0:n.id)===(null===(r=t.user)||void 0===r?void 0:r.id)}))}),A=cC(i,w,null==u?void 0:u.memoStats),R=(0,j.useCallback)(function(e){C(e)},[]),L=(0,j.useCallback)(function(e){g(e)},[]),_=(0,j.useCallback)(function(e){y(e)},[]),Z=(0,j.useCallback)(function(){y(null)},[]),M=void 0!==d;return(0,ep.jsxs)(ep.Fragment,{children:[x&&(0,ep.jsx)(aX,{user:x,onBackClick:Z,docId:i.id,onAnalyticsPanelClose:a}),!x&&(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(at,{hasError:M,isAnalyticsLoading:l,setView:L,view:m,description:"".concat(E,", since it was created on ").concat(O)}),M&&(0,ep.jsx)(s3,{error:d,refetch:f}),!M&&(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(ed.i,{}),(0,ep.jsxs)(ns.f,{children:[l&&(0,ep.jsx)(cE,{}),!l&&S.length<=1&&(0,ep.jsx)(cS,{handleSharePanelOpen:s}),!l&&(0,ep.jsxs)(p.k,{direction:"column",mt:4,children:[(0,ep.jsxs)(p.k,{direction:"row",justify:"space-between",align:"center",children:[(0,ep.jsx)(el.X,{as:"h2",size:"md",children:"cardEngagement"===m?ae:s8}),(0,ep.jsx)(a3,{selected:w,handleMenuItemChange:R,everyoneCount:cC(i,"everyone",null==u?void 0:u.memoStats),viewersOnlyCount:cC(i,"viewersOnly",null==u?void 0:u.memoStats)})]}),"deckView"===m&&D&&(0,ep.jsx)(cI,{handleSharePanelOpen:s,dayCount:I}),"deckView"===m&&!D&&(0,ep.jsx)(cw,{viewData:P,dayCount:I}),"cardEngagement"===m&&(0,ep.jsx)(aI,{docId:i.id,viewerFilter:w,currentViewerFilterCount:A,onAnalyticsPanelClose:a}),(0,ep.jsx)(aY,{creatorId:(null===(o=i.createdBy)||void 0===o?void 0:o.id)||"",viewers:T,currentViewerFilterCount:A,docCreatedDate:O,contributors:i.editors||[],cardCount:(null==u?void 0:u.memoStats.cardCount)||0,handleTableRowClick:_})]})]})]})]})]})},cE=function(){return(0,ep.jsxs)(p.k,{direction:"column",py:2,children:[(0,ep.jsx)(sQ.O,{h:10,width:"40%",mb:4}),(0,ep.jsx)(sQ.O,{h:40,mb:4}),(0,ep.jsx)(nC.g,{align:"stretch",children:(0,rI.Z)([,,,]).map(function(e,t){return(0,ep.jsx)(sQ.O,{h:12},t)})})]})},cS=function(e){var t=e.handleSharePanelOpen;return(0,ep.jsx)(p.k,{p:3,px:4,mt:2,bg:"gray.100",color:s$,borderRadius:"base",children:(0,ep.jsxs)(p.k,{align:"baseline",fontSize:"sm",children:[(0,ep.jsx)(m.xu,{pr:2,children:(0,ep.jsx)(v.G,{icon:sX.IL,"aria-label":"user-icon",size:"sm"})}),(0,ep.jsxs)(h.x,{children:["Only you have seen this ",x._u,"."," ",(0,ep.jsx)(h.x,{as:"button",onClick:t,textDecoration:"underline",fontWeight:"600",color:"gray.800",children:"Share it with others"})," ","to track views and engagement."]})]})})},cI=function(e){var t=e.handleSharePanelOpen,n=e.dayCount;return(0,ep.jsxs)(re.b,{my:4,p:6,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",colorScheme:"gray",children:[(0,ep.jsx)(m.Cd,{size:"30px",bg:"gray.500",children:(0,ep.jsx)(v.G,{icon:sK.Im,color:"white"})}),(0,ep.jsx)(rt.C,{mt:4,mb:2,fontSize:"md",children:"No data to show"}),n>0&&(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(rn.X,{maxWidth:"sm",children:"No viewers to display for the last\n          ".concat(1===n?"day":"".concat(n," days"))}),(0,ep.jsxs)(ef.z,{mt:4,onClick:t,children:["Share this ",x._u]})]})]})},cP=n(20435),cD=function(e){var t,n,r,o,i,s,a=e.doc,c=e.onAnalyticsPanelClose,l=(0,X.qr)().getState(),u=(0,Q.X9)(l),d=(0,t2.SE)().user,f=(0,k.IrH)({variables:{docId:a.id,userId:null==d?void 0:d.id},skip:!(null!=d&&d.id),pollInterval:9e5,notifyOnNetworkStatusChange:!0}),p=f.data,g=f.error,v=f.loading,y=f.refetch,b=null!==(t=null==p?void 0:null===(n=p.docCardsStats)||void 0===n?void 0:null===(r=n.everyone)||void 0===r?void 0:r.length)&&void 0!==t?t:0,w=null==p?void 0:null===(o=p.docCardsStats)||void 0===o?void 0:o.cardCount,C=(0,j.useMemo)(function(){var e;return(null==p?void 0:null===(e=p.docCardsStats)||void 0===e?void 0:e.everyone)||[]},[null==p?void 0:p.docCardsStats]),O=(0,j.useMemo)(function(){return aa(C,"viewTimePercent")},[C]);if(!d)return null;var E=d.id===(null===(i=a.createdBy)||void 0===i?void 0:i.id),S=null===(s=a.editors)||void 0===s?void 0:s.some(function(e){return e.user.id===d.id}),I={name:d.displayName,id:d.id,profileImg:d.profileImageUrl,email:d.email,isContributor:S,isCreator:E};return(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsxs)(s9.x,{children:["Analytics",(0,ep.jsx)(h.x,{fontSize:"sm",fontWeight:"normal",letterSpacing:"normal",color:"gray.500",noOfLines:1,children:a.title||"Untitled"})]}),(0,ep.jsx)(ni.o,{}),(0,ep.jsx)(ed.i,{}),(0,ep.jsx)(ns.f,{children:(0,ep.jsxs)(m.xu,{children:[(0,ep.jsx)(aQ,{user:I}),void 0!==w&&(0,ep.jsx)(aD,{description:"Viewed ".concat(b,"/").concat(w," cards across all sessions.")}),v&&!g&&(0,ep.jsx)(aP,{includeDescription:!0}),g&&(0,ep.jsx)(s3,{error:g,refetch:y,px:0}),!g&&!v&&(0,ep.jsx)(aO,{cards:u.tree,scaleToMax:!0,includeChildren:!0,leftLabel:"Less time spent",rightLabel:"More time spent",cardLookupTable:O,tooltipLabel:(0,ep.jsx)(aS,{}),onAnalyticsPanelClose:c}),(0,ep.jsxs)(re.b,{children:[(0,ep.jsx)(s0.z,{}),'To help authors understand how people engage with their work, Gamma shares your relative (not actual) time spent across cards. Request "',cP.T6,'" from this ',x._u,"'s creator to view aggregate analytics for this ",x._u,"."]})]})})]})},cT=function(e){var t=e.doc,n=e.mode,r=e.isAnalyticsPanelOpen,o=e.onAnalyticsPanelClose,i=e.onSharePanelOpen,s=(0,ek.i)({base:"sm",md:"2xl",lg:"4xl"}),a=(0,j.useCallback)(function(){i&&(i(),o())},[i,o]);return(0,ep.jsx)(x.Wk,{isDark:!1,children:(0,ep.jsxs)(sH.u_,{onClose:o,isOpen:r,size:s,children:[(0,ep.jsx)(nr.Z,{}),(0,ep.jsxs)(sY.h,{children:["full"===n?(0,ep.jsx)(cO,{doc:t,handleSharePanelOpen:a,onAnalyticsPanelClose:o}):(0,ep.jsx)(cD,{doc:t,onAnalyticsPanelClose:o}),(0,ep.jsx)(ed.i,{my:4}),(0,ep.jsx)(na.m,{children:(0,ep.jsxs)(p.k,{justifyContent:"full"===n?"space-between":"flex-end",flex:1,children:["full"===n&&(0,ep.jsxs)(ef.z,{leftIcon:(0,ep.jsx)(v.G,{icon:sq.zB}),variant:"ghost",onClick:a,children:["Share this ",x._u]}),(0,ep.jsx)(ef.z,{variant:"solid",onClick:o,children:"Done"})]})})]})]})})},cA=n(42437),cR=n(30958),cL=n(27777),c_=function(e){var t=e.isOpen,n=e.onClose,r=e.onSaveSuccess,o=e.docId,i=(0,eJ.p)(),s=(0,j.useRef)(null),a=(0,j.useState)(""),c=a[0],l=a[1],u=(0,k.D1_)(),d=(0,I.Z)(u,2),f=d[0],p=d[1].loading,h=function(){f({variables:{id:o,title:c}}).then(function(){l(function(){return""}),r()}).catch(function(e){console.error(e),i({title:"Error saving title: ".concat(e.message),position:"top",status:"error"})})};return(0,ep.jsxs)(sH.u_,{returnFocusOnClose:!1,onClose:n,closeOnOverlayClick:!0,isOpen:t,initialFocusRef:s,children:[(0,ep.jsx)(nr.Z,{}),(0,ep.jsxs)(sY.h,{children:[(0,ep.jsxs)(s9.x,{children:["Name your ",x._u," before sharing"]}),(0,ep.jsx)(ni.o,{}),(0,ep.jsx)(ns.f,{children:(0,ep.jsx)(cL.I,{ref:s,value:c,required:!0,placeholder:"Untitled ".concat(x._u),onChange:function(e){return l(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&h()}})}),(0,ep.jsx)(na.m,{children:(0,ep.jsx)(ec.K,{spacing:2,direction:"row",align:"center",children:(0,ep.jsx)(ef.z,{isLoading:p,isDisabled:p||!c||!c.length,onClick:function(){h()},children:"Save"})})})]})]})},cZ=(0,j.memo)(function(e){var t=e.doc,n=(0,j.useCallback)(function(){return cA.T.emit("openSharePanel","invite")},[]),r=(0,nm.M)({id:"analyticsModalDisclosure"}),o=r.isOpen,i=r.onClose,s=r.onOpen,a=(0,nm.M)({id:"titleModalDisclosure"}),c=a.isOpen,l=a.onOpen,u=a.onClose,d=(0,tW.z$)(),f=(0,t2.SE)().user,h=(0,t2.py)("manage",t)&&Boolean(f),m=(0,j.useCallback)(function(){t&&(t.title&&""!==t.title?n():l())},[t,n,l]),g=(0,j.useCallback)(function(e){return function(){null==d||d.track(tW.AA.DOC_ANALYTICS_VIEWED,{docId:null==t?void 0:t.id,source:e,type:"full"}),s()}},[d,null==t?void 0:t.id,s]);return h&&t?(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(p.k,{children:(0,ep.jsx)(x.kH,{closeOnMouseDown:!1,closeOnClick:!1,label:"View analytics",children:(0,ep.jsx)(cR.r,{"data-guider-highlight":"view-analytics-button","aria-label":"View analytics",onMouseDown:tx.br,onClick:g("toolbar_analytics_block"),icon:(0,ep.jsx)(v.G,{icon:sV.M})})})}),c&&(0,ep.jsx)(c_,{onClose:u,isOpen:c,onSaveSuccess:function(){u(),n()},docId:null==t?void 0:t.id}),o&&(0,ep.jsx)(cT,{doc:t,onSharePanelOpen:m,onAnalyticsPanelClose:i,isAnalyticsPanelOpen:o,mode:"full"})]}):null}),cM=n(24657),cz=n(94370),cN=n(67755),cG=n(67925),cW=n(73716),cF=n(10920),cB=n(15756),cU=n(81410),cV=n(5632),cq=n(82625);function cH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function cY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cH(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cH(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var cK=(0,e7.E)(p.k),cX=function(e){var t=e.doc;return(0,ep.jsx)(cK,{initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},children:(0,ep.jsx)(e8.M,{initial:!1,children:(0,ep.jsx)(c1,{doc:t})})})},cQ=(0,j.memo)(function(e){var t=e.doc,n=(0,t9._i)().editor,r=(0,k.$gs)().isConnected,o=(0,eJ.p)(),i=(0,j.useRef)(null),s=(0,j.useRef)(null),a=(0,k.D1_)(),c=(0,I.Z)(a,2),l=c[0],u=c[1].loading,d=(0,j.useState)(null),f=d[0],p=d[1],h=(0,j.useState)(!1),g=h[0],v=h[1],y=(0,j.useState)(!1),b=y[0],w=y[1],C=(0,t2.py)("edit",t),O=(0,j.useCallback)(function(){if(!n)return"";var e=(0,tH.N2)(n.state.doc,tK.KH),t=(0,I.Z)(e,1)[0];return t&&(0,e5.getCardTitle)(t.node.toJSON())||""},[n]);(0,j.useEffect)(function(){!t||g||u||(p(t.title||""),w(!!t.titleEdited))},[t,g,u]);var E=function(){i.current.style.width=s.current.offsetWidth+0+"px"},S=(0,e1.ff)("gray.800","gray.200");return(0,ep.jsx)(x.kH,{label:C?r?"Rename":"You must be online to edit the title.":null,"aria-label":"rename",children:(0,ep.jsxs)(cN.C,{value:f||"",placeholder:f||O(),isDisabled:u||!C||!r,isPreviewFocusable:C,maxW:300,width:"100%",fontWeight:"normal",onCancel:function(){E(),v(!1)},onFocus:function(){E(),t&&!u&&v(!0)},onChange:function(e){E(),g&&(p(e),w(!!e))},onSubmit:function(){if(t&&!u){v(!1);var e=f||O();l({variables:{id:t.id,title:e,titleEdited:b}}).catch(function(e){console.error(e),o({title:"Error saving title: ".concat(e.message),position:"top",status:"error"})})}},children:[(0,ep.jsx)(cG.w,{px:1,py:.5,display:g?"inline":"block",overflowX:"hidden",textOverflow:"ellipsis",color:b?S:"inherit"}),(0,ep.jsx)(cW.V,{ref:i,px:1,py:.5,color:b?S:"inherit",maxW:300,_focus:{outline:"none",shadow:"0 0 0 2px rgb(66 153 225 / 60%)"}}),(0,ep.jsx)(m.xu,{ref:s,as:"span",display:"inline-block",position:"absolute",left:"-9999px",opacity:0,zIndex:-1,minW:"180px",px:1,dangerouslySetInnerHTML:{__html:il().sanitize((f||"").replace(/\s/g,"&nbsp;"))}})]})})});cQ.displayName="EditableDocTitle";var cJ=function(e){var t=e.cardId,n=e.isEllipsis,r=e.value,o=e.onClick,i=(0,ah.c)(t);if(n)return(0,ep.jsx)(v.G,{icon:cz.cN});if(!t&&!r)return null;var s=r||(null==i?void 0:i.title)||"";return(0,ep.jsx)(h.x,{noOfLines:1,onClick:o,maxW:180,fontWeight:"normal",children:s})},c$=function(e){var t=e.isPresentModeFlat;return function(e){var n=(0,Q.gh)(e),r=(0,Q.i2)(e)||"",o=(0,Q.X9)(e).parents[r]||[];if("DOC_VIEW"===n||t)return[{isHome:!0},{isDocTitle:!0}];var i=o[0],s=o[o.length-1];return[{isHome:!0},o.length>1?{cardId:i}:null,o.length>2?{isEllipsis:!0}:null,o.length>0?{cardId:s}:null,{cardId:r}]}},c0=function(){var e=(0,n6.ye)("presentModeFlat");return(0,X.CG)(c$({isPresentModeFlat:e}),function(e,t){return JSON.stringify(e)===JSON.stringify(t)})},c1=(0,j.memo)(function(e){var t=e.doc,n=c0(),r=(0,cq.X)($.H.lastHomeUrl,"/"),o=(0,I.Z)(r,1)[0],i=(0,n6.ye)("offline"),s=(0,t2.SE)().user,a=(0,k.$gs)().isConnected,c=(0,t9._i)().confirmNavigation,l=(0,cV.useRouter)().push,u=(0,ek.i)({base:"xs",sm:"sm"}),d=(0,e1.ff)("gray.500","gray.400"),g=(0,e1.ff)("gray.800","gray.100");return(0,ep.jsxs)(es.U,{spacing:0,as:ef.z,textAlign:"left",px:0,_hover:{color:g},h:8,children:[(0,ep.jsx)(cF.a,{display:"flex",alignItems:"center",whiteSpace:"nowrap",size:u,spacing:["4px","8px"],variant:"plainButton",separator:(0,ep.jsx)(m.xu,{color:"gray.300",mt:["0.2rem","0.125rem"],children:(0,ep.jsx)(v.G,{icon:af._t})}),children:n.map(function(e,r){if(!e)return null;var i=r===n.length-1,a=e.cardId,u=e.isEllipsis,f=e.isDocTitle,p=e.isHome,h=e.value,m=p?"home":u?"ellipsis":a||h||r;if(p&&!s)return null;var g={as:o2(),href:o||"/",colorScheme:"gray",fontWeight:"normal","data-testid":"toolbar-home-link"};return(0,ep.jsx)(cB.g,{children:(0,ep.jsx)(cK,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},children:(0,ep.jsx)(cU.A,cY(cY({isCurrentPage:i,pointerEvents:i&&!f?"none":"inherit",color:i?d:"inherit"},p?cY({},g):{}),{},{children:f?(0,ep.jsx)(cQ,{doc:t}):p?(0,ep.jsx)(e$.r,{href:g.href,onClick:function(e){e.preventDefault(),c().then(function(){l(g.href)})},mr:1,children:(0,ep.jsx)(v.G,{size:"1x",icon:cM.J9})}):(0,ep.jsx)(cJ,{cardId:a,value:h,isEllipsis:u,onClick:function(){a&&(0,am.D)({cardId:a,method:"push"})}})}))},m)},m)})}),!a&&(0,ep.jsx)(x.kH,{label:(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(h.x,{mr:2,children:"You're offline"}),i&&(0,ep.jsx)(h.x,{color:"gray.300",children:"Your changes will sync when you reconnect."})]}),"aria-label":"offline",children:(0,ep.jsx)(p.k,{color:"gray.300",alignItems:"center",pr:3,children:(0,ep.jsx)(v.G,{icon:f.bK})})})]})});c1.displayName="BreadcrumbGroup";var c2=n(76547),c5=n(82642),c3=n(30807),c6=n(80040),c4=n(28957),c9=function(){var e=(0,t2.SE)(),t=e.user,n=e.anonymousUser,r=(0,w.I0)(),o=(0,eJ.p)(),i=(0,t9._i)().editor,s=(0,w.v9)((0,Q._h)((null==t?void 0:t.id)||n.id)),a=s.collaborators,c=s.followers;i0({editor:i,collaborators:a,user:t});var u=(0,w.v9)(Q.Ok),d=(0,w.v9)(Q.e0),f=(0,w.v9)(Q.yn),m=(0,w.v9)(Q.gs),g=(0,w.v9)(Q.JA);(0,j.useEffect)(function(){u.forEach(function(e){o({duration:2e3,position:"bottom",render:function(){return(0,ep.jsxs)(p.k,{bg:"gray.50",p:3,px:6,align:"center",borderRadius:"md",shadow:"md",children:[(0,ep.jsx)(iq.q,{size:"sm",src:e.profileImageUrl,border:"solid 2px ".concat(e.color),color:iX()(e.color).isDark()?"white":"black",bg:e.color,ignoreFallback:!0}),(0,ep.jsxs)(h.x,{ml:2,children:[e.name," started following you."]})]})}})})},[u,o]),(0,j.useEffect)(function(){if(i&&!f&&m&&!g){o.closeAll();var e=o({id:"detached-toast",render:function(){return(0,ep.jsxs)(p.k,{bg:"gray.50",p:3,px:6,m:4,justify:"flex-end",align:"center",borderRadius:"md",shadow:"md",children:[(0,ep.jsx)(h.x,{size:"sm",mr:6,children:"You're exploring."}),(0,ep.jsxs)(nc.h,{size:"sm",alignItems:"center",children:[(0,ep.jsx)(ef.z,{onClick:function(){r((0,Q.Qx)({attached:!0}))},variant:"solid",children:"Back to following"}),(0,ep.jsx)(x.kH,{label:"Stop following",children:(0,ep.jsx)(R.h,{isRound:!0,variant:"ghost",size:"xs","aria-label":"Stop following",icon:(0,ep.jsx)(c5.T,{}),onClick:function(){r((0,Q.Qx)({attached:!1,following:null}))}})})]})]})},position:"bottom",duration:null});return function(){o.close(e)}}},[i,f,m,g,o,r]),(0,j.useEffect)(function(){m||!i||i.isDestroyed||r((0,Q.Qx)({following:null}))},[i,m,r]);var v=(0,ek.i)({base:4,md:6,xl:8})||6,y=v/(c.length?2:1),b=v/(a.length?2:1);return(0,ep.jsx)(p.k,{children:(0,ep.jsxs)(es.U,{divider:(0,ep.jsx)(c3.c,{borderColor:"gray.200"}),children:[c.length&&(0,ep.jsx)(c7,{type:l.FOLLOWERS,collaborators:c,max:b,isEveryone:0===a.length,localCollaborator:d,localIsAttached:f}),a.length&&(0,ep.jsx)(c7,{type:l.COLLABORATORS,collaborators:a,max:y,isEveryone:0===c.length,localCollaborator:d,localIsAttached:f})]})})};(i=l||(l={})).FOLLOWERS="FOLLOWERS",i.COLLABORATORS="COLLABORATORS";var c7=function(e){var t=e.collaborators,n=e.localCollaborator,r=e.localIsAttached,o=e.type,i=e.max,s=e.isEveryone,a=i$(),c=o===l.FOLLOWERS,u=t.length>i,d=u?t.slice(0,i-1):t,f=u?t.length-i+1:0,m=function(e){var t=e.localIsFollowing,n=e.collaborator;c||a({localIsFollowing:t,localIsAttached:r,collaborator:n})};return(0,ep.jsx)(c4.S,{children:(0,ep.jsxs)(c6.H,{size:"sm",spacing:c?-2:0,children:[c&&(0,ep.jsx)(c8,{isEveryone:s}),d.map(function(e,t){var o,i=(null==n?void 0:null===(o=n.memoState)||void 0===o?void 0:o.following)===e.sessionId,s=Boolean(e.idleSince),a=!c&&(u||d.length-1!==t);return(0,ep.jsx)(x.Vw,{ignoreFallback:!0,name:e.name,label:(0,ep.jsxs)(p.k,{direction:"column",justify:"center",align:"center",children:[(0,ep.jsx)(h.x,{children:e.name}),(0,ep.jsx)(h.x,{fontSize:"xs",children:c?"Is following you":i&&r?"Click to stop following":"Click to follow"})]}),pointerEvents:s?"none":"auto",opacity:s?.4:1,transitionProperty:"common",transitionDuration:"normal",src:e.profileImageUrl,border:"solid 2px ".concat(e.color),nubbin:i&&r,bg:e.color,shadow:"base",color:iX()(e.color).isDark()?"white":"black",cursor:c?"":"pointer",boxProps:a?{marginEnd:-2}:{},onClick:function(){return m({localIsFollowing:i,collaborator:e})}},e.sessionId)}),f>0&&(0,ep.jsxs)(x.Z9,{onClick:function(e){var r,o=t.find(function(t){return t.id===e.id});m({localIsFollowing:Boolean(o&&(null==n?void 0:null===(r=n.memoState)||void 0===r?void 0:r.following)===o.sessionId),collaborator:o})},avatars:t,count:f,disabled:c,children:[(0,ep.jsx)(h.x,{px:2,children:c?"".concat(t.length," people following you"):"".concat(t.length," people viewing or editing")}),!c&&(0,ep.jsx)(h.x,{px:2,fontSize:"sm",color:"gray.500",children:"Click to follow anyone"}),(0,ep.jsx)(sx.R,{})]})]})})},c8=function(e){var t=e.isEveryone,n=(0,j.useState)(!1),r=n[0],o=n[1],i=(0,j.useState)(!1),s=i[0],a=i[1],c=(0,j.useState)(!1),l=c[0],u=c[1];return((0,j.useEffect)(function(){!r&&t&&(a(!0),o(!0),setTimeout(function(){a(!1)},3e3))},[t,r]),t)?(0,ep.jsx)(m.xu,{fontSize:"sm",color:"",px:2,mr:2,children:(0,ep.jsx)(x.kH,{label:"Everyone is following you",isOpen:l||s,children:(0,ep.jsx)(m.xu,{mr:2,px:1,bg:"green.300",color:"green.900",borderRadius:"full",onMouseEnter:function(){return u(!0)},onMouseLeave:function(){return u(!1)},children:(0,ep.jsx)(v.G,{icon:c2.Md})})})}):(0,ep.jsx)(m.xu,{fontSize:"sm",color:"gray.700",pr:4,children:(0,ep.jsx)(v.G,{icon:c2.Md})})},le=n(60670),lt=n(10344),ln=n(48504),lr=(0,e7.E)(m.xu),lo=function(e){var t=e.commentFeedItems,n=e.editor,r=e.doc,o=e.user;return n&&o?(0,ep.jsx)(ec.K,{p:2,children:(0,ep.jsx)(e8.M,{initial:!1,children:t.map(function(e){return(0,ep.jsx)(lr,{layout:!0,initial:{opacity:0,scale:.85},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.85},bg:"gray.100",borderColor:"gray.200",borderWidth:"1px",borderRadius:"md",shadow:"sm",children:(0,ep.jsx)(ln.q,{comment:e,editor:n,selfUser:o,docId:r.id,userCanComment:!1,instanceType:"notification"},e.id)},e.id)})})}):null},li=n(38140),ls=n(39594);function la(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function lc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?la(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):la(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ll=function(e){return Boolean(e.comment)&&null!==e.timeout},lu=function(e){var t=e.user,n=e.docId,r=e.docComments,o=void 0===r?[]:r,i=e.pauseExiration,s=void 0!==i&&i,a=e.duration,c=void 0===a?5e3:a,l=(0,eJ.p)(),u=null==t?void 0:t.id,d=(0,j.useMemo)(function(){if(!u)return null;var e=new li.default(ls.v.KNOCK_PUBLIC_KEY);return e.authenticate(u),e},[u]),f=(0,j.useState)({}),p=f[0],h=f[1],m=(0,j.useRef)(!0),g=(0,j.useRef)(s);g.current=s,(0,j.useEffect)(function(){return function(){m.current=!1}},[]);var v=(0,j.useCallback)(function(){return h({})},[]),x=(0,j.useCallback)(function(e){h(function(t){return Object.entries(t).reduce(function(t,n){var r=(0,I.Z)(n,2),o=r[0],i=r[1];return(!0===e?-1===i.timeout:o===e)||(t[o]=i),t},{})})},[]);return(0,j.useEffect)(function(){s||x(!0)},[x,s]),(0,j.useEffect)(function(){Object.entries(p).forEach(function(e){var t=(0,I.Z)(e,2),n=t[0],r=t[1],i=r.entry;if(null===r.timeout){var s=i.data.commentId,a=null==o?void 0:o.find(function(e){return e.id===s});if(a){var l=setTimeout(function(){m.current&&(g.current?h(function(e){var t=lc({},e);return t[n].timeout=-1,t}):x(n))},c);h(function(e){return lc(lc({},e),{},(0,S.Z)({},n,{entry:i,comment:a,timeout:l}))})}}})},[p,o,c,x]),(0,j.useEffect)(function(){if(d&&n){var e=d.feeds.initialize(ls.v.KNOCK_FEED_ID,{source:"new-comment",status:"unseen"}),t=e.listenForUpdates();e.on("messages.new",function(t){var r=t.entries,o=(0,I.Z)(r,1)[0];o.data.docId===n&&(h(function(e){return lc(lc({},e),{},(0,S.Z)({},o.id,{entry:o,timeout:null}))}),e.markAsSeen(o).then(function(){console.debug("New notification marked as seen")}).catch(function(e){console.error("Unable to mark notification as seen",e)}))});var r=k.C9N.on("status",function(e){var t=e.isConnected,n=d.client();t?n.connectSocket():n.disconnectSocket()});return function(){r(),t()}}},[n,l,d]),{reset:v,comments:Object.values(p).filter(ll).map(function(e){return e.comment})}},ld=function(e){var t,n=e.toggleCommentsPanel,r=e.isCommentsPanelOpen,o=e.doc,i=e.mode,s=(0,t2.SE)().user,a=(0,t9._i)().editor,c=(0,iM.XI)(),l=(0,I.Z)(c,2),u=l[0],d=l[1],f=lu({user:s,docId:null==o?void 0:o.id,docComments:null==o?void 0:o.comments,pauseExiration:d}),p=f.comments,h=f.reset,m=Boolean(a&&o&&o.comments);(0,j.useEffect)(function(){if(m){var e=(0,o8.sY)().commentId;e&&nw.pw.emit(nw.TI.OPEN_POPUP_COMMENT,{commentId:e,highlightComment:!0})}},[m]),(0,j.useEffect)(function(){(r||i===ez.qe.SLIDE_VIEW)&&h()},[r,h,i]);var g=Boolean(p.length)&&!r&&i!==ez.qe.SLIDE_VIEW,x=(null==o?void 0:null===(t=o.comments)||void 0===t?void 0:t.filter(function(e){return e.status===k.Ux9.Open}).length)||0;return(0,ep.jsxs)(T.J,{isLazy:!0,lazyBehavior:"keepMounted",returnFocusOnClose:!1,isOpen:g,placement:"bottom",children:[(0,ep.jsx)(A.x,{children:(0,ep.jsx)(cR.h,{onMouseDown:tx.br,onClick:n,icon:(0,ep.jsx)(v.G,{icon:le.Mz}),isActive:r,"aria-label":r?"Hide comments":"Show comments",borderRadius:5,children:x})}),(0,ep.jsx)(eG.h,{children:o&&(0,ep.jsxs)(L.y,{bg:"white",shadow:"lg",border:"none",ref:u,children:[(0,ep.jsx)(lt.Q,{bg:"white"}),(0,ep.jsx)(lo,{editor:a,user:s,commentFeedItems:p,doc:o})]})})]})},lf=n(75695),lp=function(){return(0,ep.jsx)(p.k,{children:(0,ep.jsx)(x.kH,{closeOnMouseDown:!1,closeOnClick:!1,label:"Edit with AI",children:(0,ep.jsx)(cR.r,{"data-guider-highlight":"design-partner-button","aria-label":"Edit with AI",colorScheme:"trueblue",variant:"plain",onClick:function(){oW.T.emit("toggle",{})},icon:(0,ep.jsx)(v.G,{icon:lf.KC})})})})},lh=n(57895),lm=n(90282),lg=n(24799),lv=n(10649),lx=n(86378),ly=n(82904),lb=n(4036),lj=n(60807),lw=n(93316),lk=["label","initialValue","updateValue","helperText","language"];function lC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var lO=function(e){var t=e.label,r=e.initialValue,o=e.updateValue,i=e.helperText,s=e.language,a=(0,eF.Z)(e,lk),c=(0,j.useState)(void 0===r?"":r),l=c[0],u=c[1],d=(0,j.useState)(null),f=d[0],p=d[1],h=(0,iM.Kt)(o,100),g=(0,j.useState)(),v=g[0],x=g[1];(0,j.useEffect)(function(){"css"===s?Promise.all([n.e(8917),n.e(7120),n.e(6214)]).then(n.bind(n,96214)).then(function(e){x(e.css())}):"html"===s&&Promise.all([n.e(8917),n.e(7120),n.e(6214),n.e(4100),n.e(2163)]).then(n.bind(n,22163)).then(function(e){x(e.html())})},[s]),(0,iM.vm)(function(){p(null),h(l)},[l,h],[l]);var y=[v].filter(Boolean);return(0,ep.jsxs)(ii.NI,{isInvalid:!!f,children:[(0,ep.jsx)(is.l,{children:t}),f&&(0,ep.jsx)(lj.J1,{children:f}),i&&(0,ep.jsx)(ii.Q6,{children:i}),(0,ep.jsx)(m.xu,{border:"1px solid",borderColor:"gray.200",fontSize:"md",position:"relative",children:(0,ep.jsx)(j.Suspense,{fallback:(0,ep.jsx)("span",{}),children:(0,ep.jsx)(lw.B,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lC(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lC(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({value:l,extensions:y,onChange:u},a))})})]})},lE=n(64782),lS=(0,j.memo)(function(e){var t=e.isOpen,n=e.onClose,r=e.editor,o=(0,lE.A)(r),i=(0,X.CG)(Q.$p).bodyStart,s=(0,j.useCallback)(function(e){null==r||r.commands.updateNestedAttributesAtPos(0,{customCode:{bodyStart:e}})},[r]);return(0,ep.jsx)(x.Wk,{isDark:!1,children:(0,ep.jsxs)(nn.d,{returnFocusOnClose:!1,isOpen:t,placement:"right",onClose:n,size:"lg",children:[(0,ep.jsx)(nr.Z,{background:"none"}),(0,ep.jsxs)(no.s,{onKeyDown:o,"data-testid":"custom-code-drawer",motionProps:{variants:{enter:{x:"0%",transition:{duration:.2}},exit:{x:"100%",transition:{duration:.1}}}},children:[(0,ep.jsx)(ni.o,{}),(0,ep.jsx)(s9.x,{children:"Custom code"}),(0,ep.jsx)(ns.f,{overflowX:"hidden",children:(0,ep.jsx)(lO,{label:"Body Start HTML",helperText:"This will be added at the top of the <body> tag",initialValue:i,updateValue:s,language:"html",height:"600px"})}),(0,ep.jsx)(na.m,{children:(0,ep.jsx)(ef.z,{w:"100%",variant:"solid",onClick:n,children:"Done"})})]})]})})});lS.displayName="CustomCodeDrawer";var lI=function(e){var t=(0,X.CG)(Q.e_),n=(0,X.TL)(),r=(0,j.useCallback)(function(e){n((0,Q.Qt)({docAttrs:{format:e}}))},[n]);return(0,ep.jsx)(nc.h,{size:"sm",isAttached:!0,my:2,children:ig.n.map(function(e){return(0,ep.jsx)(ef.z,{isActive:e.key===t.key,onClick:function(){return r(e.key)},children:(0,x.kC)(e.label)},e.key)})})},lP=n(8848),lD=n(24798),lT=n(73848),lA=n(89190),lR=n(32361),lL=n(24171),l_=n(69930);function lZ(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var lM=function(e,t){var n=[];return!function e(r){if(t(r)&&n.push(r),r.content){var o,i=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return lZ(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lZ(e,t)}}(e))){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}(r.content);try{for(i.s();!(o=i.n()).done;){var s=o.value;e(s)}}catch(a){i.e(a)}finally{i.f()}}}(e),n},lz={today:"Today",thisWeek:"This week",earlier:"Older snapshots"},lN=function(){return(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(sQ.O,{w:"350px",h:12}),(0,ep.jsx)(lP.N,{mt:3,w:64,noOfLines:1})]})},lG=function(e){var t=e.createdTime,n=e.editors,r=e.isLatest,o=e.onClick,i=e.showPaywall,s=e.paywallCount;if(!n||!n.length)return(0,ep.jsx)(ep.Fragment,{});var a=i?"linear-gradient(rgb(0, 0, 0) 15%, transparent 100%)":"",c=(0,ep.jsxs)(lD.O,{flexDirection:"row",borderRadius:"base",style:{WebkitMaskImage:a,maskImage:a},border:"none",isDisabled:i,opacity:"1 !important",onClick:o,alignItems:"flex-start",width:"100%",textAlign:"left",children:[(0,ep.jsxs)(p.k,{w:"100%",direction:"column",children:[(0,ep.jsx)(h.x,{fontSize:"sm",children:(0,x.kC)((0,x.P9)(t))}),(0,ep.jsx)(h.x,{fontSize:"xs",flex:1,children:n[0].displayName})]}),r&&(0,ep.jsx)(lb.C,{colorScheme:"green",py:"0.5",fontSize:"0.65em",children:"Latest"})]});return i?(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(x.kH,{placement:"top",isDisabled:!i,label:i?"Upgrade to access ".concat(s," additional snapshots."):void 0,children:(0,ep.jsx)(m.xu,{mb:4,children:c})}),(0,ep.jsx)(lL.m,{isNarrow:!0,segmentEvent:tW.AA.GAMMA_PRO_UPSELL_CALLOUT_CHANGE_HISTORY,description:"Unlock unlimited change history."})]}):c},lW=function(e){var t,n=(0,ey.Yt)(),r=(0,j.useMemo)(function(){if("unlimited"===n)return{items:e,paywalledItems:[]};var t=parseInt(n),r=e.filter(function(e,n){return 0===n||(0,nD.Z)(e.createdTime)>=new Date(Date.now()-864e5*t)}),o=e.slice(r.length,e.length),i=o.length?o[0]:null;return{items:r.concat(i?[i]:[]),paywalledItems:o}},[n,e]),o=r.items,i=r.paywalledItems;return{groupedSnapshots:(0,j.useMemo)(function(){return nM({items:o,sortBy:"createdTime"})},[o]),paywalledSnapshotId:null===(t=i[0])||void 0===t?void 0:t.id,paywallCount:i.length}},lF=function(e){var t=e.groupedSnapshots,n=e.latestSnapshotId,r=e.paywalledSnapshotId,o=e.paywallCount,i=e.onClick,s=e.showFetchMore,a=e.onFetchMoreClick,c=e.isFetchingMore;return(0,ep.jsxs)(lT.t,{w:"100%",children:[Object.entries(t).filter(function(e){return(0,I.Z)(e,2)[1].length}).map(function(e){var t=(0,I.Z)(e,2),s=t[0],a=t[1];return(0,ep.jsxs)(j.Fragment,{children:[(0,ep.jsx)(x.NZ,{px:4,py:2,mx:0,mt:2,children:lz[s]}),a.map(function(e){var t=e.createdTime,s=e.editors,a=e.id;return(0,ep.jsx)(lG,{onClick:function(){return i(a)},isLatest:n===a,createdTime:t,editors:s,showPaywall:r===a,paywallCount:o},a)})]},s)}),s&&(0,ep.jsx)(ef.z,{isLoading:c,onClick:a,children:"Load more"})]})},lB=function(){return(0,ep.jsxs)(lT.t,{w:"100%",children:[(0,ep.jsx)(sQ.O,{h:16}),(0,ep.jsx)(sQ.O,{h:16,mt:2}),(0,ep.jsx)(sQ.O,{h:16,mt:2}),(0,ep.jsx)(sQ.O,{h:16,mt:2}),(0,ep.jsx)(sQ.O,{h:16,mt:2}),(0,ep.jsx)(sQ.O,{h:16,mt:2}),(0,ep.jsx)(sQ.O,{h:16,mt:2}),(0,ep.jsx)(sQ.O,{h:16,mt:2})]})},lU=function(e){var t=e.title,n=e.createdBy,r=e.createdTime,o=e.numSnapshots;return(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsxs)(h.x,{mt:1,children:[1===o?"One snapshot":"".concat(o," snapshots")," over the last ",(0,lR.Z)((0,nD.Z)(r))]}),(0,ep.jsx)(h.x,{color:"gray.500",fontSize:"sm",fontWeight:"normal",letterSpacing:"normal",children:"".concat(t,", created by ").concat(null!=n&&n.displayName?null==n?void 0:n.displayName:"Unknown"," on ").concat((0,sJ.Z)((0,nD.Z)(r),"PPp"))})]})},lV="snapshot-editor-root",lq=function(e){var t=e.id,n=e.doc,r=e.content,o=(0,j.useMemo)(function(){if(r)return lM(r,function(e){return e.type===r_.W4}).map(function(e){var t;return{__typename:"Card",id:(null===(t=e.attrs)||void 0===t?void 0:t.id)||"",docId:n.id,title:(0,e5.getCardTitle)(e),createdTime:n.createdTime,updatedTime:n.updatedTime,archived:!1}})},[r,n]);return(0,ep.jsx)(ez.fb,{reduxData:{cards:o},initialContent:r,doc:n,docId:n.id,scrollingParentSelector:".".concat(lV),isInsideDrawer:!0},t)},lH=function(e){var t=e.isOpen,n=e.onClose,r=e.doc,o=(0,eJ.p)(),i=(0,t9._i)().getCollaborativeEditorInstance,s=(0,j.useState)(!1),a=s[0],c=s[1],l=(0,k.pfN)({variables:{docId:r.id,first:25},skip:!r||!t,fetchPolicy:"network-only",nextFetchPolicy:"network-only"}),u=l.loading,d=l.data,f=l.called,h=l.fetchMore,g=(0,k.opq)({nextFetchPolicy:"cache-only"}),v=(0,I.Z)(g,2),y=v[0],b=v[1],w=b.loading,C=b.data,O=(null==d?void 0:d.snapshots.edges.map(function(e){return e.node}))||[],E=lW(O),S=E.groupedSnapshots,P=E.paywalledSnapshotId,D=E.paywallCount,T=null==d?void 0:d.snapshots.pageInfo,A=Boolean(f&&(null==T?void 0:T.hasNextPage)&&(null==T?void 0:T.endCursor)),R=(0,j.useCallback)(function(){null!=T&&T.hasNextPage&&null!=T&&T.endCursor&&(c(!0),h({variables:{after:T.endCursor}}).finally(function(){c(!1)}))},[h,null==T?void 0:T.endCursor,null==T?void 0:T.hasNextPage]),L=O[0];(0,j.useEffect)(function(){null!=L&&L.id&&y({variables:{snapshotId:L.id,docId:r.id}})},[r.id,y,null==L?void 0:L.id]);var _=(0,x.$L)(null==r?void 0:r.title),Z=null==r?void 0:r.createdBy,M=null==r?void 0:r.createdTime,z=null==C?void 0:C.snapshot,N=z&&z.id===r.currentSnapshotId;return(0,ep.jsx)(x.Wk,{isDark:!1,children:(0,ep.jsxs)(nn.d,{placement:"bottom",onClose:n,isOpen:t,trapFocus:!0,isFullHeight:!0,children:[(0,ep.jsx)(nr.Z,{}),(0,ep.jsxs)(no.s,{borderTopRadius:"xl",h:"calc(var(--100vh) - 24px)",transform:"none !important",children:[(0,ep.jsx)(ni.o,{}),(0,ep.jsxs)(s9.x,{borderBottom:"1px solid #000",borderColor:"gray.200",children:[u&&(0,ep.jsx)(lN,{}),r&&O&&(0,ep.jsx)(lU,{numSnapshots:(null==O?void 0:O.length)||0,createdBy:Z,createdTime:M,title:_})]}),(0,ep.jsx)(ns.f,{p:0,h:"100%",children:(0,ep.jsxs)(p.k,{direction:"row",h:"100%",children:[(0,ep.jsx)(m.xu,{p:2,w:"17rem",overflowY:"auto",bg:"gray.50",children:(0,ep.jsxs)(lA.m,{variant:"soft-rounded",orientation:"vertical",size:"md",children:[u&&(0,ep.jsx)(lB,{}),!u&&O&&(0,ep.jsx)(lF,{onClick:function(e){y({variables:{snapshotId:e,docId:r.id}})},groupedSnapshots:S,paywalledSnapshotId:P,paywallCount:D,latestSnapshotId:r.currentSnapshotId,showFetchMore:A,onFetchMoreClick:R,isFetchingMore:a})]})}),(0,ep.jsx)(p.k,{flex:1,bg:"gray.100",overflowY:"scroll",justifyContent:"center",alignContent:"center",alignItems:"flex-start",width:"100%",height:"100%",className:lV,css:{"--editor-width":"100%"},children:(0,ep.jsxs)(p.k,{direction:"column",position:"relative",width:"100%",height:"100%",children:[(0,ep.jsx)(l_.Y,{}),(!z||w)&&(0,ep.jsx)(nd.AA,{}),z&&!w&&(0,ep.jsx)(lq,{id:z.id,doc:r,content:null==z?void 0:z.content.default})]})})]})}),(0,ep.jsx)(na.m,{borderTop:"1px solid #000",borderColor:"gray.200",children:(0,ep.jsxs)(nc.h,{spacing:4,children:[(0,ep.jsx)(ef.z,{variant:"ghost",onClick:n,children:"Cancel"}),(0,ep.jsx)(x.kH,{label:N?"This is the latest snapshot":"Restore to this snapshot",shouldWrapChildren:!0,children:(0,ep.jsx)(ef.z,{variant:"solid",isDisabled:!z||N,onClick:function(){if(z){var e,t=null==O?void 0:null===(e=O.find(function(e){return e.id===z.id}))||void 0===e?void 0:e.createdTime,r=i();if(r){r.commands.setContent(z.content.default,!0);var s=z.content.annotationsAbsolute;s?r.commands.restoreAnnotations(s):r.commands.clearAnnotations(),n(),o({title:"Restored ".concat(x._u),description:"".concat((0,x.kC)(x._u)," restored to ").concat(t?(0,sJ.Z)((0,nD.Z)(t),"PPp"):"selected snapshot"),status:"success",duration:5e3,isClosable:!0})}}},children:"Restore"})})]})})]})]})})};function lY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function lK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lY(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var lX=function(e){var t,n,r=e.doc,o=(0,t2.SE)().user,i=(0,k.$gs)().isConnected,s=(0,iZ.e)(),a=(0,t9._i)().editor,c=(0,x.$L)(null==r?void 0:r.title),l=(null==r?void 0:r.createdTime)&&(0,sJ.Z)((0,nD.Z)(r.createdTime),"PPP"),u=null==r?void 0:r.id,d=(0,nm.M)({id:"snapshotsDrawer"}),f=d.isOpen,p=d.onClose,g=d.onOpen,y=(0,nm.M)({id:"analyticsPanelDisclosure"}),b=y.isOpen,w=y.onClose,C=y.onOpen,O=(0,k.LT4)(),E=(0,I.Z)(O,1)[0],S=(0,k.iX9)(),P=(0,I.Z)(S,1)[0],D=(0,tW.z$)(),T=(0,t2.py)("view",r)&&Boolean(o),A=(0,t2.py)("edit",r),R=(0,t2.py)("manage",r)&&Boolean(o),L=Boolean(o&&0!==o.workspaceMemberships.length),_=(0,n6.ye)("docFormats"),Z=Boolean(o)&&!R,M=(0,X.CG)(Q.hN),z=(0,j.useCallback)(function(){null==D||D.track(tW.AA.DOC_ANALYTICS_VIEWED,{docId:u,source:"toolbar_doc_menu",type:"personal"}),C()},[D,u,C]),N=(0,j.useCallback)(function(e){return function(){if(u){var t={id:u};e?E({variables:t,optimisticResponse:{archiveDoc:lK(lK({},t),{},{archived:e,__typename:"Doc"})}}):P({variables:t,optimisticResponse:{unarchiveDoc:lK(lK({},t),{},{archived:e,__typename:"Doc"})}})}}},[E,u,P]),G=(0,j.useCallback)(function(){a&&a.commands.undo()},[a]),W=(0,nm.M)({id:"codeEditor"}),F=W.isOpen,B=W.onOpen,U=W.onClose,V=(0,n6.ye)("docCustomCode")&&A;return(0,ep.jsxs)(nN.v,{children:[(0,ep.jsx)(nG.j,{as:cR.r,borderRadius:"md",isDisabled:f,icon:(0,ep.jsx)(v.G,{icon:cz.cN}),onMouseDown:tx.br,"data-testid":"doc-toolbar-menu-button"}),(0,ep.jsx)(eG.h,{children:r&&(0,ep.jsxs)(nW.q,{zIndex:"popover",children:[(0,ep.jsxs)(m.xu,{px:4,py:2,maxWidth:"300px",children:[(0,ep.jsx)(h.x,{children:c}),(0,ep.jsxs)(h.x,{fontSize:"sm",color:"gray.500",noOfLines:1,children:["Created ",l]}),(0,ep.jsx)(x.kH,{label:null==r?void 0:null===(t=r.createdBy)||void 0===t?void 0:t.email,children:(0,ep.jsxs)(h.x,{display:"inline-block",fontSize:"sm",color:"gray.500",noOfLines:1,children:["by ",null==r?void 0:null===(n=r.createdBy)||void 0===n?void 0:n.displayName]})}),_&&(0,ep.jsx)(lI,{})]}),(0,ep.jsx)(sx.R,{}),(0,ep.jsx)(nX.V,{label:"".concat((0,x.kC)(x._u)," options will be available when you reconnect."),isConnected:i,maxWidth:"300px"}),i&&(0,ep.jsxs)(ep.Fragment,{children:[Z&&(0,ep.jsx)(ly.s,{icon:(0,ep.jsx)(v.G,{icon:sV.M,fixedWidth:!0}),onClick:z,children:"Analytics"}),L&&(0,ep.jsx)(ly.s,{icon:(0,ep.jsx)(v.G,{icon:lx.kZ,fixedWidth:!0}),onClick:function(){a&&s({docId:u,initialContent:a.getJSON(),source:"editor_toolbar_doc_menu_duplicate",newWindow:!(0,o7.Q5)()})},children:"Duplicate"}),T&&(0,ep.jsx)(ly.s,{icon:(0,ep.jsx)(v.G,{icon:lv.kw,fixedWidth:!0}),onClick:function(){cA.T.emit("openSharePanel","export")},children:"Export..."}),V&&(0,ep.jsxs)(ly.s,{icon:(0,ep.jsx)(v.G,{icon:lg.dT,fixedWidth:!0}),onClick:B,children:["Custom code"," ",(0,ep.jsx)(lb.C,{colorScheme:"green",ml:2,children:"Beta"})]}),M&&(0,ep.jsx)(sx.R,{}),M&&(0,ep.jsx)(ly.s,{icon:(0,ep.jsx)(v.G,{icon:lm.faArrowRotateLeft,fixedWidth:!0}),onClick:G,command:(0,x.cE)("Mod+Z"),children:"Undo"}),A&&(0,ep.jsx)(ly.s,{icon:(0,ep.jsx)(v.G,{icon:ao.SZ,fixedWidth:!0}),onClick:g,children:"Version history"}),R&&(0,ep.jsx)(sx.R,{}),R?r.archived?(0,ep.jsx)(ly.s,{icon:(0,ep.jsx)(v.G,{icon:lh.Ze,fixedWidth:!0}),onClick:N(!1),children:"Restore"}):(0,ep.jsx)(ly.s,{"data-testid":"doc-menu-trash-button",color:"red.500",icon:(0,ep.jsx)(v.G,{icon:eY.$,fixedWidth:!0}),onClick:N(!0),children:"Send to trash"}):null]})]})}),r&&(0,ep.jsx)(lH,{doc:r,isOpen:f,onClose:p}),r&&b&&(0,ep.jsx)(cT,{doc:r,isAnalyticsPanelOpen:b,onAnalyticsPanelClose:w,mode:"personal"}),V&&(0,ep.jsx)(lS,{editor:a,isOpen:F,onClose:U})]})},lQ=n(96622),lJ=n(20387),l$=n(22595),l0=n(26886),l1=n(71528),l2=n(26384),l5=n(84558),l3=n(91930),l6=n(95264),l4=n(46078),l9=(0,n3.ZP)("mod+Enter"),l7=(0,n3.ZP)("Esc"),l8=(0,n3.ZP)("mod+Esc"),ue=(0,n3.ZP)("shift+mod+Enter"),ut=function(e,t){var n=document.querySelector(t);if(n){var r=n.getBoundingClientRect();e.commands.scrollToNodeWithPin(document.elementFromPoint(r.width/2,100),100)}},un=function(e){var t=e.editorWrapperEl,n=e.scrollingParentSelector,r=(0,X.TL)(),o=(0,j.useState)(!1),i=o[0],s=o[1],a=(0,j.useState)(!1),c=a[0],l=a[1],u=(0,t9._i)().editor,d=(0,X.CG)(Q.gh),f=(0,j.useRef)(d);(0,j.useEffect)(function(){f.current=d},[d]);var p=(0,X.CG)(Q.yq),h=(0,X.CG)(Q.JA),m=(0,X.CG)(sr.C),g=(0,tW.z$)(),v=(0,j.useCallback)(function(e){u&&!u.isDestroyed&&(e===tQ.q.SLIDE_VIEW?((0,l4.E0)(u.state.doc,r),(0,ss.U6)(u,!1),u.commands.spotlightCurrentCard()):(u.commands.turnOffSpotlight(!0),ut(u,n)),r(function(t){t((0,Q.Qx)({attached:!1})),t((0,Q.PM)({mode:e}))}))},[r,u,n]),x=(0,j.useCallback)(function(){try{var e,t,n,r;if(null!==(e=document.body)&&void 0!==e&&e.requestFullscreen){null===(n=document.body)||void 0===n||n.requestFullscreen();return}null!==(t=document.body)&&void 0!==t&&t.webkitRequestFullscreen&&(null===(r=document.body)||void 0===r||r.webkitRequestFullscreen())}catch(o){console.debug("[PresentBlock] Error entering fullscreen:",o)}},[]),y=(0,j.useCallback)(function(){try{if(document.fullscreenElement){document.exitFullscreen();return}document.webkitCurrentFullScreenElement&&document.webkitExitFullscreen&&document.webkitExitFullscreen()}catch(e){console.debug("[PresentBlock] Error exiting fullscreen:",e)}},[]),b=(0,n6.ye)("realUserMetrics"),w=(0,l6.wK)(b),k=w.recordExitSlideModePerformance,C=w.recordEnterSlideModePerformance,O=(0,j.useCallback)(function(e){var t=e.fullscreen,n=void 0!==t&&t;f.current!==tQ.q.SLIDE_VIEW&&(v(tQ.q.SLIDE_VIEW),n&&x(),null==g||g.trackDocEvent(tW.AA.PRESENT_MODE_ENTERED),C({isFullscreen:n}),setTimeout(function(){document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur()}))},[v,C,x,f,g]),E=(0,j.useCallback)(function(){f.current!==tQ.q.DOC_VIEW&&(v(tQ.q.DOC_VIEW),i&&y(),null==g||g.trackDocEvent(tW.AA.PRESENT_MODE_EXITED),k({isFullscreen:i}))},[v,i,y,k,f,g]);return(0,j.useEffect)(function(){var e=function(){null!==document.fullscreenElement||c||E(),null!==document.webkitCurrentFullScreenElement||c||E(),s(function(e){return!e}),l(!1)};return document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),function(){document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e)}},[c,E,y]),(0,i3.r)(function(){u&&!u.isDestroyed&&d===tQ.q.DOC_VIEW&&requestAnimationFrame(function(){var e=u.state.selection;e instanceof iQ.c&&u.commands.command(function(t){return t.tr.setSelection(e.createSelectionNear()),!0})})},[u,d]),(0,j.useEffect)(function(){return nb.F7.on("keydown","PRESENT_BLOCK",function(e){var t,n,r,o=f.current===tQ.q.SLIDE_VIEW;if(!m){if(l9(e)){if(null!=e&&null!==(t=e.target)&&void 0!==t&&t.closest("[data-gamma-child-tiptap-editor]"))return;return e.preventDefault(),O({fullscreen:!1}),!0}if(ue(e)){if(null!=e&&null!==(n=e.target)&&void 0!==n&&n.closest("[data-gamma-child-tiptap-editor]"))return;return e.preventDefault(),O({fullscreen:!0}),!0}if(l8(e)&&o)return E(),!0;if(l7(e)&&o&&!p&&!h){if(null!=e&&null!==(r=e.target)&&void 0!==r&&r.closest("[data-gamma-child-tiptap-editor]"))return;return E(),!0}}})},[O,E,x,p,h,t,m]),{enterSlideView:O,exitSlideView:E,enterFullscreen:x,exitFullscreen:y,exitedFullscreenByClick:c,isFullscreen:i,setIsFullscreen:s,setExitedFullscreenByClick:l}},ur=n(7328),uo=n(84807),ui=n(28165),us={followOnStart:"follow_on_start",followingId:"following_id"},ua=function(e,t){var n=t.followOnStart,r=t.followingId,o=new URL(e);return r&&o.searchParams.append(us.followingId,r),n&&o.searchParams.append(us.followOnStart,"true"),o.toString()},uc=function(e){var t,n,r=e.isOpen,o=e.onClose,i=e.accessLinkUrl,s=e.onPlayClick,a=(0,t2.SE)().user,c=(0,cV.useRouter)().replace,l={followOnStart:!0,followingId:null==a?void 0:a.id},d=(0,j.useState)(l),f=d[0];d[1];var p=ua(i,f),g=(0,t2.SE)(),y=g.user,b=g.color,w=(0,X.CG)(t7.yx),k=null==w?void 0:null===(t=w.accessLinks)||void 0===t?void 0:null===(n=t[0])||void 0===n?void 0:n.permission,C=(0,ui.keyframes)(u||(u=(0,ur.Z)(["\n    0% { transform: scale(1.0); filter: brightness(1.0);  }\n    3% { transform: scale(1.0); filter: brightness(1.0);  }\n    8% {  transform: scale(0.90); filter: brightness(1.30);  }\n    18% { transform: scale(1.05); filter: brightness(1.0); }\n    30% { transform: scale(1.0); filter: brightness(1.0); }\n  "])));return(0,ep.jsx)(x.Wk,{isDark:!1,children:(0,ep.jsxs)(sH.u_,{isOpen:r,onClose:o,size:"lg",children:[(0,ep.jsx)(nr.Z,{}),(0,ep.jsxs)(sY.h,{children:[(0,ep.jsx)(s9.x,{children:"Follow link"}),(0,ep.jsx)(ni.o,{}),(0,ep.jsx)(ed.i,{}),(0,ep.jsx)(ns.f,{pt:"6",children:(0,ep.jsxs)(ec.K,{spacing:"4",children:[(0,ep.jsxs)(h.x,{children:["Anyone with this link will get"," ",(0,ep.jsx)(x.kH,{label:"You can change these settings in the share panel",placement:"top",children:(0,ep.jsxs)(h.x,{as:"span",fontWeight:"bold",borderBottom:"1px dashed",borderColor:"gray.400",display:"inline-block",children:[null!=k?k:"view"," access"]})})," ","to this ",x._u,", and automatically start following your position in the ",x._u," when they open it."]}),(0,ep.jsx)(m.xu,{mb:"2",children:(0,ep.jsx)(x.Iq,{url:p,variant:"solid"})}),(0,ep.jsxs)(re.b,{children:[(0,ep.jsx)(s0.z,{}),(0,ep.jsxs)(es.U,{flexBasis:"100%",alignItems:"top",children:[(0,ep.jsx)(h.x,{fontSize:"sm",width:"100%",children:"Tip: people can also follow you anytime by clicking on your avatar"}),(0,ep.jsxs)(m.xu,{position:"relative",textShadow:"sm",children:[(0,ep.jsx)(iq.q,{animation:"".concat(C," 2s infinite ease-out"),name:null==y?void 0:y.displayName,src:null==y?void 0:y.profileImageUrl,size:"md",border:"solid 3px ".concat(b.value),shadow:"lg"}),(0,ep.jsx)(m.xu,{position:"absolute",top:"1.75rem",left:"1.75rem",outline:"0 0 2px rgba(255,255,255,1.0)",sx:{path:{stroke:"white",strokeWidth:48}},color:"black",children:(0,ep.jsx)(v.G,{icon:uo.q,fixedWidth:!0})})]})]})]})]})}),(0,ep.jsx)(na.m,{children:(0,ep.jsxs)(nc.h,{children:[(0,ep.jsx)(ef.z,{variant:"ghost",colorScheme:"gray",onClick:function(){o()},children:"Done"}),(0,ep.jsx)(ef.z,{variant:"solid",onClick:function(){o(),s(),c(p,p,{shallow:!0})},leftIcon:(0,ep.jsx)(v.G,{icon:lJ.zc}),children:"Start presenting"})]})})]})]})})},ul=(d={},(0,S.Z)(d,tQ.q.DOC_VIEW,{buttonLabel:"Present",shortcutIcon:lJ.zc,shortcutKeys:"Mod+Enter",shortcutLabel:"Switch to present view"}),(0,S.Z)(d,tQ.q.SLIDE_VIEW,{buttonLabel:"Exit",shortcutIcon:lQ.Bg,shortcutKeys:"Esc",shortcutLabel:"Exit present view"}),d),uu=function(e){var t,n,r,o,i=e.doc,s=e.isStaticEditor,a=e.editorWrapperEl,c=e.scrollingParentSelector,l=(0,nm.M)({id:"meetModal"}),u=l.onOpen,d=l.onClose,f=l.isOpen,g=un({editorWrapperEl:a,scrollingParentSelector:c}),y=g.enterSlideView,b=g.exitSlideView,w=g.setExitedFullscreenByClick,k=g.isFullscreen,C=g.enterFullscreen,O=g.exitFullscreen,E=(0,t2.SE)().user,S=(0,X.CG)(Q.gh),I=(0,j.useRef)(S);(0,j.useEffect)(function(){I.current=S},[S]);var P=ul[S],D=P.shortcutLabel,T=P.shortcutIcon,A=P.shortcutKeys,R=P.buttonLabel,L=null==i?void 0:null===(t=i.accessLinks)||void 0===t?void 0:null===(n=t[0])||void 0===n?void 0:n.url,_=Boolean(null==i?void 0:null===(r=i.accessLinks)||void 0===r?void 0:null===(o=r[0])||void 0===o?void 0:o.permission),Z=(0,t2.py)("manage",i||void 0),M=(0,n6.ye)("presentFullScreen"),z="present"===(0,X.CG)(Q.e_).primaryAction?"solid":"plain";return(0,ep.jsxs)(p.k,{children:[(0,ep.jsxs)(nc.h,{isAttached:!0,size:"sm","data-guider-highlight":"present-button-group","data-editor-mode":S===tQ.q.SLIDE_VIEW?"slide":"doc",children:[(0,ep.jsx)(x.kH,{closeOnMouseDown:!1,closeOnClick:!1,label:D,shortcut:A,children:(0,ep.jsx)(cR.h,{fontWeight:"normal",size:"sm",variant:z,onClick:function(){S===tQ.q.SLIDE_VIEW?b():y({fullscreen:M})},onMouseDown:tx.br,icon:(0,ep.jsx)(v.G,{icon:T}),"data-present-button":!0,children:R})}),(0,ep.jsxs)(nN.v,{children:[(0,ep.jsx)(nG.j,{variant:z,as:cR.r,icon:(0,ep.jsx)(v.G,{icon:a1.pt})}),(0,ep.jsx)(eG.h,{children:(0,ep.jsxs)(nW.q,{zIndex:"popover",children:[S===tQ.q.DOC_VIEW&&(0,ep.jsxs)(l3.k,{title:"Switch to present view",children:[(0,ep.jsx)(ly.s,{icon:(0,ep.jsx)(v.G,{icon:l5.Rk,fixedWidth:!0}),command:(0,x.cE)("Mod+Enter"),onClick:function(){return y({fullscreen:!1})},children:"In this tab"}),(0,ep.jsx)(ly.s,{icon:(0,ep.jsx)(v.G,{icon:l2.tc,fixedWidth:!0}),command:(0,x.cE)("Mod+Shift+Enter"),onClick:function(){return y({fullscreen:!0})},children:"Full screen"})]}),S===tQ.q.SLIDE_VIEW&&(0,ep.jsx)(ly.s,{icon:(0,ep.jsx)(v.G,{icon:lQ.Bg,fixedWidth:!0}),command:"ESC",onClick:b,children:"Exit present view"}),!s&&E&&Z&&(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(sx.R,{}),(0,ep.jsx)(x.kH,{isDisabled:_,label:"Enable access in the share panel to create a follow link",children:(0,ep.jsx)(m.xu,{children:(0,ep.jsx)(ly.s,{onClick:function(){var e;null!=i&&null!==(e=i.accessLinks)&&void 0!==e&&e[0].permission&&u()},isDisabled:!_,icon:(0,ep.jsx)(v.G,{icon:l1.AS,fixedWidth:!0}),children:(0,ep.jsxs)(ec.K,{spacing:"0",children:[(0,ep.jsx)(h.x,{children:"Share a follow link"}),(0,ep.jsx)(h.x,{fontSize:"sm",color:"gray.600",children:"People who join will follow you automatically"})]})})})})]}),!s&&E&&L&&(0,ep.jsx)(uc,{isOpen:f,onClose:d,accessLinkUrl:L,onPlayClick:function(){y({fullscreen:!1})}})]})})]})]}),S===tQ.q.SLIDE_VIEW&&(0,ep.jsx)(p.k,{ml:S===tQ.q.SLIDE_VIEW?2:0,children:(0,ep.jsx)(x.kH,{label:k?"Exit full screen":"Enter full screen",children:(0,ep.jsx)(cR.r,{"aria-label":k?"Exit full screen":"Enter full screen",borderRadius:"md",icon:(0,ep.jsx)(v.G,{icon:k?l0.Qj:l$.TL}),onClick:k?function(){w(!0),O()}:C})})})]})},ud=n(50897),uf=n(99897),up=n(8276),uh=n(68825),um=function(e){var t,n,r=e.doc,o=(0,nm.M)({id:"titleModalDisclosure"}),i=o.isOpen,s=o.onOpen,a=o.onClose,c=(0,nm.M)({id:"analyticsModalDisclosure"}),l=c.isOpen,u=c.onClose,d=c.onOpen,f=(0,uf.y)(),g=f.isSharePanelOpen,v=f.onSharePanelOpen,y=f.onSharePanelClose,b=f.view,w=f.setView;(0,j.useEffect)(function(){return cA.T.on("openSharePanel",function(e){v(),w(e)})},[v,w]);var k=(0,t2.SE)(),C=k.user,O=k.currentWorkspace,E=(0,t9._i)().editor,S=(0,t2.py)("view",r),I=(0,t2.py)("edit",r),P=(0,t2.py)("manage",r),D=(0,tW.z$)(),T=(0,j.useCallback)(function(){null==D||D.track(tW.AA.DOC_ANALYTICS_VIEWED,{docId:null==r?void 0:r.id,source:"share_panel",type:P?"full":"personal"}),d()},[D,P,null==r?void 0:r.id,d]);if(!S||!C||!r)return null;var A=r.collaborators||[],R=r.channels||[],L=(0,uh.Hs)((0,rI.Z)(A).sort(function(e,t){return e.user.id===C.id?-1:t.user.id===C.id?1:0}).map(function(e){return e.user.id===C.id?"You":e.user.displayName||""}).concat(r.orgAccess?R.map(function(e){return e.name||""}):[])),_=(0,up.h_)(r,C),Z=_?up.IK[_]:null,M=(0,up.Gi)(r,O);return null===Z?(console.error("[SharePanel] Unknown VisibilityValue for doc",r),null):(0,ep.jsxs)(p.k,{children:[(0,ep.jsx)(x.kH,{label:(0,ep.jsxs)(ep.Fragment,{children:[M&&(0,ep.jsxs)(h.x,{fontWeight:"bold",children:["This ",x._u," is managed by another workspace."]}),Z.title(null==r?void 0:null===(t=r.organization)||void 0===t?void 0:t.name)?(0,ep.jsx)(h.x,{children:Z.title(null==r?void 0:null===(n=r.organization)||void 0===n?void 0:n.name)}):null,(0,ep.jsx)(h.x,{fontSize:"xs",children:Z.subtitle?Z.subtitle(L||""):""})]}),children:(0,ep.jsx)("span",{children:(0,ep.jsx)(cR.h,{"data-guider-highlight":"share-button",onMouseDown:tx.br,icon:(0,ep.jsx)(m.xu,{children:(0,ep.jsx)(ud.aA,{visibility:Z,isFromOtherOrg:M})}),isDisabled:!I,onClick:function(){r.title&&""!==r.title?v():s()},children:"Share"})})}),i&&(0,ep.jsx)(c_,{onClose:a,isOpen:i,onSaveSuccess:function(){a(),v()},docId:null==r?void 0:r.id}),(0,ep.jsx)(ud.WQ,{doc:r,editor:E,isSharePanelOpen:g,onSharePanelOpen:v,onSharePanelClose:y,onAnalyticsPanelOpen:T,view:b,setView:w}),l&&(0,ep.jsx)(cT,{doc:r,onSharePanelOpen:v,onAnalyticsPanelClose:u,isAnalyticsPanelOpen:l,mode:P?"full":"personal"})]})},ug=n(38621),uv=function(e){var t=e.spotlightingByBlock,n=(0,t9._i)().editor,r=(0,j.useCallback)(function(){t?null==n||n.commands.turnOffSpotlight():null==n||n.commands.spotlightNextBlock()},[n,t]);return(0,ep.jsx)(p.k,{children:(0,ep.jsx)(x.kH,{closeOnMouseDown:!1,closeOnClick:!1,label:(0,ep.jsxs)(h.x,{whiteSpace:"nowrap",children:[t?"Turn off spotlight":"Turn on spotlight",(0,ep.jsx)(h.x,{as:"span",display:"inline",color:"gray.400",ml:2,children:"S"})]}),children:(0,ep.jsx)(cR.h,{colorScheme:"trueblue",variant:t?"solid":"plain",onClick:function(e){r(),e.target.blur()},icon:(0,ep.jsx)(v.G,{icon:ug.QM}),children:"Spotlight"})})})},ux=n(18504),uy=n(11565),ub=n(20949),uj=n(36880),uw=n(57673),uk=(0,j.memo)(function(){var e,t=(0,eJ.p)(),n=(0,k.$gs)().isConnected,r=(0,t9._i)(),o=r.docId,i=r.getCollaborativeEditorInstance,s=(0,nm.M)({id:"themeEditor"}),a=s.isOpen,c=s.onOpen,l=s.onClose,u=(0,nm.M)({id:"themeStyleDrawer"}),d=u.isOpen,f=u.onOpen,g=u.onClose,y=null===(e=i())||void 0===e?void 0:e.state.doc.toJSON(),b=(0,X.CG)(Q.Pu),w=(0,ub.g)(),C=(0,I.Z)(w,2),O=C[0],E=C[1],S=(0,j.useCallback)(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?t?E({type:"SET_NEW_THEME_FOR_SELECTING",data:{theme:e}}):E({type:"SET_THEME_EDITING",data:{theme:e}}):E({type:"NEW_BLANK_THEME"}),c()},[E,c]),P=i();(0,eM.bb)(P,S);var D=(0,tW.z$)(),T=(0,j.useCallback)(function(e){P&&(P.commands.updateAttributes(uw.B.name,e),null==D||D.track(tW.AA.DOC_ATTRIBUTES_UPDATED,e))},[P,D]),A=(0,eM.vi)({docId:o,editor:P}).updateDocThemeWithAccentImages,R=(0,j.useCallback)(function(e){e.id!==b.id&&A(e.id).then(function(){null==D||D.track(tW.AA.DOC_THEME_UPDATED,{doc_id:o,theme_id:e.id})}).catch(function(e){console.error(e),t({title:"Error saving doc theme: ".concat(e.message),position:"top",status:"error"})})},[D,b.id,o,t,A]);return(0,j.useEffect)(function(){var e=cA.T.on("toggleThemeBlock",f),t=nw.pw.on(nw.TI.OPEN_THEME_DRAWER,f);return function(){e(),t()}},[f]),(0,ep.jsxs)(p.k,{children:[(0,ep.jsx)(x.kH,{label:n?"Edit theme":(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(h.x,{children:"You're offline"}),(0,ep.jsx)(h.x,{color:"gray.300",children:"Themes will be available when you reconnect."})]}),"aria-label":"Edit theme",children:(0,ep.jsx)(m.xu,{children:(0,ep.jsx)(cR.h,{"data-guider-highlight":"toolbar-theme-button",onClick:f,isDisabled:!n,icon:(0,ep.jsx)(v.G,{icon:ux.q2}),"data-testid":"toolbar-theme-button",children:"Theme"})})}),(0,ep.jsx)(uj.G,{getEditor:i,isOpen:d&&!a,onClose:g,openThemeEditor:S,setDocTheme:R,updateAttributesAndTrack:T}),(0,ep.jsx)(uy.z,{isOpen:a,onClose:l,state:O,dispatch:E,docContent:y,onThemeCreated:R,disableDrawerTransition:!0})]})});uk.displayName="ThemeBlock";var uC=n(31997),uO=function(){var e=(0,n6.ye)("presentZoom"),t=(0,t9._i)().editor,n=(0,tW.z$)(),r=(0,w.I0)(),o=(0,X.CG)(Q.SU),i=(0,j.useCallback)(function(){var e=Math.min(sE.v4,o+.1);r((0,Q.Ic)({zoomLevel:e})),null==n||n.track(tW.AA.DOC_ZOOMED,{direction:"in",level:e})},[r,n,o]),s=(0,j.useCallback)(function(){var e=Math.max(sE.Ou,o-.1);r((0,Q.Ic)({zoomLevel:e})),null==n||n.track(tW.AA.DOC_ZOOMED,{direction:"in",level:e})},[r,n,o]),a=(0,j.useCallback)(function(){var e=sE.aX;r((0,Q.Ic)({zoomLevel:e})),null==n||n.track(tW.AA.DOC_ZOOMED,{direction:"reset",level:e})},[r,n]),c=(0,X.CG)(sr.C);return((0,j.useEffect)(function(){if(e)return nb.F7.on("keydown","PRESENT_BLOCK",function(e){return!(c||!t||(0,ez.KB)(t)||(0,tX.Hx)(e.target))&&((0,n3.ZP)("=")(e)?(i(),e.preventDefault(),!0):(0,n3.ZP)("-")(e)?(s(),e.preventDefault(),!0):!!(0,n3.ZP)("0")(e)&&(a(),e.preventDefault(),!0))})},[c,e,t,i,s,a]),e)?(0,ep.jsxs)(nc.h,{spacing:"0",size:"sm",variant:"plain",isAttached:!0,children:[(0,ep.jsx)(x.kH,{closeOnMouseDown:!1,closeOnClick:!1,shortcut:"-",label:"Zoom out",children:(0,ep.jsx)(R.h,{"aria-label":"Zoom out",fontWeight:"normal",onClick:s,icon:(0,ep.jsx)(v.G,{icon:uC.Kl})})}),(0,ep.jsx)(x.kH,{closeOnMouseDown:!1,closeOnClick:!1,shortcut:"0",label:"Reset zoom",children:(0,ep.jsxs)(ef.z,{fontWeight:"normal",borderX:"none",onClick:a,w:12,children:[(100*o).toFixed(0),"%"]})}),(0,ep.jsx)(x.kH,{closeOnMouseDown:!1,closeOnClick:!1,shortcut:"+",label:"Zoom in",children:(0,ep.jsx)(R.h,{fontWeight:"normal","aria-label":"Zoom in",onClick:i,icon:(0,ep.jsx)(v.G,{icon:oX.r8})})})]}):null},uE=(0,e7.E)(m.xu),uS=(0,j.memo)(function(e){var t,r,o=e.scrollingParentSelector,i=e.toggleCommentsPanel,s=e.isCommentsPanelOpen,a=e.editorWrapperEl,c=e.docEditorType,l=(0,sB.a)(["(max-width: 840px)","(min-width: 841px)"]),u=(0,I.Z)(l,1)[0],d=(0,ek.i)({base:!0,lg:!1}),f=(0,o8.LQ)(window.location.href),h=(0,X.CG)(Q.gh),m=(0,X.CG)(t7.yx),g=(0,t9._i)().editor,v=(0,t2.py)("comment",m),x=(0,si.g)(g).enabled,y=(0,X.CG)(Q.WI),b=(0,X.CG)(Q.yn),w="SLIDE_VIEW"!==h,k=(0,X.CG)(Q.hN),C=c!==t4.Z.COLLABORATIVE,O=c===t4.Z.PUBLIC_STATIC,E=(0,X.CG)(Q.Tf),P=(0,n6.ye)("aiChat");(0,n6.ye)("pptExport")&&(window.exportToPptx=(t=(0,t8.Z)(nt().mark(function e(t){var r;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(g){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(9775),n.e(5743),n.e(7093)]).then(n.bind(n,35063));case 4:return r=e.sent.exportToPptx,e.abrupt("return",r(g,t));case 7:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}));var D=K((0,j.useCallback)(function(e){var t=T.current;return!!t&&(!!(t.querySelector("[data-active]")||t.querySelector('[aria-expanded="true"]'))||e.clientY<100)},[]),!E),T=(0,j.useRef)(null);return(0,ep.jsxs)(p.k,{"data-editor-toolbar":!0,ref:T,bg:"linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.1) 100%)",position:"absolute",zIndex:"overlay",top:0,left:0,right:0,p:2,alignItems:"center",pr:6,marginTop:!E||E&&D?0:"-100%",pointerEvents:"none",sx:(r={},(0,S.Z)(r,"&:focus-within",{marginTop:0}),(0,S.Z)(r,"> *",{pointerEvents:"auto"}),(0,S.Z)(r,"> #toolbar-spacer",{pointerEvents:"none"}),r),transitionProperty:"margin-top",transitionDuration:"ultra-slow",transitionTimingFunction:"ease-in-out","data-print-hidden":!0,children:[(0,ep.jsx)(e8.M,{initial:!1,children:y&&b&&(0,ep.jsx)(uE,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},position:"absolute",pointerEvents:"none",borderTop:"solid ".concat(4,"px ").concat(null==y?void 0:y.color),top:0,left:0,bottom:0,right:0,height:"var(--100vh)"})}),!O&&(0,ep.jsx)(es.U,{children:(0,ep.jsx)(cX,{doc:m})}),(0,ep.jsx)(sU.L,{pointerEvents:"none",id:"toolbar-spacer"}),(0,ep.jsxs)(es.U,{children:[!u&&(0,ep.jsx)(c9,{}),!u&&!w&&(0,ep.jsx)(uO,{}),!u&&!w&&(0,ep.jsx)(ep.Fragment,{children:(0,ep.jsx)(uv,{spotlightingByBlock:x})}),!u&&!C&&k&&(0,ep.jsx)(uk,{}),!u&&!C&&(0,ep.jsx)(um,{doc:m}),!u&&!f&&(0,ep.jsx)(uu,{doc:m,isStaticEditor:C,editorWrapperEl:a,scrollingParentSelector:o}),!C&&v&&(0,ep.jsx)(ld,{doc:m,mode:h,isCommentsPanelOpen:s,toggleCommentsPanel:i}),!u&&d&&!C&&k&&P&&(0,ep.jsx)(lp,{}),!u&&!C&&(0,ep.jsx)(cZ,{doc:m}),!u&&!C&&(0,ep.jsx)(lX,{doc:m}),!O&&(0,ep.jsx)(p.k,{children:(0,ep.jsx)(nd.DY,{showRing:!0})})]})]})}),uI=n(61417),uP=n(41575),uD=(0,n3.ZP)("mod+S"),uT=(0,n3.ZP)("mod+shift+O"),uA=function(){var e=(0,eJ.p)();(0,j.useEffect)(function(){var t=function(t){uD(t)&&(t.preventDefault(),e.isActive("save_toast")||e({id:"save_toast",title:"Gamma automatically saves your work for you.",status:"success",duration:5e3,isClosable:!0}))},n=(0,tX.B$)({requiredCookie:"cardCollapseDebug=true"});return window.addEventListener("keydown",t),function(){null==n||n(),window.removeEventListener("keydown",t)}},[e])},uR=function(){var e=(0,X.qr)(),t=(0,X.TL)(),n=(0,t9._i)().editor;(0,j.useEffect)(function(){if(n){var r=function(r){if(uT(r)){r.preventDefault();var o=e.getState(),i=o.TipTap,s=i.cardIdMap,a=i.cardIds,c=i.memoState.expandedCards,l=(0,Q.i2)(o),u=a.reduce(function(e,t){var n=!0===c[t],r=s.parents[t]||[],o=r.length>0,i=!l||r.includes(l);return o&&i&&(e.cardIds.push(t),e.total++,e.expanded+=n?1:0),e},{total:0,expanded:0,cardIds:[]}),d=u.total,f=u.expanded,p=u.cardIds;t((0,Q.bj)({disable:!0})),setTimeout(function(){t((0,Q.bj)({disable:!1}))},100);var h=d===f;uL(n,100,!h),(0,l4.Nn)(p,h)}};return window.addEventListener("keydown",r),function(){window.removeEventListener("keydown",r)}}},[t,e,n])},uL=function(e,t,n){for(var r=(0,tY.cC)("editor"),o=void 0,i=200;i>0;i-=25){var s,a=(0,oA.Je)(e,r.scrollSelector,i);if(null!==(s=a.pos)&&void 0!==s&&s.pos){var c=void 0;e.state.doc.nodeAt(a.pos.pos)?c=a.pos.pos:e.state.doc.nodeAt(a.pos.inside)&&(c=a.pos.inside),c&&(!o||c>o)&&(o=c)}}if(!o){console.warn("[pinPageDuringAnimation] No result for getTopCenterIshNode");return}var l=u_(e,o,n);if(!l){console.warn("[pinPageDuringAnimation] No element for getElementToPin");return}(0,tX.wO)({element:l,requiredCookie:"cardCollapseDebug=true"});var u=+new Date,d=r.scroller.scrollTop,f=(0,tX.LY)(l,r.scrollSelector),p=d-f,h=p<0?0:Math.max(p+200,0);!function e(){if(l){var n=(0,tX.LY)(l,r.scrollSelector);r.scroller.scroll({top:d+(n-f-h)}),+new Date-u<t&&requestAnimationFrame(e)}}()},u_=function(e,t,n){var r,o=e.state.doc.resolve(t),i=e.state.doc.nodeAt(t),s=(0,oA.Sh)(e,t);if(!i){console.warn("[getElementToPin] nodeAt null for $pos",o);return}var a=(0,oA.nv)(o,function(){return!0}).reverse();for(a.push({start:o.start(o.depth+1),pos:t,depth:o.depth,node:i});a.length;){var c=a.shift();if(c){var l=(0,tK.KH)(c.node),u=(0,uI.SA)(c.node),d=(0,uP.CU)(c.node),f=l||c.node.isAtom?c.pos:c.start;if(s=(0,oA.Sh)(e,f),!n&&l&&c.depth>2||u||d)break}}for(;(null===(r=s)||void 0===r?void 0:r.offsetParent)===null&&s.parentElement;)s=s.parentElement;return s},uZ=n(42949),uM=n(76544),uz=n(99100),uN=n(27128),uG=n(50521),uW=n(16981),uF=n(3651),uB=n(14707),uU=n(99175),uV=n(25590),uq=n(40196),uH=n(92298),uY=n(29925),uK=(s=(0,t8.Z)(nt().mark(function e(t){var n,r,o,i,s,a,c;return nt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.editor,r=t.chain,o=t.node,i=t.imageAttrs,s=t.pos,r.updateAttributesAtPos(s,(0,uH.j6)(o,{uploadStatus:uV.D.Uploading})),a=i.tempUrl,c=i.src,(0,uU.WY)(c,n.storage.mediaUpload.orgId,{onUploadComplete:function(e){(0,uH.Ns)(n,a,e)},onUploadFailed:function(e){(0,uH.f8)(n,a,e,!0)}});case 4:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)}),uX=function(e,t){console.debug("[AIStream processAIImages] for cardId: ",t);var n=e.chain(),r=(0,tH.N2)(e.state.doc,function(e){return(0,tK.KH)(e)&&e.attrs.id===t})[0];if(!r){console.error("[processAIImages] can not find card with id: ",t);return}var o=r.pos,i=o+r.node.nodeSize;e.state.doc.descendants(function(t,r){if(r<o||r>i)return!0;var s,a=t.attrs,c=t.type,l=void 0;return"image"===c.name?l=a:(0,uY.E)(t)?l=a.image:((0,tK.KH)(t)||(0,uq.pt)(t))&&(l=null===(s=a.background)||void 0===s?void 0:s.image),l&&l.uploadStatus===uV.D.Queued&&(console.debug("[AIStream processAIImages]: ".concat(t.type.name," node with AI queries at pos ").concat(r,":"),l),uK({editor:e,chain:n,node:t,imageAttrs:l,pos:r})),!0}),n.run()},uQ=["latency"];function uJ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uJ(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uJ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var u0=function(){return(0,ep.jsxs)(re.b,{status:"error",variant:"solid",children:[(0,ep.jsx)(s0.z,{}),(0,ep.jsx)(rn.X,{children:(0,ep.jsxs)(ec.K,{children:[(0,ep.jsx)("strong",{children:"AI generation failed due to flagged content."}),(0,ep.jsx)(h.x,{children:"Try adjusting your input and try again."})]})})]})},u1=function(e){var t=e.editor,n=e.chunk,r=e.theme,o=e.format,i=n.id,s=n.index,a=(0,uN.a)({chunk:n,theme:r,outputFormat:o}),c=(0,tH.N2)(t.state.doc,function(e){return(0,uW.KH)(e)})[0],l=(0,tH.N2)(t.state.doc,function(e){return(0,uW.KH)(e)&&e.attrs.id===i})[0];if(!c)throw Error("Doc does not have a first card");var u=l?{from:l.pos,to:l.pos+l.node.nodeSize}:0===s?{from:c.pos,to:c.pos+c.node.nodeSize}:t.state.doc.nodeSize-3;try{if(t.commands.insertContentAt(u,a,{updateSelection:!1}),n.cardComplete&&0===n.index){var d=(0,rZ.t)(t.state.doc.resolve(c.pos));d&&t.commands.command(function(e){return e.tr.setSelection(d),!0})}}catch(f){console.warn("[useCreateFromStream] ERROR updating card",a),console.warn(f)}},u2=function(e,t){var n=(0,eJ.p)(),r=(0,X.CG)(Q.Pu),o=(0,X.qr)(),i=(0,X.TL)(),s=(0,uG.As)("editor"),a=(0,X.CG)((0,o5.oH)(e)),c=(0,j.useRef)(!0),l=(0,X.CG)(Q.KV),u=(0,n6.ye)("aiWizardUploadImages"),d=(0,j.useRef)(null),f=(0,j.useCallback)(function(){d.current||(d.current=n({id:"ai-generating-toast",isClosable:!1,render:function(){return(0,ep.jsxs)(re.b,{variant:"light",children:[(0,ep.jsx)(iR.$,{size:"sm",mr:2}),(0,ep.jsxs)(rn.X,{children:[(0,ep.jsx)("strong",{children:"AI Generating:"})," Don't close this tab while generation is in progress."]})]})},position:"top",duration:null}))},[n]);(0,j.useEffect)(function(){return function(){d.current&&(n.close(d.current),d.current=null)}},[n]),(0,j.useEffect)(function(){if(a&&"running"===a.status){var e=s.scroller;if(e){var t=function(){s.isAtBottom(40)?c.current=!0:c.current=!1},n=function(){c.current=!1};return e.addEventListener("wheel",t,{passive:!0}),e.addEventListener("touchend",t,{passive:!0}),e.addEventListener("touchstart",n,{passive:!0}),e.addEventListener("touchmove",n,{passive:!0}),function(){e.removeEventListener("wheel",t),e.removeEventListener("touchend",t),e.removeEventListener("touchstart",n),e.removeEventListener("touchmove",n)}}}},[s,a]);var p=(0,j.useCallback)(function(){if(c.current){var e;null===(e=s.scroller)||void 0===e||e.scrollTo({top:s.scroller.scrollHeight,behavior:"auto"})}},[s]),h=(0,uF.Z_)(p,100);(0,uB.v)(function(){if(a&&t&&(!a||"running"===a.status)&&(t.commands.setAIGenerationRunning(!0),f(),l)){var s=a.id,c=a.stream,p=(0,uz.I)(t),m=c.getReader(),g=!1;!function a(){if(g){t.commands.setAIGenerationRunning(!1),(0,uM.rD)(),i((0,o5.G0)({id:s,status:"complete"}));var c=(0,o5.Sn)(s)(o.getState());c&&(0,oS.gb)(u$(u$({},c),{},{docId:e})),d.current&&n.update(d.current,{title:"Your ".concat(p.label," has finished generating."),status:"success",position:"top",duration:3e3,isClosable:!0})}else m.read().then(function(e){var n=e.value;if(g=e.done,!n){a();return}if(n.done&&n.finishReason===uZ.TJ)throw Error(uZ.TJ);if(!n.done){var o=n.data,i=o.id,s=o.cardComplete;u1({chunk:n.data,editor:t,theme:r,format:p}),h(),s&&u&&uX(t,i)}a()}).catch(function(r){var a=r instanceof Error?r.message:r;t.commands.setAIGenerationRunning(!1),(0,uM.rD)(),i((0,o5.G0)({id:s,status:"error"}));var c=(0,o5.Sn)(s)(o.getState()),l=c.latency,u=(0,eF.Z)(c,uQ);c&&(0,oS.pQ)(u$(u$({},u),{},{errorName:"StreamError",errorMessage:a,outputMessage:"",latency:l,docId:e})),d.current&&(a===uZ.TJ?n.update(d.current,{render:u0,position:"top",duration:null,isClosable:!0}):n.update(d.current,{title:"An error has occured: ".concat(a,". Please try again."),status:"error",position:"top",duration:null,isClosable:!0}))})}()}},[e,t,i,o,h,a,u,r,n,f,l],[t,a,l]),(0,j.useEffect)(function(){return function(){var t=(0,o5.oH)(e)(o.getState());t&&"running"===t.status&&i((0,o5.Of)({id:t.id}))}},[i,e,o])},u5=n(14198),u3=function(e){var t=e.toggleToCPanel,n=e.initializeToCPanel,r=e.isToCPanelOpen,o=(0,u5.F)().breakpoints.xl,i=(0,X.CG)(Q.gh),s=(0,j.useState)(i!==ez.qe.SLIDE_VIEW),a=s[0],c=s[1],l=(0,j.useState)(!1),u=l[0];l[1];var d=(0,w.I0)();(0,iM.vm)(function(){n()},[o,t,n,d],[]),(0,iM.vm)(function(){i===ez.qe.SLIDE_VIEW?(c(r),t({disableTransition:!1,override:"closed"})):u&&i===ez.qe.DOC_VIEW&&t({disableTransition:!1,override:a?"open":"closed"})},[t,r,a,i,u],[i])};function u6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u4(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u6(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u6(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var u9="doc_archived_warning",u7=function(e,t){var n=(0,eJ.p)(),r=(0,k.iX9)(),o=(0,I.Z)(r,1)[0];(0,j.useEffect)(function(){return function(){n.close(u9)}},[]),(0,j.useEffect)(function(){e&&t===t4.Z.COLLABORATIVE&&(e.archived&&!n.isActive(u9)?n({id:u9,title:(0,ep.jsxs)(h.x,{"data-testid":"trash-confirmation-toast",children:["Want to edit this? It's in the trash."," ",(0,ep.jsx)(e$.r,{textDecoration:"underline",onClick:function(){var t={id:e.id};o({variables:t,optimisticResponse:{unarchiveDoc:u4(u4({},t),{},{archived:!0,__typename:"Doc"})}})},children:"Restore it."})]}),status:"warning",position:"top",isClosable:!1,duration:null}):!e.archived&&n.isActive(u9)&&n.close(u9))},[e,t,n,o])},u8=n(89205),de=function(){var e=(0,t9._i)().editor,t=(0,cV.useRouter)(),n=(0,X.qr)();(0,j.useEffect)(function(){if(e){t.beforePopState(function(e){return!e.as.startsWith("/docs/")});var r=ih.fI.on("changed",function(t){var r=(0,o8.sY)(t.url).cardId,o=n.getState(),i=(0,Q.gh)(o);if(console.debug("[useHandleCardHash][handleURLChange]",{payload:t,cardId:r}),i===ez.qe.DOC_VIEW&&t.state.fromPos&&"pop"===t.method){var s=t.state,a=s.fromPos,c=s.fromPct;e.chain().scrollToPositionInCard(a,c||void 0).command(function(e){var t=e.tr;return(0,u8.B0)(a)(t),!0}).run()}else{var l=(0,Q.xb)(o)[0];(0,r_.YS)({cardId:r||l,editor:e})}});return function(){t.beforePopState(function(){return!0}),r()}}},[e,t,n]),(0,j.useEffect)(function(){if(e){var t=(0,o8.sY)(window.location.href).cardId;t&&(0,am.D)({cardId:t,method:"replace"})}},[e])},dt=n(56675),dn=n(70513);function dr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function di(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dr(Object(n),!0).forEach(function(t){(0,S.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ds=function(e){var t=(0,dt.x)(),n=(0,X.CG)(oT.cn);(0,j.useEffect)(function(){n&&t.cache.updateQuery({query:dn.yE1,variables:{id:e}},function(e){if(!(null!=e&&e.doc))return e;var t=e.doc;return t.titleEdited?e:{doc:di(di({},t),{},{title:n})}})},[n,t,e])},da=n(57453),dc=function(e,t){var n=(0,nk._)().isUnauthorized;(0,tW.If)(function(r){!0!==n&&void 0!==n&&(r.track(tW.AA.DOC_VIEWED,{doc_id:e}),t===t4.Z.EXAMPLE_STATIC&&r.track(tW.AA.EXAMPLE_VIEWED,{doc_id:e}))},[e,t,n]),(0,da.d)();var r=(0,n6.ye)("realUserMetrics"),o=t===t4.Z.COLLABORATIVE&&r,i=(0,n6.ye)("rumKeystrokeSampleRate");(0,l6.lh)(o,i)},dl=function(e){var t=(0,w.I0)(),n=(0,tW.z$)();(0,j.useEffect)(function(){var r,o=function(){var o=(0,X.bh)().getState();r=(0,Q.Q5)(o),(0,l4.I7)(e),t((0,Q.lx)({isEditingDisabled:!0})),null==n||n.trackDocEvent(tW.AA.DOC_PRINTED)},i=function(){t((0,Q.lx)({isEditingDisabled:!1})),t((0,Q.xn)({expandedCardsMap:r}))};return window.addEventListener("beforeprint",o),window.addEventListener("afterprint",i),function(){window.removeEventListener("beforeprint",o),window.removeEventListener("afterprint",i)}},[t,e,n])},du="doc-root",dd=function(e){var t=e.isConnected;return(0,ep.jsx)(p.k,{flex:1,alignItems:"center",justifyContent:"center",color:"gray.500",fontSize:"2xl",children:t?(0,ep.jsxs)(ep.Fragment,{children:["It looks like you don't have access to this ",x._u,"."]}):(0,ep.jsxs)(p.k,{m:8,alignItems:"center",direction:"row",children:[(0,ep.jsx)(v.G,{icon:f.bK,size:"4x"}),(0,ep.jsxs)(h.x,{ml:8,children:[(0,ep.jsx)("strong",{children:"You're offline."})," Connect to the internet to view this ",x._u,"."]})]})})},df=function(e){var t=e.doc,n=e.user,r=e.docEditorType,o=(0,C.$m)(t,n),i=(0,w.v9)(Q.gh),s=r===t4.Z.COLLABORATIVE&&!o,a=s&&i===ez.qe.SLIDE_VIEW;return(null==o?void 0:o.permission)=="view"?(0,ep.jsx)(iF.m,{}):a?(0,ep.jsx)(ex,{}):s?(0,ep.jsx)(E.C,{showTourReplay:!0}):null},dp=(0,t9.eT)(function(e){var t=e.docEditorType,n=void 0===t?t4.Z.COLLABORATIVE:t,r=(0,t9._i)(),o=r.docId,i=r.isUnauthorized,s=r.setCollaborativeEditorInstance,a=r.editor,c=(0,X.CG)(t7.yx),l=(0,k.$gs)().isConnected,u=(0,t2.SE)().user;(0,O.F3)(),u7(c,n),u2(o,a),ds(o),dc(o,n),de(),uA(),uR(),iJ(a,".".concat(du)),i7(a),t3(),dl(a),(0,C.DD)(c,n===t4.Z.COLLABORATIVE);var d=(0,j.useRef)(null),f=(0,X.TL)(),h=(0,eM.Yy)(),v=(0,j.useMemo)(function(){return(0,tN.vu)(h)},[h]);console.debug("%c[DocEditorComponent] RENDER - ".concat(o),"background-color: gold");var y=(0,eb.Pp)(sF.Q),w=y.togglePanel,E=y.isPanelOpen,S=y.initPanel,I=(0,eb.Pp)(n5),P=I.togglePanel,D=I.isPanelOpen,T=(0,eb.Pp)(oY),A=T.togglePanel,R=T.isPanelOpen;oH({toggleDesignPartnerPanel:A,isDesignPartnerPanelOpen:R,editor:a}),u3({toggleToCPanel:w,isToCPanelOpen:E,initializeToCPanel:S}),(0,j.useEffect)(function(){return function(){f((0,eP.qo)())}},[f]);var L=(0,j.useCallback)(function(){return Boolean(a&&a.state.selection.empty)},[a]),_=(0,eb.Xy)(),Z=_.leftPanelLifecycle,M=_.rightPanelLifecycle,z=_.globalPanelLifecycle,N=(0,ey.dU)(null==c?void 0:c.organization),G=(0,t6.U)(null==c?void 0:c.title,N);return(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)("style",{id:"editorStyleOverride",children:"body {overflow: hidden;}"}),(0,ep.jsx)(b(),{children:(0,ep.jsx)("title",{children:G})}),(0,ep.jsx)(nx,{doc:c,editor:a}),(0,ep.jsx)(eZ.H9,{isEnabledFn:L}),i?(0,ep.jsx)(dd,{isConnected:l}):(0,ep.jsxs)(p.k,{id:"doc-main",direction:"row",w:"100%",h:"100%","data-testid":"doc-editor-root",ref:d,children:[(0,ep.jsx)(e_,{panelLifecycle:Z}),(0,ep.jsxs)(p.k,{flex:"1",direction:"column",position:"relative",minWidth:"0",h:"100%",children:[(0,ep.jsx)(x.Wk,{isDark:h,children:(0,ep.jsx)(uS,{scrollingParentSelector:".".concat(du),editorWrapperEl:d.current,docEditorType:n,isToCPanelOpen:E,toggleToCPanel:w,isCommentsPanelOpen:D,toggleCommentsPanel:P})}),(0,ep.jsxs)(m.xu,{flex:"1",overflowY:"auto",overflowX:"hidden",minWidth:"0",h:"100%",className:(0,g.cx)(du,R&&"design-partner-panel-open"),style:{},css:v,children:[n===t4.Z.PUBLIC_STATIC?(0,ep.jsx)(i5,{docId:o,snapshotId:null==c?void 0:c.currentSnapshotId,scrollingParentSelector:".".concat(du),onCreate:s}):n===t4.Z.EXAMPLE_STATIC?(0,ep.jsx)(iV,{docId:o,snapshotId:null==c?void 0:c.currentSnapshotId,scrollingParentSelector:".".concat(du),onCreate:s}):(0,ep.jsxs)(eC.Mn.Provider,{value:z,children:[(0,ep.jsx)(ez.Ge,{doc:c,docId:o,readOnly:null==c?void 0:c.archived,onCreate:s,scrollingParentSelector:".".concat(du)}),a&&(0,ep.jsx)(t1,{editor:a})]}),(0,ep.jsx)(iA,{editor:a}),(0,ep.jsx)(sW,{editor:a})]})]}),(0,ep.jsx)(eL,{panelLifecycle:M}),(0,ep.jsx)(tG.a,{editorId:"main",children:(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(tz,{editor:a}),(0,ep.jsx)(df,{doc:c,user:u,docEditorType:n})]})})]})]})}),dh=n(56768),dm=n(93031),dg=n(59195),dv=n(92488),dx=n(56581),dy=n(38717),db=n(99121),dj=function(e){var t=e.theme,n=e.onClick,r=e.isChecked,o=e.index,i=e.startIndex;return(0,ep.jsxs)(m.xu,{gridColumnStart:o+1-i,display:i>o?"none":"block",gridRow:1,as:dy.f,p:2,transition:"all 0.2s ease-in-out",bgColor:r?"trueblue.100":"linen.50",textAlign:"left",tabIndex:0,borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_focus:{boxShadow:r?void 0:"outline"},outline:"none",onClick:n,_hover:{bgColor:r?"trueblue.100":"gray.100"},onKeyDown:function(e){("Enter"===e.key||" "===e.key)&&n()},"data-theme-id":t.id,"data-testid":r?"current-theme-preview":void 0,cursor:"pointer",children:[(0,ep.jsx)(db.n,{theme:t}),(0,ep.jsxs)(ec.K,{direction:"row",spacing:1,pt:1,children:[r&&(0,ep.jsx)(dx.n,{w:3,h:"auto",mr:1,color:"trueblue.700"}),(0,ep.jsx)(h.x,{fontSize:"sm",noOfLines:1,"data-testid":"theme-name",color:r?"trueblue.700":void 0,children:t.name})]})]})};dj.displayName="DemoDocThemePreview";var dw="linen.50",dk=function(e){var t=e.templateTheme,r=e.setTheme,o=e.currentThemeId,i=(0,w.v9)(Q.gh)===ez.qe.SLIDE_VIEW,s=(0,j.useState)([]),a=s[0],c=s[1],l=(0,j.useState)(!1),u=l[0],d=l[1],f=(0,j.useState)(0),h=f[0],m=f[1],g=(0,ek.i)({base:3,md:4,lg:5})||3;(0,j.useEffect)(function(){n.e(2359).then(n.bind(n,82359)).then(function(e){c(e.GLOBAL_THEMES)})},[]);var x=[].concat((0,rI.Z)(t?[t]:[]),(0,rI.Z)(a.filter(function(e){return e.id!==(null==t?void 0:t.id)}))),y=(0,j.useCallback)(function(e){1===e?m(function(e){return e+1}):m(function(e){return e-1})},[]);return i?(0,ep.jsx)(ep.Fragment,{}):(0,ep.jsx)(eG.h,{children:(0,ep.jsxs)(p.k,{w:"100%",position:"absolute",bottom:0,left:0,bgColor:dw,zIndex:"sticky",direction:"column",borderTop:"3px solid var(--chakra-colors-trueblue-500)",minH:12,p:2,justifyContent:"center",children:[(0,ep.jsx)(p.k,{alignItems:"flex-end",justify:"flex-end",children:(0,ep.jsx)(ef.z,{variant:"ghost",size:"sm",rightIcon:(0,ep.jsx)(v.G,{icon:u?dv.gc:dg.on}),onClick:function(){return d(function(e){return!e})},children:u?"Close":"Change theme"})}),(0,ep.jsx)(p.k,{justify:"flex-start",align:"flex-start",bgColor:dw,w:"100%",children:u&&(0,ep.jsxs)(ec.K,{direction:"row",align:"center",justify:"center",w:"100%",children:[(0,ep.jsx)(R.h,{"aria-label":"Left",onClick:function(){return y(-1)},variant:"ghost",isDisabled:0===h,icon:(0,ep.jsx)(v.G,{icon:dm.Ey})}),(0,ep.jsx)(st.r,{w:"100%",flex:1,overflow:"hidden",padding:2,transition:"all 0.2s ease-in-out",templateColumns:["repeat(".concat(g,", calc(100% / ").concat(g," - 1em))")],gap:"0 1em",bgColor:dw,children:x.map(function(e,t){return(0,ep.jsx)(dj,{index:t,startIndex:h,isChecked:e.id===o,theme:e,onClick:function(){r(e)}},e.id)})}),(0,ep.jsx)(R.h,{"aria-label":"Right",variant:"ghost",isDisabled:h+g>x.length,onClick:function(){return y(1)},icon:(0,ep.jsx)(v.G,{icon:dh.yO})})]})})]})})},dC=n(53589),dO=n(68690),dE=n(70091),dS=n(31218),dI=[{description:"Prev/next card",shortcut:["",""]},{description:"Scroll up/down",shortcut:["",""]},{description:"Exit present mode",shortcut:"Esc"},{description:"Spotlight on/off",shortcut:"S"},{description:"Open/close card",shortcut:"Enter"},{description:"Open/close all cards",shortcut:"Mod+Shift+O"},{description:"Restart presentation",shortcut:"R"}],dP=function(e){var t=un({editorWrapperEl:e.editorWrapperEl,scrollingParentSelector:e.scrollingParentSelector}),n=t.enterSlideView,r=t.exitSlideView,o=t.setExitedFullscreenByClick,i=t.isFullscreen,s=t.enterFullscreen,a=t.exitFullscreen,c=(0,X.CG)(Q.gh),l=(0,j.useRef)(c);return(0,j.useEffect)(function(){l.current=c},[c]),(0,ep.jsxs)(es.U,{children:[(0,ep.jsxs)(nc.h,{isAttached:!0,size:"sm",children:[(0,ep.jsx)(x.kH,{label:c===tQ.q.DOC_VIEW?"You're currently viewing this deck in doc mode":"View this deck as a doc",children:(0,ep.jsx)(ef.z,{variant:c===tQ.q.DOC_VIEW?"solid":"plain",cursor:c===tQ.q.SLIDE_VIEW?"pointer":"auto",onClick:function(){c===tQ.q.SLIDE_VIEW&&r()},leftIcon:(0,ep.jsx)(v.G,{icon:dO.cw}),children:"Document"})}),(0,ep.jsx)(x.kH,{label:c===tQ.q.SLIDE_VIEW?"You are currently viewing this deck in presentation mode":"View this deck as a presentation",children:(0,ep.jsx)(ef.z,{variant:c===tQ.q.SLIDE_VIEW?"solid":"plain",cursor:c===tQ.q.DOC_VIEW?"pointer":"auto",onClick:function(){c===tQ.q.DOC_VIEW&&n({fullscreen:!1})},leftIcon:(0,ep.jsx)(v.G,{icon:dC.bg}),children:"Presentation"})})]}),c===tQ.q.SLIDE_VIEW&&(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(ed.i,{orientation:"vertical"}),(0,ep.jsx)(x.kH,{label:i?"Exit full screen":"Enter full screen",children:(0,ep.jsx)(R.h,{size:"sm","aria-label":i?"Exit full screen":"Enter full screen",borderRadius:"md",icon:(0,ep.jsx)(v.G,{icon:i?l0.Qj:l$.TL}),onClick:i?function(){o(!0),a()}:s})}),(0,ep.jsxs)(T.J,{children:[(0,ep.jsx)(A.x,{children:(0,ep.jsx)(ef.z,{size:"sm",variant:"plain",fontWeight:"normal",children:"Keyboard shortcuts"})}),(0,ep.jsxs)(L.y,{border:"1px solid #eee !important",children:[(0,ep.jsx)(lt.Q,{}),(0,ep.jsx)(dE.u,{}),(0,ep.jsx)(_.b,{children:(0,ep.jsx)(dS.A,{list:dI})})]})]})]})]})},dD=(0,j.memo)(function(e){var t=e.scrollingParentSelector,n=e.editorWrapperEl;(0,X.CG)(t7.yx);var r=(0,j.useRef)(null);return(0,ep.jsx)(p.k,{ref:r,bg:"white",borderBottom:"3px solid var(--chakra-colors-trueblue-600)",position:"absolute",zIndex:"overlay",top:0,left:0,right:0,p:2,alignItems:"flex-start",justifyContent:"flex-start",pr:6,children:(0,ep.jsx)(p.k,{direction:"column",w:"100%",children:(0,ep.jsx)(dP,{editorWrapperEl:n,scrollingParentSelector:t})})})}),dT="doc-root",dA=(0,t9.eT)(function(e){var t,n=e.docEditorType,r=void 0===n?t4.Z.COLLABORATIVE:n,o=(0,t9._i)(),i=o.docId,s=o.setCollaborativeEditorInstance,a=o.editor,c=(0,X.CG)(t7.yx);dc(i,r),de(),uA(),uR(),iJ(a,".".concat(dT)),i7(a),t3(),dl(a),(0,C.DD)(c,r===t4.Z.COLLABORATIVE);var l=(0,j.useRef)(null),u=null==c?void 0:c.theme,d=(0,j.useState)(function(){return u}),f=d[0],h=d[1],g=(0,X.TL)(),v=(0,j.useRef)(!1),y=(0,k.EDv)({variables:{docId:i,snapshotId:null==c?void 0:c.currentSnapshotId},skip:!(null!=c&&c.currentSnapshotId)}).data,w=null==y?void 0:null===(t=y.snapshot)||void 0===t?void 0:t.content.default;console.debug("%c[DemoDocEditorComponent] RENDER - ".concat(i),"background-color: gold"),(0,j.useEffect)(function(){u&&!v.current&&(h(u),v.current=!0)},[u]),(0,j.useEffect)(function(){if(a){var e=null==f?void 0:f.config.accentBackgrounds;if(!e||0===e.length){w&&a.commands.setContent(w);return}a.commands.updateThemeAccentImages(e)}},[a,f,w]);var O=(0,eb.Pp)(sF.Q);u3({toggleToCPanel:O.togglePanel,isToCPanelOpen:O.isPanelOpen,initializeToCPanel:O.initPanel}),(0,j.useEffect)(function(){return function(){g((0,eP.qo)())}},[g]);var E=(0,eb.Xy)(),S=E.leftPanelLifecycle;return E.globalPanelLifecycle,(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)("style",{id:"editorStyleOverride",children:"body {overflow: hidden;}"}),(0,ep.jsx)(b(),{children:(0,ep.jsxs)("title",{children:["".concat(c?(0,x.$L)(c.title)+" | ":""),"Gamma"]})}),(0,ep.jsxs)(p.k,{id:"doc-main",direction:"row",w:"100%",h:"100%","data-testid":"doc-editor-root",ref:l,children:[(0,ep.jsx)(e_,{panelLifecycle:S}),(0,ep.jsxs)(p.k,{flex:"1",direction:"column",position:"relative",minWidth:"0",h:"100%",children:[a&&(0,ep.jsx)(dD,{scrollingParentSelector:".".concat(dT),editorWrapperEl:l.current,setTheme:h,currentThemeId:(null==f?void 0:f.id)||(null==u?void 0:u.id),templateTheme:u}),(0,ep.jsxs)(m.xu,{flex:"1",overflowY:"auto",overflowX:"hidden",minWidth:"0",h:"100%",className:dT,children:[(0,ep.jsx)(i5,{docId:i,snapshotId:null==c?void 0:c.currentSnapshotId,scrollingParentSelector:".".concat(dT),onCreate:s,theme:f,showMadeWithGammaBadge:!1}),(0,ep.jsx)(sW,{editor:a,showNavigationControls:!0})]})]}),(0,ep.jsx)(tz,{editor:a}),(0,ep.jsx)(dk,{setTheme:h,currentThemeId:(null==f?void 0:f.id)||(null==u?void 0:u.id),templateTheme:u})]})]})}),dR=n(98740),dL="body",d_=n(56648),dZ=function(e){var t=(0,uG.As)(e),n=(0,j.useState)("up"),r=n[0],o=n[1];return(0,j.useEffect)(function(){var e=document.querySelector(t.scrollSelector);if(e){var n=(null==e?void 0:e.scrollTop)||0,r=function(){var t=(null==e?void 0:e.scrollTop)||0;Math.abs(t-n)>0&&(o(!(t>n)||n>0&&0===t||t>0&&0===n?"up":"down"),n=t>0?t:0)},i=V()(function(){return window.requestAnimationFrame(r)},500,{leading:!0});return null==e||e.addEventListener("scroll",i),function(){return null==e?void 0:e.removeEventListener("scroll",i)}}},[t.scrollSelector]),r},dM=function(e){var t,n=e.doc,r=e.onCommentFeedOpen,o=e.onTocOpen,i=e.commentsEnabled,s=(0,cq.X)($.H.lastHomeUrl,"/"),a=(0,I.Z)(s,1)[0],c=(0,t2.SE)().user,l=(null==n?void 0:null===(t=n.comments)||void 0===t?void 0:t.filter(function(e){return e.status===k.Ux9.Open}).length)||0,u=dZ("editor");return(0,ep.jsxs)(es.U,{p:1,px:2,bg:"gray.50",shadow:"lg",position:"sticky",top:0,transitionProperty:"common",transitionDuration:"normal",transform:"up"==u?"translate(0px,0px)":"translate(0px,-100%)",opacity:"up"==u?1:0,zIndex:"sticky",children:[c&&(0,ep.jsx)(o2(),{href:a,passHref:!0,legacyBehavior:!0,children:(0,ep.jsx)(R.h,{as:e$.r,"aria-label":"Home",_hover:{bg:"transparent",color:"trueblue.500"},icon:(0,ep.jsx)(v.G,{icon:cM.J9,size:"1x"}),variant:"ghost",color:"gray.700"})}),(0,ep.jsx)(h.x,{flex:1,fontSize:"sm",noOfLines:1,ml:2,children:null==n?void 0:n.title}),(0,ep.jsxs)(nc.h,{variant:"ghost",children:[(void 0===i||i)&&(0,ep.jsx)(ef.z,{_hover:{bg:"transparent",color:"trueblue.500"},color:"gray.700",fontSize:"sm",onClick:r,leftIcon:(0,ep.jsx)(v.G,{icon:le.Mz}),children:l}),(0,ep.jsx)(R.h,{"aria-label":"Open table of contents",_hover:{bg:"transparent",color:"trueblue.500"},color:"gray.700",onClick:o,icon:(0,ep.jsx)(v.G,{icon:d_.xi})})]})]})},dz=function(e){var t=e.doc,n=e.docEditorType,r=e.commentsEnabled,o=void 0===r||r,i=(0,t9._i)(),s=i.docId,a=i.setCollaborativeEditorInstance,c=i.editor,l=(0,D.q)({id:"mobile-comment-feed-panel-drawer"}),u=l.isOpen,d=l.onOpen,f=l.onClose,h=(0,D.q)({id:"mobile-toc-drawer"}),m=h.isOpen,g=h.onOpen,v=h.onClose,y=(0,j.useState)(null),b=y[0],w=y[1];return console.debug("%c[MobileEditorWrapper] RENDER - ".concat(s),"background-color: gold"),(0,ep.jsxs)(p.k,{ref:(0,j.useCallback)(function(e){return w(e)},[]),direction:"column",flex:1,children:[(0,ep.jsx)(dM,{doc:t,onCommentFeedOpen:d,onTocOpen:g,commentsEnabled:o}),n===t4.Z.PUBLIC_STATIC?(0,ep.jsx)(i5,{docId:s,snapshotId:null==t?void 0:t.currentSnapshotId,scrollingParentSelector:dL,onCreate:a}):n===t4.Z.EXAMPLE_STATIC?(0,ep.jsx)(iV,{docId:s,snapshotId:null==t?void 0:t.currentSnapshotId,scrollingParentSelector:dL,onCreate:a}):(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsx)(ez.Ge,{doc:t,docId:s,readOnly:!0,onCreate:a,scrollingParentSelector:dL}),c&&(0,ep.jsx)(t1,{editor:c})]}),o&&u&&(0,ep.jsx)(x.Aj,{isOpen:u,onClose:f,drawerProps:{autoFocus:!1},children:(0,ep.jsx)(n$,{onClose:f,editor:c})}),m&&(0,ep.jsx)(x.Aj,{isOpen:m,onClose:v,children:(0,ep.jsx)(dR.o,{rootElement:b,handleClose:v})}),(0,ep.jsx)(tG.a,{children:(0,ep.jsx)(iA,{editor:c})})]})},dN=(0,t9.eT)(function(e){var t=e.docEditorType,n=void 0===t?t4.Z.COLLABORATIVE:t,r=(0,t9._i)(),o=r.docId,i=r.isUnauthorized,s=r.editor;dc(o,n),u2(o,s),de();var a=(0,j.useRef)(null),c=(0,w.v9)(t7.yx);console.debug("%c[MobileDocViewerComponent] RENDER - ".concat(o),"background-color: gold");var l=n===t4.Z.COLLABORATIVE;return(0,ep.jsxs)(ep.Fragment,{children:[(0,ep.jsxs)(b(),{children:[(0,ep.jsxs)("title",{children:["".concat(c?(0,x.$L)(c.title)+" | ":""),"Gamma"]}),(0,ep.jsx)("meta",{name:"viewport",content:"width=device-width, user-scalable=no"})]}),(0,ep.jsx)(ui.Global,{styles:{html:{overflowX:"hidden"},body:{overflow:"hidden scroll",WebkitOverflowScrolling:"touch"}}}),i?(0,ep.jsxs)(p.k,{flex:1,alignItems:"center",justifyContent:"center",color:"gray.500",fontSize:"2xl",p:6,textAlign:"center",children:["It looks like you don't have access to this ",x._u,"."]}):(0,ep.jsx)(p.k,{id:"doc-main",direction:"column",w:"100%",h:"100%","data-testid":"doc-editor-root",ref:a,flex:"1",children:(0,ep.jsx)(dz,{doc:c,docEditorType:n,commentsEnabled:l})})]})})}}]);
//# sourceMappingURL=1197-292146f483488243.js.map