"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7087],{60887:function(t,e,n){n.d(e,{B:function(){return s}});var r=n(13089),i=n(96412),o=n(95235),s=(0,r.Z)(function t(e){var n=e.key,r=e.description,s=e.classifyExamples,a=e.classifyReply,c=e.checkEnabled;(0,i.Z)(this,t),(0,o.Z)(this,"key",void 0),(0,o.Z)(this,"description",void 0),(0,o.Z)(this,"classifyExamples",void 0),(0,o.Z)(this,"classifyReply",void 0),(0,o.Z)(this,"checkEnabled",void 0),this.key=n,this.description=r,this.classifyExamples=s,this.classifyReply=a,this.checkEnabled=c})},77739:function(t,e,n){n.d(e,{O:function(){return p}});var r=n(96412),i=n(13089),o=n(95235),s=n(9850),a=n.n(s),c=n(27191),u=n(4640),l=n(11625),g=n(16981),d=n(77141),p=function(){function t(e,n){(0,r.Z)(this,t),(0,o.Z)(this,"type","replace-content"),(0,o.Z)(this,"description",void 0),(0,o.Z)(this,"rangeId",void 0),(0,o.Z)(this,"slice",void 0),(0,o.Z)(this,"content",void 0),this.description=n.description,this.rangeId=n.rangeId,this.content=n.content,this.slice=(0,d.Fr)(e,n.content)}return(0,i.Z)(t,[{key:"isApplied",value:function(t){var e=t.state.tr,n=null;try{n=this.transact(t,e,!1)}catch(r){return console.error("[isModificationActive] Could not transact modificatioon, returning false",r.message),!1}if(!n)return!1;var i=(0,d.m$)(t,this.rangeId);if(!i)return!1;try{var o=t.state.doc.slice(i.from,i.to),s=e.doc.slice(i.from,i.to),a=n.from===i.from&&n.to===i.to;return o.eq(s)&&a}catch(c){}return!1}},{key:"getPreviewJson",value:function(t){var e=t.state.tr;this.transact(t,e);var n=this.getParentCardId(t,e),r=a()(e.doc.toJSON());return(0,d.Y0)(r,n)}},{key:"getParentCardId",value:function(t,e){var n=(0,d.m$)(t,this.rangeId);if(!n)return null;var r=e.doc.resolve(n.from),i=(0,u.Ru)(r,g.KH)[0];return i&&i.node.attrs.id||null}},{key:"apply",value:function(t){var e=t.state.tr;this.transact(t,e),console.debug("[ReplaceContentModification] Applying modification",{modification:this,range:(0,d.m$)(t,this.rangeId)}),t.view.dispatch(e);var n=this.getParentCardId(t,e);(0,l.YS)({editor:t,cardId:n})}},{key:"transact",value:function(t,e){var n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=(0,d.m$)(t,this.rangeId);if(!r)return null;var i=t.state;e.replace(r.from,r.to,this.slice).setMeta("applyingAiModification",{rangeId:this.rangeId});var o=e.mapping.map(r.to),s={from:r.from,to:o};if(n){if(i.selection.empty)return e.setSelection(c.Y1.near(e.doc.resolve(r.from))),s;if(i.selection instanceof c.qv)return e.setSelection(c.qv.create(e.doc,r.from)),s;var a=c.Bs.between(e.doc.resolve(r.from),e.doc.resolve(o));e.setSelection(a)}return s}},{key:"getContentForTracking",value:function(){return this.content}}]),t}()},77141:function(t,e,n){n.d(e,{C$:function(){return c},Fr:function(){return a},Y0:function(){return s},m$:function(){return u}});var r=n(30764),i=n(85851),o=n(49333),s=function(t,e){if(!t.content||!t.content[0].content)return null;var n=t.content[0].content.find(function(t){return t.attrs&&t.attrs.id===e});return n?(t.content[0].content=[n],t):null},a=function(t,e){var n=null;if("html"===e.type)n=(0,o.Tk)(e.html,t.schema).slice;else if("json"===e.type){var i=r.HY.fromJSON(t.schema,e.json);n=new r.p2(i,0,0)}else throw Error("Unsupported Modification content type ".concat(e.type));return n},c=function(t,e,n){var r,o,s=i.i.getState(t.state);return s?(null==s?void 0:s.getExistingRangeId(t.state,n))||null||(null===(r=(o=t.commands).setInteractionRange)||void 0===r||r.call(o,e,n),e):e},u=function(t,e){var n=i.i.getState(t.state);return(null==n?void 0:n.getRange(t.state,e))||null}},17087:function(t,e,n){n.d(e,{$V:function(){return Z},az:function(){return w},w6:function(){return T}});var r=n(20406),i=n(96412),o=n(13089),s=n(41701),a=n(90129),c=n(29017),u=n(48200),l=n(95235),g=n(28526),d=n.n(g),p=n(60887),f=n(4757),h=n(7008),m=n(86508),v=n(42584),y=n(77739),k=n(77141),C=n(50980),I=n(27837),w="\uD83D\uDE14 Sorry, I tried this but it didn't work. Could you try asking in a different way?",T=function(t){(0,a.Z)(T,t);var e,n,g,p,C=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,u.Z)(T);if(e){var r=(0,u.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,c.Z)(this,t)});function T(t){var e;return(0,i.Z)(this,T),e=C.call(this,t),(0,l.Z)((0,s.Z)(e),"prompt",void 0),(0,l.Z)((0,s.Z)(e),"parseResponse",void 0),(0,l.Z)((0,s.Z)(e),"getTaskTarget",void 0),e.prompt=t.prompt,e.parseResponse=t.parseResponse||Z,e.getTaskTarget=t.getTaskTarget,e}return(0,o.Z)(T,[{key:"getResponseMessages",value:(n=(0,r.Z)(d().mark(function t(e){var n,r,i,o,s,a,c,u,l,g,p;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.editor,r=e.context,i=e.rangeId,s=(o=e.response).raw,a=o.suggestion,c=o.message,a){t.next=3;break}throw new v.$D("[SuggestContentTask] No html provided in prompt response",{chatMessage:c,inputMessage:r.message,resp:s,interactionId:r.interactionId});case 3:return t.next=5,(0,h.T)(a);case 5:return console.debug("[AIChat SuggestContentTask] modify suggestion",{transformedHtml:u=t.sent,html:a}),p={from:"Designer",type:"suggestContent",resp:s,message:c||"How about this?",suggestions:[g={label:"Suggested",modification:l=new y.O(n,{description:"Suggested",content:{type:"html",html:u},rangeId:i}),jsonContentPreview:l.getPreviewJson(n)},this.getOriginalModifyContentSuggestion(n,r,i)],interactionId:r.interactionId},t.abrupt("return",{messages:[p],suggestionToApply:g});case 12:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"runPrompt",value:(g=(0,r.Z)(d().mark(function t(e){var n,r,i,o,s,a,c,u;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.input,r=e.context,i=e.variables,o=e.trackFns,a=void 0===(s=e.retries)?2:s,t.next=3,(0,f.Ii)(n,r.interactionId,{timeout:m.VH.get("aiRequestTimeouts").suggestContent});case 3:if(c=t.sent){t.next=6;break}throw new v.$D("Couldn't get response from prompt",{resp:c,inputMessage:r.message,interactionId:r.interactionId});case 6:if(!(u=this.parseResponse(c,i)).shouldRetry){t.next=12;break}if(!(a<=0)){t.next=10;break}throw new v.eo("Could not parse response properly after retries",{chatMessage:w,inputMessage:r.message,resp:c,interactionId:r.interactionId});case 10:return o.trackRequestRetry({interactionId:r.interactionId,retriesRemaining:a,resp:c}),t.abrupt("return",this.runPrompt({input:n,context:r,retries:a-1,trackFns:o,variables:i}));case 12:return t.abrupt("return",{parsed:u,resp:c});case 13:case"end":return t.stop()}},t,this)})),function(t){return g.apply(this,arguments)})},{key:"run",value:(p=(0,r.Z)(d().mark(function t(e){var n,r,i,o,s,a,c,u,l,g,p,f,h,m,v,y,C,w,T,x;return d().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.editor,r=e.context,i=e.addMessage,o=e.history,s=e.trackFns,a=e.themeModificationController,c=e.provider,l=(u=this.determineTaskTarget(r.editorContext)).html,g=u.range,s.trackInputContent({taskContext:r,inputContent:l}),p={message:r.message,html:l,outline:r.editorContext.outline},f=(0,k.C$)(n,r.interactionId,g),h=(0,I.x)(o||[]),m=this.prompt.generate({variables:p,history:h,interactionId:r.interactionId,params:{provider:c}}),console.debug("[AIChat SuggestContentTask] run",{html:p.html,input:m,suggestHistory:h,range:(0,k.m$)(n,f)}),t.next=10,this.runPrompt({input:m,context:r,variables:p,trackFns:s,retries:1});case 10:return y=(v=t.sent).parsed,C=v.resp,t.next=15,this.getResponseMessages({editor:n,context:r,rangeId:f,response:y,themeModificationController:a});case 15:T=(w=t.sent).messages,x=w.suggestionToApply,console.debug("[AIChat SuggestContentTask] completed",{suggestion:y.suggestion,resp:C,parsed:y,messages:T,suggestionToApply:x}),this.autoApplySuggestion({context:r,editor:n,suggestionToApply:x,resp:C,trackFns:s,themeModificationController:a}),T.forEach(function(t){return i(t)}),s.trackRequestComplete({taskContext:r,outputMessage:y.message,outputContent:y.suggestion,resp:C});case 22:case"end":return t.stop()}},t,this)})),function(t){return p.apply(this,arguments)})},{key:"determineTaskTarget",value:function(t){return this.getTaskTarget?this.getTaskTarget(t):t.defaultRange}},{key:"getOriginalModifyContentSuggestion",value:function(t,e,n){var r=new y.O(t,{description:"Original",content:{type:"html",html:this.determineTaskTarget(e.editorContext).html},rangeId:n});return{label:"Original",modification:r,jsonContentPreview:r.getPreviewJson(t)}}},{key:"autoApplySuggestion",value:function(t){var e=t.context,n=t.editor,r=t.suggestionToApply,i=t.resp,o=t.trackFns,s=t.themeModificationController;if(r){if(r.modification.isApplied(n,s))throw console.debug("[SuggestContentTask] suggestion does not change the content",r),new v.ME("Suggestion does not change content",{resp:i,interactionId:e.interactionId,chatMessage:w});try{var a=r.modification;a.apply(n,s),o.trackSuggestionApplied({interactionId:e.interactionId,suggestionContent:a.getContentForTracking(),suggestionLabel:a.description,suggestionType:a.type,autoApplied:!0})}catch(c){throw new v.An("Could not apply suggestion",{interactionId:e.interactionId})}}}}]),T}(p.B),x=/([\s\S]*?)```[A-Za-z]*\n([\s\S]*?)\n```([\s\S]*?)$/im,Z=function(t){var e=t.match(x),n=[],r=void 0;if(e)n=[e[1],e[3]],r=e[2];else{var i=t.split("```");if(0===i.length)throw Error("Could not extract code from response");if(1===i.length)return(0,C.y)(i[0])?{suggestion:void 0,raw:t,message:t,shouldRetry:!0}:{suggestion:void 0,raw:t,message:t.replaceAll(/(HTML|code)/gi,"content")};n=[i[0]],r=i[1].trim()}return{suggestion:r,message:n.map(function(t){return t.trim()}).filter(function(t){return t.length>0}).join("\n\n").replaceAll(/(HTML|code)/gi,"content").replaceAll(/(slide)/gi,"card"),raw:t}}},50980:function(t,e,n){n.d(e,{y:function(){return r}});var r=function(t){return Array.from(new DOMParser().parseFromString(t,"text/html").body.childNodes).some(function(t){return 1===t.nodeType})}},27837:function(t,e,n){n.d(e,{x:function(){return r}});var r=function(t){return t.slice(-7).map(function(t){return"User"===t.from?{role:"user",content:t.message}:t.isClassification?{role:"assistant",content:t.message}:t.resp?{role:"assistant",content:t.resp}:null}).filter(function(t){return!!(null!=t&&t.content)})}}}]);
//# sourceMappingURL=7087-c60030164be2f5b7.js.map